<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>OpenCV: Background Subtraction</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.10.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d3/d81/tutorial_contrib_root.html">Tutorials for contrib modules</a></li><li class="navelem"><a class="el" href="../../d3/d89/tutorial_table_of_content_bgsegm.html">Tutorials for bgsegm module</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Background Subtraction</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1842"></a>
Goal</h1>
<p>In this chapter,</p>
<ul>
<li>We will familiarize with the background subtraction methods available in OpenCV.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1843"></a>
Basics</h1>
<p>Background subtraction is a major preprocessing step in many vision-based applications. For example, consider the case of a visitor counter where a static camera takes the number of visitors entering or leaving the room, or a traffic camera extracting information about the vehicles etc. In all these cases, first you need to extract the person or vehicles alone. Technically, you need to extract the moving foreground from static background.</p>
<p>If you have an image of background alone, like an image of the room without visitors, image of the road without vehicles etc, it is an easy job. Just subtract the new image from the background. You get the foreground objects alone. But in most of the cases, you may not have such an image, so we need to extract the background from whatever images we have. It becomes more complicated when there are shadows of the vehicles. Since shadows also move, simple subtraction will mark that also as foreground. It complicates things.</p>
<p>Several algorithms were introduced for this purpose. In the following, we will have a look at two algorithms from the <code>bgsegm</code> module.</p>
<h2><a class="anchor" id="autotoc_md1844"></a>
BackgroundSubtractorMOG</h2>
<p>It is a Gaussian Mixture-based Background/Foreground Segmentation Algorithm. It was introduced in the paper "An improved adaptive background mixture model for real-time tracking with shadow
detection" by P. KadewTraKuPong and R. Bowden in 2001. It uses a method to model each background pixel by a mixture of K Gaussian distributions (K = 3 to 5). The weights of the mixture represent the time proportions that those colours stay in the scene. The probable background colours are the ones which stay longer and more static.</p>
<p>While coding, we need to create a background object using the function, <b><a class="el" href="../../d2/d55/group__bgsegm.html#ga18a5c26910c7c2391fa58580919618e4" title="Creates mixture-of-gaussian background subtractor.">cv.bgsegm.createBackgroundSubtractorMOG()</a></b>. It has some optional parameters like length of history, number of gaussian mixtures, threshold etc. It is all set to some default values. Then inside the video loop, use backgroundsubtractor.apply() method to get the foreground mask.</p>
<p>See a simple example below: </p><div class="fragment"><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</div>
<div class="line"> </div>
<div class="line">cap = <a class="code hl_class" href="../../d8/dfe/classcv_1_1VideoCapture.html">cv.VideoCapture</a>(<span class="stringliteral">&#39;vtest.avi&#39;</span>)</div>
<div class="line"> </div>
<div class="line">fgbg = <a class="code hl_function" href="../../d2/d55/group__bgsegm.html#ga18a5c26910c7c2391fa58580919618e4">cv.bgsegm.createBackgroundSubtractorMOG</a>()</div>
<div class="line"> </div>
<div class="line">while(1):</div>
<div class="line">    ret, frame = cap.read()</div>
<div class="line"> </div>
<div class="line">    fgmask = fgbg.apply(frame)</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(<span class="stringliteral">&#39;frame&#39;</span>,fgmask)</div>
<div class="line">    k = <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv.waitKey</a>(30) &amp; 0xff</div>
<div class="line">    <span class="keywordflow">if</span> k == 27:</div>
<div class="line">        <span class="keywordflow">break</span></div>
<div class="line"> </div>
<div class="line">cap.release()</div>
<div class="line"><a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga6b7fc1c1a8960438156912027b38f481">cv.destroyAllWindows</a>()</div>
<div class="ttc" id="aclasscv_1_1VideoCapture_html"><div class="ttname"><a href="../../d8/dfe/classcv_1_1VideoCapture.html">cv::VideoCapture</a></div><div class="ttdoc">Class for video capturing from video files, image sequences or cameras.</div><div class="ttdef"><b>Definition</b> videoio.hpp:731</div></div>
<div class="ttc" id="agroup__bgsegm_html_ga18a5c26910c7c2391fa58580919618e4"><div class="ttname"><a href="../../d2/d55/group__bgsegm.html#ga18a5c26910c7c2391fa58580919618e4">cv::bgsegm::createBackgroundSubtractorMOG</a></div><div class="ttdeci">Ptr&lt; BackgroundSubtractorMOG &gt; createBackgroundSubtractorMOG(int history=200, int nmixtures=5, double backgroundRatio=0.7, double noiseSigma=0)</div><div class="ttdoc">Creates mixture-of-gaussian background subtractor.</div></div>
<div class="ttc" id="agroup__highgui_html_ga453d42fe4cb60e5723281a89973ee563"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv::imshow</a></div><div class="ttdeci">void imshow(const String &amp;winname, InputArray mat)</div><div class="ttdoc">Displays an image in the specified window.</div></div>
<div class="ttc" id="agroup__highgui_html_ga5628525ad33f52eab17feebcfba38bd7"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv::waitKey</a></div><div class="ttdeci">int waitKey(int delay=0)</div><div class="ttdoc">Waits for a pressed key.</div></div>
<div class="ttc" id="agroup__highgui_html_ga6b7fc1c1a8960438156912027b38f481"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga6b7fc1c1a8960438156912027b38f481">cv::destroyAllWindows</a></div><div class="ttdeci">void destroyAllWindows()</div><div class="ttdoc">Destroys all of the HighGUI windows.</div></div>
</div><!-- fragment --><p> ( All the results are shown at the end for comparison).</p>
<dl class="section note"><dt>Note</dt><dd>Documentation on the newer method <b><a class="el" href="../../de/de1/group__video__motion.html#ga818a6d66b725549d3709aa4cfda3f301" title="Creates MOG2 Background Subtractor.">cv.createBackgroundSubtractorMOG2()</a></b> can be found here: <a class="el" href="../../d1/dc5/tutorial_background_subtraction.html">How to Use Background Subtraction Methods</a></dd></dl>
<h2><a class="anchor" id="autotoc_md1845"></a>
BackgroundSubtractorGMG</h2>
<p>This algorithm combines statistical background image estimation and per-pixel Bayesian segmentation. It was introduced by Andrew B. Godbehere, Akihiro Matsukawa, and Ken Goldberg in their paper "Visual
Tracking of Human Visitors under Variable-Lighting Conditions for a Responsive Audio Art
Installation" in 2012. As per the paper, the system ran a successful interactive audio art installation called “Are We There Yet?” from March 31 - July 31 2011 at the Contemporary Jewish Museum in San Francisco, California.</p>
<p>It uses first few (120 by default) frames for background modelling. It employs probabilistic foreground segmentation algorithm that identifies possible foreground objects using Bayesian inference. The estimates are adaptive; newer observations are more heavily weighted than old observations to accommodate variable illumination. Several morphological filtering operations like closing and opening are done to remove unwanted noise. You will get a black window during first few frames.</p>
<p>It would be better to apply morphological opening to the result to remove the noises. </p><div class="fragment"><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</div>
<div class="line"> </div>
<div class="line">cap = <a class="code hl_class" href="../../d8/dfe/classcv_1_1VideoCapture.html">cv.VideoCapture</a>(<span class="stringliteral">&#39;vtest.avi&#39;</span>)</div>
<div class="line"> </div>
<div class="line">kernel = <a class="code hl_function" href="../../d4/d86/group__imgproc__filter.html#gac342a1bb6eabf6f55c803b09268e36dc">cv.getStructuringElement</a>(cv.MORPH_ELLIPSE,(3,3))</div>
<div class="line">fgbg = <a class="code hl_function" href="../../d2/d55/group__bgsegm.html#gaad94337e0d50030547168504915ed8c4">cv.bgsegm.createBackgroundSubtractorGMG</a>()</div>
<div class="line"> </div>
<div class="line">while(1):</div>
<div class="line">    ret, frame = cap.read()</div>
<div class="line"> </div>
<div class="line">    fgmask = fgbg.apply(frame)</div>
<div class="line">    fgmask = <a class="code hl_function" href="../../d4/d86/group__imgproc__filter.html#ga67493776e3ad1a3df63883829375201f">cv.morphologyEx</a>(fgmask, cv.MORPH_OPEN, kernel)</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(<span class="stringliteral">&#39;frame&#39;</span>,fgmask)</div>
<div class="line">    k = <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv.waitKey</a>(30) &amp; 0xff</div>
<div class="line">    <span class="keywordflow">if</span> k == 27:</div>
<div class="line">        <span class="keywordflow">break</span></div>
<div class="line"> </div>
<div class="line">cap.release()</div>
<div class="line"><a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga6b7fc1c1a8960438156912027b38f481">cv.destroyAllWindows</a>()</div>
<div class="ttc" id="agroup__bgsegm_html_gaad94337e0d50030547168504915ed8c4"><div class="ttname"><a href="../../d2/d55/group__bgsegm.html#gaad94337e0d50030547168504915ed8c4">cv::bgsegm::createBackgroundSubtractorGMG</a></div><div class="ttdeci">Ptr&lt; BackgroundSubtractorGMG &gt; createBackgroundSubtractorGMG(int initializationFrames=120, double decisionThreshold=0.8)</div><div class="ttdoc">Creates a GMG Background Subtractor.</div></div>
<div class="ttc" id="agroup__imgproc__filter_html_ga67493776e3ad1a3df63883829375201f"><div class="ttname"><a href="../../d4/d86/group__imgproc__filter.html#ga67493776e3ad1a3df63883829375201f">cv::morphologyEx</a></div><div class="ttdeci">void morphologyEx(InputArray src, OutputArray dst, int op, InputArray kernel, Point anchor=Point(-1,-1), int iterations=1, int borderType=BORDER_CONSTANT, const Scalar &amp;borderValue=morphologyDefaultBorderValue())</div><div class="ttdoc">Performs advanced morphological transformations.</div></div>
<div class="ttc" id="agroup__imgproc__filter_html_gac342a1bb6eabf6f55c803b09268e36dc"><div class="ttname"><a href="../../d4/d86/group__imgproc__filter.html#gac342a1bb6eabf6f55c803b09268e36dc">cv::getStructuringElement</a></div><div class="ttdeci">Mat getStructuringElement(int shape, Size ksize, Point anchor=Point(-1,-1))</div><div class="ttdoc">Returns a structuring element of the specified size and shape for morphological operations.</div></div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md1846"></a>
Results</h1>
<p><b>Original Frame</b></p>
<p>Below image shows the 200th frame of a video</p>
<div class="image">
<img src="../../resframe.jpg" alt=""/>
<div class="caption">
image</div></div>
    <p><b>Result of BackgroundSubtractorMOG</b></p>
<div class="image">
<img src="../../resmog.jpg" alt=""/>
<div class="caption">
image</div></div>
    <p><b>Result of BackgroundSubtractorGMG</b></p>
<p>Noise is removed with morphological opening.</p>
<div class="image">
<img src="../../resgmg.jpg" alt=""/>
<div class="caption">
image</div></div>
    <h1><a class="anchor" id="autotoc_md1847"></a>
Additional Resources</h1>
<h1><a class="anchor" id="autotoc_md1848"></a>
Exercises</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 2 2024 21:52:14 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.8
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
