<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>OpenCV: Detection of ArUco boards</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.10.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d2/d64/tutorial_table_of_content_objdetect.html">Object Detection (objdetect module)</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Detection of ArUco boards</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Prev Tutorial:</b> <a class="el" href="../../d5/dae/tutorial_aruco_detection.html">Detection of ArUco Markers</a> <br  />
<b>Next Tutorial:</b> <a class="el" href="../../df/d4a/tutorial_charuco_detection.html">Detection of ChArUco Boards</a> <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight"></th><th class="markdownTableHeadLeft"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">Original authors   </td><td class="markdownTableBodyLeft">Sergio Garrido, Alexander Panov    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">Compatibility   </td><td class="markdownTableBodyLeft">OpenCV &gt;= 4.7.0   </td></tr>
</table>
<p>An ArUco board is a set of markers that acts like a single marker in the sense that it provides a single pose for the camera.</p>
<p>The most popular board is the one with all the markers in the same plane, since it can be easily printed:</p>
<div class="image">
<img src="../../gboriginal.jpg" alt=""/>
</div>
    <p>However, boards are not limited to this arrangement and can represent any 2d or 3d layout.</p>
<p>The difference between a board and a set of independent markers is that the relative position between the markers in the board is known a priori. This allows that the corners of all the markers can be used for estimating the pose of the camera respect to the whole board.</p>
<p>When you use a set of independent markers, you can estimate the pose for each marker individually, since you dont know the relative position of the markers in the environment.</p>
<p>The main benefits of using boards are:</p>
<ul>
<li>The pose estimation is much more versatile. Only some markers are necessary to perform pose estimation. Thus, the pose can be calculated even in the presence of occlusions or partial views.</li>
<li>The obtained pose is usually more accurate since a higher amount of point correspondences (marker corners) are employed.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1044"></a>
Board Detection</h1>
<p>A board detection is similar to the standard marker detection. The only difference is in the pose estimation step. In fact, to use marker boards, a standard marker detection should be done before estimating the board pose.</p>
<p>To perform pose estimation for boards, you should use <code>solvePnP()</code> function, as shown below in the <code>samples/cpp/tutorial_code/objectDetection/detect_board.cpp</code>.</p>
<div class="fragment"><div class="line">    <span class="keywordtype">int</span> markersX = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span> markersY = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;h&quot;</span>);</div>
<div class="line">    <span class="keywordtype">float</span> markerLength = parser.get&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;l&quot;</span>);</div>
<div class="line">    <span class="keywordtype">float</span> markerSeparation = parser.get&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;s&quot;</span>);</div>
<div class="line">    <span class="keywordtype">bool</span> showRejected = parser.has(<span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">    <span class="keywordtype">bool</span> refindStrategy = parser.has(<span class="stringliteral">&quot;rs&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span> camId = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;ci&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    Mat camMatrix, distCoeffs;</div>
<div class="line">    readCameraParamsFromCommandLine(parser, camMatrix, distCoeffs);</div>
<div class="line">    aruco::Dictionary dictionary = readDictionatyFromCommandLine(parser);</div>
<div class="line">    aruco::DetectorParameters detectorParams = readDetectorParamsFromCommandLine(parser);</div>
<div class="line"> </div>
<div class="line">    String video;</div>
<div class="line">    <span class="keywordflow">if</span>(parser.has(<span class="stringliteral">&quot;v&quot;</span>)) {</div>
<div class="line">        video = parser.get&lt;String&gt;(<span class="stringliteral">&quot;v&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(!parser.check()) {</div>
<div class="line">        parser.printErrors();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    aruco::ArucoDetector detector(dictionary, detectorParams);</div>
<div class="line">    VideoCapture inputVideo;</div>
<div class="line">    <span class="keywordtype">int</span> waitTime;</div>
<div class="line">    <span class="keywordflow">if</span>(!video.empty()) {</div>
<div class="line">        inputVideo.open(video);</div>
<div class="line">        waitTime = 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        inputVideo.open(camId);</div>
<div class="line">        waitTime = 10;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> axisLength = 0.5f * ((float)<a class="code hl_function" href="../../d2/de8/group__core__array.html#ga9af368f182ee76d0463d0d8d5330b764">min</a>(markersX, markersY) * (markerLength + markerSeparation) +</div>
<div class="line">                               markerSeparation);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create GridBoard object</span></div>
<div class="line">    aruco::GridBoard board(<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga346f563897249351a34549137c8532a0">Size</a>(markersX, markersY), markerLength, markerSeparation, dictionary);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Also you could create Board object</span></div>
<div class="line">    <span class="comment">//vector&lt;vector&lt;Point3f&gt; &gt; objPoints; // array of object points of all the marker corners in the board</span></div>
<div class="line">    <span class="comment">//vector&lt;int&gt; ids; // vector of the identifiers of the markers in the board</span></div>
<div class="line">    <span class="comment">//aruco::Board board(objPoints, dictionary, ids);</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> totalTime = 0;</div>
<div class="line">    <span class="keywordtype">int</span> totalIterations = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span>(inputVideo.grab()) {</div>
<div class="line">        Mat image, imageCopy;</div>
<div class="line">        inputVideo.retrieve(image);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">double</span> tick = (double)<a class="code hl_function" href="../../db/de0/group__core__utils.html#gae73f58000611a1af25dd36d496bf4487">getTickCount</a>();</div>
<div class="line"> </div>
<div class="line">        vector&lt;int&gt; ids;</div>
<div class="line">        vector&lt;vector&lt;Point2f&gt;&gt; corners, rejected;</div>
<div class="line">        <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga370d94209693b5b13437ab4991cabf73">Vec3d</a> rvec, tvec;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Detect markers</span></div>
<div class="line">        detector.detectMarkers(image, corners, ids, rejected);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Refind strategy to detect more markers</span></div>
<div class="line">        <span class="keywordflow">if</span>(refindStrategy)</div>
<div class="line">            detector.refineDetectedMarkers(image, board, corners, ids, rejected, camMatrix,</div>
<div class="line">                                           distCoeffs);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Estimate board pose</span></div>
<div class="line">        <span class="keywordtype">int</span> markersOfBoardDetected = 0;</div>
<div class="line">        <span class="keywordflow">if</span>(!ids.empty()) {</div>
<div class="line">            <span class="comment">// Get object and image points for the solvePnP function</span></div>
<div class="line">            <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a> objPoints, imgPoints;</div>
<div class="line">            board.matchImagePoints(corners, ids, objPoints, imgPoints);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Find pose</span></div>
<div class="line">            <a class="code hl_function" href="../../d9/d0c/group__calib3d.html#ga549c2075fac14829ff4a58bc931c033d">cv::solvePnP</a>(objPoints, imgPoints, camMatrix, distCoeffs, rvec, tvec);</div>
<div class="line"> </div>
<div class="line">            markersOfBoardDetected = (int)objPoints.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa4d317d43fb0cba9c2503f3c61b866c8">total</a>() / 4;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">double</span> currentTime = ((double)<a class="code hl_function" href="../../db/de0/group__core__utils.html#gae73f58000611a1af25dd36d496bf4487">getTickCount</a>() - tick) / <a class="code hl_function" href="../../db/de0/group__core__utils.html#ga705441a9ef01f47acdc55d87fbe5090c">getTickFrequency</a>();</div>
<div class="line">        totalTime += currentTime;</div>
<div class="line">        totalIterations++;</div>
<div class="line">        <span class="keywordflow">if</span>(totalIterations % 30 == 0) {</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;Detection Time = &quot;</span> &lt;&lt; currentTime * 1000 &lt;&lt; <span class="stringliteral">&quot; ms &quot;</span></div>
<div class="line">                 &lt;&lt; <span class="stringliteral">&quot;(Mean = &quot;</span> &lt;&lt; 1000 * totalTime / double(totalIterations) &lt;&lt; <span class="stringliteral">&quot; ms)&quot;</span> &lt;&lt; endl;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Draw results</span></div>
<div class="line">        image.copyTo(imageCopy);</div>
<div class="line">        <span class="keywordflow">if</span>(!ids.empty())</div>
<div class="line">            aruco::drawDetectedMarkers(imageCopy, corners, ids);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(showRejected &amp;&amp; !rejected.empty())</div>
<div class="line">            aruco::drawDetectedMarkers(imageCopy, rejected, <a class="code hl_function" href="../../dc/d84/group__core__basic.html#gad9287b23bba2fed753b36ef561ae7346">noArray</a>(), <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(100, 0, 255));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(markersOfBoardDetected &gt; 0)</div>
<div class="line">            <a class="code hl_function" href="../../d9/d0c/group__calib3d.html#gab3ab7bb2bdfe7d5d9745bb92d13f9564">cv::drawFrameAxes</a>(imageCopy, camMatrix, distCoeffs, rvec, tvec, axisLength);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;out&quot;</span>, imageCopy);</div>
<div class="line">        <span class="keywordtype">char</span> key = (char)<a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(waitTime);</div>
<div class="line">        <span class="keywordflow">if</span>(key == 27) <span class="keywordflow">break</span>;</div>
<div class="ttc" id="aclasscv_1_1Mat_html"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a></div><div class="ttdoc">n-dimensional dense array class</div><div class="ttdef"><b>Definition</b> mat.hpp:812</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_aa4d317d43fb0cba9c2503f3c61b866c8"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa4d317d43fb0cba9c2503f3c61b866c8">cv::Mat::total</a></div><div class="ttdeci">size_t total() const</div><div class="ttdoc">Returns the total number of array elements.</div></div>
<div class="ttc" id="agroup__calib3d_html_ga549c2075fac14829ff4a58bc931c033d"><div class="ttname"><a href="../../d9/d0c/group__calib3d.html#ga549c2075fac14829ff4a58bc931c033d">cv::solvePnP</a></div><div class="ttdeci">bool solvePnP(InputArray objectPoints, InputArray imagePoints, InputArray cameraMatrix, InputArray distCoeffs, OutputArray rvec, OutputArray tvec, bool useExtrinsicGuess=false, int flags=SOLVEPNP_ITERATIVE)</div><div class="ttdoc">Finds an object pose from 3D-2D point correspondences.</div></div>
<div class="ttc" id="agroup__calib3d_html_gab3ab7bb2bdfe7d5d9745bb92d13f9564"><div class="ttname"><a href="../../d9/d0c/group__calib3d.html#gab3ab7bb2bdfe7d5d9745bb92d13f9564">cv::drawFrameAxes</a></div><div class="ttdeci">void drawFrameAxes(InputOutputArray image, InputArray cameraMatrix, InputArray distCoeffs, InputArray rvec, InputArray tvec, float length, int thickness=3)</div><div class="ttdoc">Draw axes of the world/object coordinate system from pose estimation.</div></div>
<div class="ttc" id="agroup__core__array_html_ga9af368f182ee76d0463d0d8d5330b764"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga9af368f182ee76d0463d0d8d5330b764">cv::min</a></div><div class="ttdeci">void min(InputArray src1, InputArray src2, OutputArray dst)</div><div class="ttdoc">Calculates per-element minimum of two arrays or an array and a scalar.</div></div>
<div class="ttc" id="agroup__core__basic_html_ga346f563897249351a34549137c8532a0"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga346f563897249351a34549137c8532a0">cv::Size</a></div><div class="ttdeci">Size2i Size</div><div class="ttdef"><b>Definition</b> types.hpp:370</div></div>
<div class="ttc" id="agroup__core__basic_html_ga370d94209693b5b13437ab4991cabf73"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga370d94209693b5b13437ab4991cabf73">cv::Vec3d</a></div><div class="ttdeci">Vec&lt; double, 3 &gt; Vec3d</div><div class="ttdef"><b>Definition</b> matx.hpp:464</div></div>
<div class="ttc" id="agroup__core__basic_html_ga599fe92e910c027be274233eccad7beb"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">cv::Scalar</a></div><div class="ttdeci">Scalar_&lt; double &gt; Scalar</div><div class="ttdef"><b>Definition</b> types.hpp:702</div></div>
<div class="ttc" id="agroup__core__basic_html_gad9287b23bba2fed753b36ef561ae7346"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#gad9287b23bba2fed753b36ef561ae7346">cv::noArray</a></div><div class="ttdeci">InputOutputArray noArray()</div></div>
<div class="ttc" id="agroup__core__utils_html_ga705441a9ef01f47acdc55d87fbe5090c"><div class="ttname"><a href="../../db/de0/group__core__utils.html#ga705441a9ef01f47acdc55d87fbe5090c">cv::getTickFrequency</a></div><div class="ttdeci">double getTickFrequency()</div><div class="ttdoc">Returns the number of ticks per second.</div></div>
<div class="ttc" id="agroup__core__utils_html_gae73f58000611a1af25dd36d496bf4487"><div class="ttname"><a href="../../db/de0/group__core__utils.html#gae73f58000611a1af25dd36d496bf4487">cv::getTickCount</a></div><div class="ttdeci">int64 getTickCount()</div><div class="ttdoc">Returns the number of ticks.</div></div>
<div class="ttc" id="agroup__highgui_html_ga453d42fe4cb60e5723281a89973ee563"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv::imshow</a></div><div class="ttdeci">void imshow(const String &amp;winname, InputArray mat)</div><div class="ttdoc">Displays an image in the specified window.</div></div>
<div class="ttc" id="agroup__highgui_html_ga5628525ad33f52eab17feebcfba38bd7"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv::waitKey</a></div><div class="ttdeci">int waitKey(int delay=0)</div><div class="ttdoc">Waits for a pressed key.</div></div>
</div><!-- fragment --><p>The parameters are:</p>
<ul>
<li><code>objPoints</code>, <code>imgPoints</code> object and image points, matched with <code><a class="el" href="../../d4/db2/classcv_1_1aruco_1_1Board.html#a305c3c47c1f87562ed06de5c7e703e4f" title="Given a board configuration and a set of detected markers, returns the corresponding image points and...">cv::aruco::GridBoard::matchImagePoints()</a></code> which, in turn, takes as input <code>markerCorners</code> and <code>markerIds</code> structures of detected markers from <code><a class="el" href="../../d2/d1a/classcv_1_1aruco_1_1ArucoDetector.html#a0c1d14251bf1cbb06277f49cfe1c9b61" title="Basic marker detection.">cv::aruco::ArucoDetector::detectMarkers()</a></code> function.</li>
<li><code>board</code> the <code><a class="el" href="../../d4/db2/classcv_1_1aruco_1_1Board.html" title="Board of ArUco markers.">cv::aruco::Board</a></code> object that defines the board layout and its ids</li>
<li><code>cameraMatrix</code> and <code>distCoeffs</code>: camera calibration parameters necessary for pose estimation.</li>
<li><code>rvec</code> and <code>tvec</code>: estimated pose of the board. If not empty then treated as initial guess.</li>
<li>The function returns the total number of markers employed for estimating the board pose.</li>
</ul>
<p>The drawFrameAxes() function can be used to check the obtained pose. For instance:</p>
<div class="image">
<img src="../../gbmarkersaxis.jpg" alt=""/>
<div class="caption">
Board with axis</div></div>
    <p>And this is another example with the board partially occluded:</p>
<div class="image">
<img src="../../gbocclusion.jpg" alt=""/>
<div class="caption">
Board with occlusions</div></div>
    <p>As it can be observed, although some markers have not been detected, the board pose can still be estimated from the rest of markers.</p>
<p>Sample video:</p>
<div align='center'><iframe title='Video' width='560' height='349' src='https://www.youtube.com/embed/Q1HlJEjW_j0?rel=0' frameborder='0' align='middle' allowfullscreen></iframe></div><p>A full working example is included in the <code>detect_board.cpp</code> inside the <code>samples/cpp/tutorial_code/objectDetection/</code>.</p>
<p>The samples now take input via command line via the <code><a class="el" href="../../d0/d2e/classcv_1_1CommandLineParser.html" title="Designed for command line parsing.">cv::CommandLineParser</a></code>. For this file the example parameters will look like: </p><div class="fragment"><div class="line">-w=5 -h=7 -l=100 -s=10</div>
<div class="line">-v=/path_to_opencv/opencv/doc/tutorials/objdetect/aruco_board_detection/gboriginal.jpg</div>
<div class="line">-c=/path_to_opencv/opencv/samples/cpp/tutorial_code/objectDetection/tutorial_camera_params.yml</div>
<div class="line">-cd=/path_to_opencv/opencv/samples/cpp/tutorial_code/objectDetection/tutorial_dict.yml</div>
</div><!-- fragment --><p> Parameters for <code>detect_board.cpp</code>: </p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* keys  =</div>
<div class="line">        <span class="stringliteral">&quot;{w        |       | Number of squares in X direction }&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{h        |       | Number of squares in Y direction }&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{l        |       | Marker side length (in pixels) }&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{s        |       | Separation between two consecutive markers in the grid (in pixels)}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{d        |       | dictionary: DICT_4X4_50=0, DICT_4X4_100=1, DICT_4X4_250=2,&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;DICT_4X4_1000=3, DICT_5X5_50=4, DICT_5X5_100=5, DICT_5X5_250=6, DICT_5X5_1000=7, &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;DICT_6X6_50=8, DICT_6X6_100=9, DICT_6X6_250=10, DICT_6X6_1000=11, DICT_7X7_50=12,&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;DICT_7X7_100=13, DICT_7X7_250=14, DICT_7X7_1000=15, DICT_ARUCO_ORIGINAL = 16}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{cd       |       | Input file with custom dictionary }&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{c        |       | Output file with calibrated camera parameters }&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{v        |       | Input from video or image file, if omitted, input comes from camera }&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ci       | 0     | Camera id if input doesnt come from video (-v) }&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{dp       |       | File of marker detector parameters }&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{rs       |       | Apply refind strategy }&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{r        |       | show rejected candidates too }&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1045"></a>
Grid Board</h1>
<p>Creating the <code><a class="el" href="../../d4/db2/classcv_1_1aruco_1_1Board.html" title="Board of ArUco markers.">cv::aruco::Board</a></code> object requires specifying the corner positions for each marker in the environment. However, in many cases, the board will be just a set of markers in the same plane and in a grid layout, so it can be easily printed and used.</p>
<p>Fortunately, the aruco module provides the basic functionality to create and print these types of markers easily.</p>
<p>The <code><a class="el" href="../../de/d05/classcv_1_1aruco_1_1GridBoard.html" title="Planar board with grid arrangement of markers.">cv::aruco::GridBoard</a></code> class is a specialized class that inherits from the <code><a class="el" href="../../d4/db2/classcv_1_1aruco_1_1Board.html" title="Board of ArUco markers.">cv::aruco::Board</a></code> class and which represents a Board with all the markers in the same plane and in a grid layout, as in the following image:</p>
<div class="image">
<img src="../../gboriginal.jpg" alt=""/>
<div class="caption">
Image with aruco board</div></div>
    <p>Concretely, the coordinate system in a grid board is positioned in the board plane, centered in the bottom left corner of the board and with the Z pointing out, like in the following image (X:red, Y:green, Z:blue):</p>
<div class="image">
<img src="../../gbaxis.jpg" alt=""/>
<div class="caption">
Board with axis</div></div>
    <p>A <code><a class="el" href="../../de/d05/classcv_1_1aruco_1_1GridBoard.html" title="Planar board with grid arrangement of markers.">cv::aruco::GridBoard</a></code> object can be defined using the following parameters:</p>
<ul>
<li>Number of markers in the X direction.</li>
<li>Number of markers in the Y direction.</li>
<li>Length of the marker side.</li>
<li>Length of the marker separation.</li>
<li>The dictionary of the markers.</li>
<li>Ids of all the markers (X*Y markers).</li>
</ul>
<p>This object can be easily created from these parameters using the <code><a class="el" href="../../de/d05/classcv_1_1aruco_1_1GridBoard.html" title="Planar board with grid arrangement of markers.">cv::aruco::GridBoard</a></code> constructor:</p>
<div class="fragment"><div class="line">    aruco::GridBoard board(Size(markersX, markersY), markerLength, markerSeparation, dictionary);</div>
</div><!-- fragment --><ul>
<li>The first and second parameters are the number of markers in the X and Y direction respectively.</li>
<li>The third and fourth parameters are the marker length and the marker separation respectively. They can be provided in any unit, having in mind that the estimated pose for this board will be measured in the same units (in general, meters are used).</li>
<li>Finally, the dictionary of the markers is provided.</li>
</ul>
<p>So, this board will be composed by 5x7=35 markers. The ids of each of the markers are assigned, by default, in ascending order starting on 0, so they will be 0, 1, 2, ..., 34.</p>
<p>After creating a grid board, we probably want to print it and use it. There are two ways to do this:</p><ol type="1">
<li>By using the script <code>doc/patter_tools/gen_pattern.py</code>, see <a class="el" href="../../da/d0d/tutorial_camera_calibration_pattern.html">Create calibration pattern</a>.</li>
<li>By using the function <code><a class="el" href="../../d4/db2/classcv_1_1aruco_1_1Board.html#a25b6823cad11256f1043bfd0e51b7c14" title="Draw a planar board.">cv::aruco::GridBoard::generateImage()</a></code>.</li>
</ol>
<p>The function <code><a class="el" href="../../d4/db2/classcv_1_1aruco_1_1Board.html#a25b6823cad11256f1043bfd0e51b7c14" title="Draw a planar board.">cv::aruco::GridBoard::generateImage()</a></code> is provided in <a class="el" href="../../de/d05/classcv_1_1aruco_1_1GridBoard.html" title="Planar board with grid arrangement of markers.">cv::aruco::GridBoard</a> class and can be called by using the following code:</p>
<div class="fragment"><div class="line">    Mat boardImage;</div>
<div class="line">    board.generateImage(imageSize, boardImage, margins, borderBits);</div>
</div><!-- fragment --><ul>
<li>The first parameter is the size of the output image in pixels. In this case 600x500 pixels. If this is not proportional to the board dimensions, it will be centered on the image.</li>
<li><code>boardImage</code>: the output image with the board.</li>
<li>The third parameter is the (optional) margin in pixels, so none of the markers are touching the image border. In this case the margin is 10.</li>
<li>Finally, the size of the marker border, similarly to <code>generateImageMarker()</code> function. The default value is 1.</li>
</ul>
<p>A full working example of board creation is included in the <code>samples/cpp/tutorial_code/objectDetection/create_board.cpp</code></p>
<p>The output image will be something like this:</p>
<div class="image">
<img src="../../board.png" alt=""/>
</div>
    <p>The samples now take input via commandline via the <code><a class="el" href="../../d0/d2e/classcv_1_1CommandLineParser.html" title="Designed for command line parsing.">cv::CommandLineParser</a></code>. For this file the example parameters will look like: </p><div class="fragment"><div class="line"><span class="stringliteral">&quot;_output_path_/aboard.png&quot;</span> -w=5 -h=7 -l=100 -s=10 -d=10</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1046"></a>
Refine marker detection</h1>
<p>ArUco boards can also be used to improve the detection of markers. If we have detected a subset of the markers that belongs to the board, we can use these markers and the board layout information to try to find the markers that have not been previously detected.</p>
<p>This can be done using the <code><a class="el" href="../../d9/d6a/group__aruco.html#gaea8d14a37c7dd9abd55b58815368293d" title="refine detected markers">cv::aruco::refineDetectedMarkers()</a></code> function, which should be called after calling <code><a class="el" href="../../d2/d1a/classcv_1_1aruco_1_1ArucoDetector.html#a0c1d14251bf1cbb06277f49cfe1c9b61" title="Basic marker detection.">cv::aruco::ArucoDetector::detectMarkers()</a></code>.</p>
<p>The main parameters of this function are the original image where markers were detected, the board object, the detected marker corners, the detected marker ids and the rejected marker corners.</p>
<p>The rejected corners can be obtained from the <code><a class="el" href="../../d2/d1a/classcv_1_1aruco_1_1ArucoDetector.html#a0c1d14251bf1cbb06277f49cfe1c9b61" title="Basic marker detection.">cv::aruco::ArucoDetector::detectMarkers()</a></code> function and are also known as marker candidates. This candidates are square shapes that have been found in the original image but have failed to pass the identification step (i.e. their inner codification presents too many errors) and thus they have not been recognized as markers.</p>
<p>However, these candidates are sometimes actual markers that have not been correctly identified due to high noise in the image, very low resolution or other related problems that affect to the binary code extraction. The <code><a class="el" href="../../d2/d1a/classcv_1_1aruco_1_1ArucoDetector.html#ad806c9310cfc826a178b0aefdf09bab6" title="Refine not detected markers based on the already detected and the board layout.">cv::aruco::ArucoDetector::refineDetectedMarkers()</a></code> function finds correspondences between these candidates and the missing markers of the board. This search is based on two parameters:</p>
<ul>
<li>Distance between the candidate and the projection of the missing marker. To obtain these projections, it is necessary to have detected at least one marker of the board. The projections are obtained using the camera parameters (camera matrix and distortion coefficients) if they are provided. If not, the projections are obtained from local homography and only planar board are allowed (i.e. the Z coordinate of all the marker corners should be the same). The <code>minRepDistance</code> parameter in <code>refineDetectedMarkers()</code> determines the minimum euclidean distance between the candidate corners and the projected marker corners (default value 10).</li>
<li>Binary codification. If a candidate surpasses the minimum distance condition, its internal bits are analyzed again to determine if it is actually the projected marker or not. However, in this case, the condition is not so strong and the number of allowed erroneous bits can be higher. This is indicated in the <code>errorCorrectionRate</code> parameter (default value 3.0). If a negative value is provided, the internal bits are not analyzed at all and only the corner distances are evaluated.</li>
</ul>
<p>This is an example of using the <code><a class="el" href="../../d2/d1a/classcv_1_1aruco_1_1ArucoDetector.html#ad806c9310cfc826a178b0aefdf09bab6" title="Refine not detected markers based on the already detected and the board layout.">cv::aruco::ArucoDetector::refineDetectedMarkers()</a></code> function:</p>
<div class="fragment"><div class="line"> </div>
<div class="line">        <span class="comment">// Detect markers</span></div>
<div class="line">        detector.detectMarkers(image, corners, ids, rejected);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Refind strategy to detect more markers</span></div>
<div class="line">        <span class="keywordflow">if</span>(refindStrategy)</div>
<div class="line">            detector.refineDetectedMarkers(image, board, corners, ids, rejected, camMatrix,</div>
<div class="line">                                           distCoeffs);</div>
<div class="line"> </div>
</div><!-- fragment --><p>It must also be noted that, in some cases, if the number of detected markers in the first place is too low (for instance only 1 or 2 markers), the projections of the missing markers can be of bad quality, producing erroneous correspondences.</p>
<p>See module samples for a more detailed implementation. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 2 2024 21:52:14 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.8
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
