<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>OpenCV: Mask operations on matrices</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.10.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../de/d7a/tutorial_table_of_content_core.html">The Core Functionality (core module)</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Mask operations on matrices</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md317">Our test case</a></li>
<li class="level1"><a href="#autotoc_md318">Code</a></li>
<li class="level1"><a href="#autotoc_md319">The Basic Method</a></li>
<li class="level1"><a href="#autotoc_md320">The filter2D function</a></li>
</ul>
</div>
<div class="textblock"><p><b>Prev Tutorial:</b> <a class="el" href="../../db/da5/tutorial_how_to_scan_images.html">How to scan images, lookup tables and time measurement with OpenCV</a> <br  />
<b>Next Tutorial:</b> <a class="el" href="../../d5/d98/tutorial_mat_operations.html">Operations with images</a> <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight"></th><th class="markdownTableHeadLeft"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">Original author   </td><td class="markdownTableBodyLeft">Bernát Gábor    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">Compatibility   </td><td class="markdownTableBodyLeft">OpenCV &gt;= 3.0   </td></tr>
</table>
<p>Mask operations on matrices are quite simple. The idea is that we recalculate each pixel's value in an image according to a mask matrix (also known as kernel). This mask holds values that will adjust how much influence neighboring pixels (and the current pixel) have on the new pixel value. From a mathematical point of view we make a weighted average, with our specified values.</p>
<h1><a class="anchor" id="autotoc_md317"></a>
Our test case</h1>
<p>Let's consider the issue of an image contrast enhancement method. Basically we want to apply for every pixel of the image the following formula:</p>
<p class="formulaDsp">
\[I(i,j) = 5*I(i,j) - [ I(i-1,j) + I(i+1,j) + I(i,j-1) + I(i,j+1)]\]
</p>
 <p class="formulaDsp">
\[\iff I(i,j)*M, \text{where }
M = \bordermatrix{ _i\backslash ^j  &amp; -1 &amp;  0 &amp; +1 \cr
                     -1 &amp;  0 &amp; -1 &amp;  0 \cr
                      0 &amp; -1 &amp;  5 &amp; -1 \cr
                     +1 &amp;  0 &amp; -1 &amp;  0 \cr
                 }\]
</p>
<p>The first notation is by using a formula, while the second is a compacted version of the first by using a mask. You use the mask by putting the center of the mask matrix (in the upper case noted by the zero-zero index) on the pixel you want to calculate and sum up the pixel values multiplied with the overlapped matrix values. It's the same thing, however in case of large matrices the latter notation is a lot easier to look over.</p>
<h1><a class="anchor" id="autotoc_md318"></a>
Code</h1>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'><p> You can download this source code from <a href="https://raw.githubusercontent.com/opencv/opencv/4.x/samples/cpp/tutorial_code/core/mat_mask_operations/mat_mask_operations.cpp" target="_blank">here</a> or look in the OpenCV source code libraries sample directory at <code>samples/cpp/tutorial_code/core/mat_mask_operations/mat_mask_operations.cpp</code>. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d6/d87/imgcodecs_8hpp.html">opencv2/imgcodecs.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">opencv2/imgproc.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> help(<span class="keywordtype">char</span>* progName)</div>
<div class="line">{</div>
<div class="line">    cout &lt;&lt; endl</div>
<div class="line">        &lt;&lt;  <span class="stringliteral">&quot;This program shows how to filter images with mask: the write it yourself and the&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;filter2d way. &quot;</span> &lt;&lt; endl</div>
<div class="line">        &lt;&lt;  <span class="stringliteral">&quot;Usage:&quot;</span>                                                                        &lt;&lt; endl</div>
<div class="line">        &lt;&lt; progName &lt;&lt; <span class="stringliteral">&quot; [image_path -- default lena.jpg] [G -- grayscale] &quot;</span>        &lt;&lt; endl &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Sharpen(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; myImage,<a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; Result);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    help(argv[0]);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* filename = argc &gt;=2 ? argv[1] : <span class="stringliteral">&quot;lena.jpg&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> src, dst0, dst1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (argc &gt;= 3 &amp;&amp; !strcmp(<span class="stringliteral">&quot;G&quot;</span>, argv[2]))</div>
<div class="line">        src = imread( samples::findFile( filename ), IMREAD_GRAYSCALE);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        src = imread( samples::findFile( filename ), IMREAD_COLOR);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (src.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#abbec3525a852e77998aba034813fded4">empty</a>())</div>
<div class="line">    {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;Can&#39;t open image [&quot;</span>  &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    namedWindow(<span class="stringliteral">&quot;Input&quot;</span>, WINDOW_AUTOSIZE);</div>
<div class="line">    namedWindow(<span class="stringliteral">&quot;Output&quot;</span>, WINDOW_AUTOSIZE);</div>
<div class="line"> </div>
<div class="line">    imshow( <span class="stringliteral">&quot;Input&quot;</span>, src );</div>
<div class="line">    <span class="keywordtype">double</span> t = (double)getTickCount();</div>
<div class="line"> </div>
<div class="line">    Sharpen( src, dst0 );</div>
<div class="line"> </div>
<div class="line">    t = ((double)getTickCount() - t)/getTickFrequency();</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Hand written function time passed in seconds: &quot;</span> &lt;&lt; t &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">    imshow( <span class="stringliteral">&quot;Output&quot;</span>, dst0 );</div>
<div class="line">    waitKey();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> kernel = (<a class="code hl_class" href="../../df/dfc/classcv_1_1Mat__.html">Mat_&lt;char&gt;</a>(3,3) &lt;&lt;  0, -1,  0,</div>
<div class="line">                                   -1,  5, -1,</div>
<div class="line">                                    0, -1,  0);</div>
<div class="line"> </div>
<div class="line">    t = (double)getTickCount();</div>
<div class="line"> </div>
<div class="line">    filter2D( src, dst1, src.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8da9f853b6f3a29d738572fd1ffc44c0">depth</a>(), kernel );</div>
<div class="line">    t = ((double)getTickCount() - t)/getTickFrequency();</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Built-in filter2D time passed in seconds:     &quot;</span> &lt;&lt; t &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">    imshow( <span class="stringliteral">&quot;Output&quot;</span>, dst1 );</div>
<div class="line"> </div>
<div class="line">    waitKey();</div>
<div class="line">    <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> Sharpen(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; myImage,<a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; Result)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="../../db/de0/group__core__utils.html#gaf62bcd90f70e275191ab95136d85906b">CV_Assert</a>(myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8da9f853b6f3a29d738572fd1ffc44c0">depth</a>() == <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);  <span class="comment">// accept only uchar images</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nChannels = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa11336b9ac538e0475d840657ce164be">channels</a>();</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a55ced2c8d844d683ea9a725c60037ad0">create</a>(myImage.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(),myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#af2d2652e552d7de635988f18a84b53e5">type</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 1 ; j &lt; myImage.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>-1; ++j)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* previous = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j - 1);</div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* current  = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j    );</div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* next     = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j + 1);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* output = Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i= nChannels;i &lt; nChannels*(myImage.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>-1); ++i)</div>
<div class="line">        {</div>
<div class="line">            output[i] = saturate_cast&lt;uchar&gt;(5*current[i]</div>
<div class="line">                         -current[i-nChannels] - current[i+nChannels] - previous[i] - next[i]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">row</a>(0).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">row</a>(Result.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>-1).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a23df02a07ffbfa4aa59c19bc003919fe">col</a>(0).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a23df02a07ffbfa4aa59c19bc003919fe">col</a>(Result.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>-1).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">}</div>
<div class="ttc" id="aclasscv_1_1Mat___html"><div class="ttname"><a href="../../df/dfc/classcv_1_1Mat__.html">cv::Mat_</a></div><div class="ttdoc">Template matrix class derived from Mat.</div><div class="ttdef"><b>Definition</b> mat.hpp:2230</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a></div><div class="ttdoc">n-dimensional dense array class</div><div class="ttdef"><b>Definition</b> mat.hpp:812</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a030678ffd9ca6e12127b3fd1337bf6e2"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">cv::Mat::setTo</a></div><div class="ttdeci">Mat &amp; setTo(InputArray value, InputArray mask=noArray())</div><div class="ttdoc">Sets all or some of the array elements to the specified value.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a146f8e8dda07d1365a575ab83d9828d1"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">cv::Mat::size</a></div><div class="ttdeci">MatSize size</div><div class="ttdef"><b>Definition</b> mat.hpp:2160</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a23df02a07ffbfa4aa59c19bc003919fe"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a23df02a07ffbfa4aa59c19bc003919fe">cv::Mat::col</a></div><div class="ttdeci">Mat col(int x) const</div><div class="ttdoc">Creates a matrix header for the specified matrix column.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a4b22e1c23af7a7f2eef8fa478cfa7434"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">cv::Mat::row</a></div><div class="ttdeci">Mat row(int y) const</div><div class="ttdoc">Creates a matrix header for the specified matrix row.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a55ced2c8d844d683ea9a725c60037ad0"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a55ced2c8d844d683ea9a725c60037ad0">cv::Mat::create</a></div><div class="ttdeci">void create(int rows, int cols, int type)</div><div class="ttdoc">Allocates new array data if needed.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a8b2912f6a6f5d55a3c9a7aae9134d862"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">cv::Mat::ptr</a></div><div class="ttdeci">uchar * ptr(int i0=0)</div><div class="ttdoc">Returns a pointer to the specified matrix row.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a8da9f853b6f3a29d738572fd1ffc44c0"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a8da9f853b6f3a29d738572fd1ffc44c0">cv::Mat::depth</a></div><div class="ttdeci">int depth() const</div><div class="ttdoc">Returns the depth of a matrix element.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_aa11336b9ac538e0475d840657ce164be"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa11336b9ac538e0475d840657ce164be">cv::Mat::channels</a></div><div class="ttdeci">int channels() const</div><div class="ttdoc">Returns the number of matrix channels.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_aa3e5a47585c9ef6a0842556739155e3e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cv::Mat::cols</a></div><div class="ttdeci">int cols</div><div class="ttdef"><b>Definition</b> mat.hpp:2138</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_abbec3525a852e77998aba034813fded4"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abbec3525a852e77998aba034813fded4">cv::Mat::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Returns true if the array has no elements.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_abed816466c45234254d25bc59c31245e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">cv::Mat::rows</a></div><div class="ttdeci">int rows</div><div class="ttdoc">the number of rows and columns or (-1, -1) when the matrix has more than 2 dimensions</div><div class="ttdef"><b>Definition</b> mat.hpp:2138</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_af2d2652e552d7de635988f18a84b53e5"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#af2d2652e552d7de635988f18a84b53e5">cv::Mat::type</a></div><div class="ttdeci">int type() const</div><div class="ttdoc">Returns the type of a matrix element.</div></div>
<div class="ttc" id="aclasscv_1_1Scalar___html"><div class="ttname"><a href="../../d1/da0/classcv_1_1Scalar__.html">cv::Scalar_&lt; double &gt;</a></div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga32b18d904ee2b1731a9416a8eef67d06"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a></div><div class="ttdeci">#define CV_8U</div><div class="ttdef"><b>Definition</b> interface.h:73</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition</b> interface.h:51</div></div>
<div class="ttc" id="agroup__core__utils_html_gaf62bcd90f70e275191ab95136d85906b"><div class="ttname"><a href="../../db/de0/group__core__utils.html#gaf62bcd90f70e275191ab95136d85906b">CV_Assert</a></div><div class="ttdeci">#define CV_Assert(expr)</div><div class="ttdoc">Checks a condition at runtime and throws exception if it fails.</div><div class="ttdef"><b>Definition</b> base.hpp:342</div></div>
<div class="ttc" id="ahighgui_8hpp_html"><div class="ttname"><a href="../../d4/dd5/highgui_8hpp.html">highgui.hpp</a></div></div>
<div class="ttc" id="ahighgui__qt_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition</b> highgui_qt.cpp:3</div></div>
<div class="ttc" id="aimgcodecs_8hpp_html"><div class="ttname"><a href="../../d6/d87/imgcodecs_8hpp.html">imgcodecs.hpp</a></div></div>
<div class="ttc" id="aimgproc_2include_2opencv2_2imgproc_8hpp_html"><div class="ttname"><a href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="anamespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdoc">&quot;black box&quot; representation of the file storage associated with a file on disk.</div><div class="ttdef"><b>Definition</b> core.hpp:102</div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace.</div></div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'><p> You can download this source code from <a href="https://raw.githubusercontent.com/opencv/opencv/4.x/samples/java/tutorial_code/core/mat_mask_operations/MatMaskOperations.java" target="_blank">here</a> or look in the OpenCV source code libraries sample directory at <code>samples/java/tutorial_code/core/mat_mask_operations/MatMaskOperations.java</code>. </p><div class="fragment"><div class="line"><span class="keyword">import</span> org.opencv.core.Core;</div>
<div class="line"><span class="keyword">import</span> org.opencv.core.CvType;</div>
<div class="line"><span class="keyword">import</span> org.opencv.core.Mat;</div>
<div class="line"><span class="keyword">import</span> org.opencv.core.Scalar;</div>
<div class="line"><span class="keyword">import</span> org.opencv.highgui.HighGui;</div>
<div class="line"><span class="keyword">import</span> org.opencv.imgcodecs.Imgcodecs;</div>
<div class="line"><span class="keyword">import</span> org.opencv.imgproc.Imgproc;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MatMaskOperationsRun {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> run(String[] args) {</div>
<div class="line"> </div>
<div class="line">        String filename = <span class="stringliteral">&quot;../data/lena.jpg&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> img_codec = Imgcodecs.IMREAD_COLOR;</div>
<div class="line">        <span class="keywordflow">if</span> (args.length != 0) {</div>
<div class="line">            filename = args[0];</div>
<div class="line">            <span class="keywordflow">if</span> (args.length &gt;= 2 &amp;&amp; args[1].equals(<span class="stringliteral">&quot;G&quot;</span>))</div>
<div class="line">                img_codec = Imgcodecs.IMREAD_GRAYSCALE;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        Mat src = Imgcodecs.imread(filename, img_codec);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (src.empty()) {</div>
<div class="line">            System.out.println(<span class="stringliteral">&quot;Can&#39;t open image [&quot;</span> + filename + <span class="stringliteral">&quot;]&quot;</span>);</div>
<div class="line">            System.out.println(<span class="stringliteral">&quot;Program Arguments: [image_path -- default ../data/lena.jpg] [G -- grayscale]&quot;</span>);</div>
<div class="line">            System.exit(-1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        HighGui.namedWindow(<span class="stringliteral">&quot;Input&quot;</span>, HighGui.WINDOW_AUTOSIZE);</div>
<div class="line">        HighGui.namedWindow(<span class="stringliteral">&quot;Output&quot;</span>, HighGui.WINDOW_AUTOSIZE);</div>
<div class="line"> </div>
<div class="line">        HighGui.imshow( <span class="stringliteral">&quot;Input&quot;</span>, src );</div>
<div class="line">        <span class="keywordtype">double</span> t = System.currentTimeMillis();</div>
<div class="line"> </div>
<div class="line">        Mat dst0 = sharpen(src, <span class="keyword">new</span> Mat());</div>
<div class="line"> </div>
<div class="line">        t = ((double) System.currentTimeMillis() - t) / 1000;</div>
<div class="line">        System.out.println(<span class="stringliteral">&quot;Hand written function time passed in seconds: &quot;</span> + t);</div>
<div class="line"> </div>
<div class="line">        HighGui.imshow( <span class="stringliteral">&quot;Output&quot;</span>, dst0 );</div>
<div class="line">        HighGui.moveWindow(<span class="stringliteral">&quot;Output&quot;</span>, 400, 400);</div>
<div class="line">        HighGui.waitKey();</div>
<div class="line"> </div>
<div class="line">        Mat kern = <span class="keyword">new</span> Mat(3, 3, CvType.CV_8S);</div>
<div class="line">        <span class="keywordtype">int</span> row = 0, col = 0;</div>
<div class="line">        kern.put(row, col, 0, -1, 0, -1, 5, -1, 0, -1, 0);</div>
<div class="line"> </div>
<div class="line">        t = System.currentTimeMillis();</div>
<div class="line"> </div>
<div class="line">        Mat dst1 = <span class="keyword">new</span> Mat();</div>
<div class="line">        Imgproc.filter2D(src, dst1, src.depth(), kern);</div>
<div class="line">        t = ((double) System.currentTimeMillis() - t) / 1000;</div>
<div class="line">        System.out.println(<span class="stringliteral">&quot;Built-in filter2D time passed in seconds:     &quot;</span> + t);</div>
<div class="line"> </div>
<div class="line">        HighGui.imshow( <span class="stringliteral">&quot;Output&quot;</span>, dst1 );</div>
<div class="line"> </div>
<div class="line">        HighGui.waitKey();</div>
<div class="line">        System.exit(0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">double</span> saturate(<span class="keywordtype">double</span> x) {</div>
<div class="line">        <span class="keywordflow">return</span> x &gt; 255.0 ? 255.0 : (x &lt; 0.0 ? 0.0 : x);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> Mat sharpen(Mat myImage, Mat Result) {</div>
<div class="line">        myImage.convertTo(myImage, CvType.CV_8U);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> nChannels = myImage.channels();</div>
<div class="line">        Result.create(myImage.size(), myImage.type());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; myImage.rows() - 1; ++j) {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; myImage.cols() - 1; ++i) {</div>
<div class="line">                <span class="keywordtype">double</span> <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga716e10a2dd9e228e4d3c95818f106722">sum</a>[] = <span class="keyword">new</span> <span class="keywordtype">double</span>[nChannels];</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; nChannels; ++k) {</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordtype">double</span> top = -myImage.get(j - 1, i)[k];</div>
<div class="line">                    <span class="keywordtype">double</span> bottom = -myImage.get(j + 1, i)[k];</div>
<div class="line">                    <span class="keywordtype">double</span> center = (5 * myImage.get(j, i)[k]);</div>
<div class="line">                    <span class="keywordtype">double</span> left = -myImage.get(j, i - 1)[k];</div>
<div class="line">                    <span class="keywordtype">double</span> right = -myImage.get(j, i + 1)[k];</div>
<div class="line"> </div>
<div class="line">                    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga716e10a2dd9e228e4d3c95818f106722">sum</a>[k] = saturate(top + bottom + center + left + right);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                Result.put(j, i, sum);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        Result.row(0).setTo(<span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line">        Result.row(Result.rows() - 1).setTo(<span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line">        Result.col(0).setTo(<span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line">        Result.col(Result.cols() - 1).setTo(<span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> Result;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>MatMaskOperations {</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(String[] args) {</div>
<div class="line">        <span class="comment">// Load the native library.</span></div>
<div class="line">        System.loadLibrary(Core.NATIVE_LIBRARY_NAME);</div>
<div class="line">        <span class="keyword">new</span> MatMaskOperationsRun().run(args);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__core__array_html_ga716e10a2dd9e228e4d3c95818f106722"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga716e10a2dd9e228e4d3c95818f106722">cv::sum</a></div><div class="ttdeci">Scalar sum(InputArray src)</div><div class="ttdoc">Calculates the sum of array elements.</div></div>
<div class="ttc" id="agroup__core__basic_html_ga599fe92e910c027be274233eccad7beb"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">cv::Scalar</a></div><div class="ttdeci">Scalar_&lt; double &gt; Scalar</div><div class="ttdef"><b>Definition</b> types.hpp:702</div></div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'><p> You can download this source code from <a href="https://raw.githubusercontent.com/opencv/opencv/4.x/samples/python/tutorial_code/core/mat_mask_operations/mat_mask_operations.py" target="_blank">here</a> or look in the OpenCV source code libraries sample directory at <code>samples/python/tutorial_code/core/mat_mask_operations/mat_mask_operations.py</code>. </p><div class="fragment"><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</div>
<div class="line"><span class="keyword">import</span> sys</div>
<div class="line"><span class="keyword">import</span> time</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>is_grayscale(my_image):</div>
<div class="line">    <span class="keywordflow">return</span> len(my_image.shape) &lt; 3</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>saturated(sum_value):</div>
<div class="line">    <span class="keywordflow">if</span> sum_value &gt; 255:</div>
<div class="line">        sum_value = 255</div>
<div class="line">    <span class="keywordflow">if</span> sum_value &lt; 0:</div>
<div class="line">        sum_value = 0</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> sum_value</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>sharpen(my_image):</div>
<div class="line">    <span class="keywordflow">if</span> is_grayscale(my_image):</div>
<div class="line">        height, width = my_image.shape</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        my_image = <a class="code hl_function" href="../../d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cv.cvtColor</a>(my_image, cv.CV_8U)</div>
<div class="line">        height, width, n_channels = my_image.shape</div>
<div class="line"> </div>
<div class="line">    result = np.zeros(my_image.shape, my_image.dtype)</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(1, height - 1):</div>
<div class="line">        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, width - 1):</div>
<div class="line">            <span class="keywordflow">if</span> is_grayscale(my_image):</div>
<div class="line">                sum_value = 5 * my_image[j, i] - my_image[j + 1, i] - my_image[j - 1, i] \</div>
<div class="line">                            - my_image[j, i + 1] - my_image[j, i - 1]</div>
<div class="line">                result[j, i] = saturated(sum_value)</div>
<div class="line">            <span class="keywordflow">else</span>:</div>
<div class="line">                <span class="keywordflow">for</span> k <span class="keywordflow">in</span> range(0, n_channels):</div>
<div class="line">                    sum_value = 5 * my_image[j, i, k] - my_image[j + 1, i, k]  \</div>
<div class="line">                                - my_image[j - 1, i, k] - my_image[j, i + 1, k]\</div>
<div class="line">                                - my_image[j, i - 1, k]</div>
<div class="line">                    result[j, i, k] = saturated(sum_value)</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> result</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span><a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(argv):</div>
<div class="line">    filename = <span class="stringliteral">&#39;lena.jpg&#39;</span></div>
<div class="line"> </div>
<div class="line">    img_codec = cv.IMREAD_COLOR</div>
<div class="line">    <span class="keywordflow">if</span> argv:</div>
<div class="line">        filename = sys.argv[1]</div>
<div class="line">        <span class="keywordflow">if</span> len(argv) &gt;= 2 <span class="keywordflow">and</span> sys.argv[2] == <span class="stringliteral">&quot;G&quot;</span>:</div>
<div class="line">            img_codec = cv.IMREAD_GRAYSCALE</div>
<div class="line"> </div>
<div class="line">    src = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv.imread</a>(<a class="code hl_function" href="../../d6/dba/group__core__utils__samples.html#ga3a33b00033b46c698ff6340d95569c13">cv.samples.findFile</a>(filename), img_codec)</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> src <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line">        print(<span class="stringliteral">&quot;Can&#39;t open image [&quot;</span> + filename + <span class="stringliteral">&quot;]&quot;</span>)</div>
<div class="line">        print(<span class="stringliteral">&quot;Usage:&quot;</span>)</div>
<div class="line">        print(<span class="stringliteral">&quot;mat_mask_operations.py [image_path -- default lena.jpg] [G -- grayscale]&quot;</span>)</div>
<div class="line">        <span class="keywordflow">return</span> -1</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">cv.namedWindow</a>(<span class="stringliteral">&quot;Input&quot;</span>, cv.WINDOW_AUTOSIZE)</div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">cv.namedWindow</a>(<span class="stringliteral">&quot;Output&quot;</span>, cv.WINDOW_AUTOSIZE)</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(<span class="stringliteral">&quot;Input&quot;</span>, src)</div>
<div class="line">    t = round(time.time())</div>
<div class="line"> </div>
<div class="line">    dst0 = sharpen(src)</div>
<div class="line"> </div>
<div class="line">    t = (time.time() - t)</div>
<div class="line">    print(<span class="stringliteral">&quot;Hand written function time passed in seconds: %s&quot;</span> % t)</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(<span class="stringliteral">&quot;Output&quot;</span>, dst0)</div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv.waitKey</a>()</div>
<div class="line"> </div>
<div class="line">    t = time.time()</div>
<div class="line">    </div>
<div class="line">    kernel = np.array([[0, -1, 0],</div>
<div class="line">                       [-1, 5, -1],</div>
<div class="line">                       [0, -1, 0]], np.float32)  <span class="comment"># kernel should be floating point type</span></div>
<div class="line">    </div>
<div class="line">    dst1 = <a class="code hl_function" href="../../d4/d86/group__imgproc__filter.html#ga27c049795ce870216ddfb366086b5a04">cv.filter2D</a>(src, -1, kernel)</div>
<div class="line">    <span class="comment"># ddepth = -1, means destination image has depth same as input image</span></div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    t = (time.time() - t)</div>
<div class="line">    print(<span class="stringliteral">&quot;Built-in filter2D time passed in seconds:     %s&quot;</span> % t)</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(<span class="stringliteral">&quot;Output&quot;</span>, dst1)</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv.waitKey</a>(0)</div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga6b7fc1c1a8960438156912027b38f481">cv.destroyAllWindows</a>()</div>
<div class="line">    <span class="keywordflow">return</span> 0</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(sys.argv[1:])</div>
<div class="ttc" id="agroup__core__utils__samples_html_ga3a33b00033b46c698ff6340d95569c13"><div class="ttname"><a href="../../d6/dba/group__core__utils__samples.html#ga3a33b00033b46c698ff6340d95569c13">cv::samples::findFile</a></div><div class="ttdeci">cv::String findFile(const cv::String &amp;relative_path, bool required=true, bool silentMode=false)</div><div class="ttdoc">Try to find requested data file.</div></div>
<div class="ttc" id="agroup__highgui_html_ga453d42fe4cb60e5723281a89973ee563"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv::imshow</a></div><div class="ttdeci">void imshow(const String &amp;winname, InputArray mat)</div><div class="ttdoc">Displays an image in the specified window.</div></div>
<div class="ttc" id="agroup__highgui_html_ga5628525ad33f52eab17feebcfba38bd7"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv::waitKey</a></div><div class="ttdeci">int waitKey(int delay=0)</div><div class="ttdoc">Waits for a pressed key.</div></div>
<div class="ttc" id="agroup__highgui_html_ga5afdf8410934fd099df85c75b2e0888b"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">cv::namedWindow</a></div><div class="ttdeci">void namedWindow(const String &amp;winname, int flags=WINDOW_AUTOSIZE)</div><div class="ttdoc">Creates a window.</div></div>
<div class="ttc" id="agroup__highgui_html_ga6b7fc1c1a8960438156912027b38f481"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga6b7fc1c1a8960438156912027b38f481">cv::destroyAllWindows</a></div><div class="ttdeci">void destroyAllWindows()</div><div class="ttdoc">Destroys all of the HighGUI windows.</div></div>
<div class="ttc" id="agroup__imgcodecs_html_gab32ee19e22660912565f8140d0f675a8"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv::imread</a></div><div class="ttdeci">CV_EXPORTS_W Mat imread(const String &amp;filename, int flags=IMREAD_COLOR)</div><div class="ttdoc">Loads an image from a file.</div></div>
<div class="ttc" id="agroup__imgproc__color__conversions_html_ga397ae87e1288a81d2363b61574eb8cab"><div class="ttname"><a href="../../d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cv::cvtColor</a></div><div class="ttdeci">void cvtColor(InputArray src, OutputArray dst, int code, int dstCn=0)</div><div class="ttdoc">Converts an image from one color space to another.</div></div>
<div class="ttc" id="agroup__imgproc__filter_html_ga27c049795ce870216ddfb366086b5a04"><div class="ttname"><a href="../../d4/d86/group__imgproc__filter.html#ga27c049795ce870216ddfb366086b5a04">cv::filter2D</a></div><div class="ttdeci">void filter2D(InputArray src, OutputArray dst, int ddepth, InputArray kernel, Point anchor=Point(-1,-1), double delta=0, int borderType=BORDER_DEFAULT)</div><div class="ttdoc">Convolves an image with the kernel.</div></div>
</div><!-- fragment -->  </div> <h1><a class="anchor" id="autotoc_md319"></a>
The Basic Method</h1>
<p>Now let us see how we can make this happen by using the basic pixel access method or by using the <b>filter2D()</b> function.</p>
<p>Here's a function that will do this: </p> <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line"><span class="keywordtype">void</span> Sharpen(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; myImage,<a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; Result)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="../../db/de0/group__core__utils.html#gaf62bcd90f70e275191ab95136d85906b">CV_Assert</a>(myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8da9f853b6f3a29d738572fd1ffc44c0">depth</a>() == <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);  <span class="comment">// accept only uchar images</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nChannels = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa11336b9ac538e0475d840657ce164be">channels</a>();</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a55ced2c8d844d683ea9a725c60037ad0">create</a>(myImage.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(),myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#af2d2652e552d7de635988f18a84b53e5">type</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 1 ; j &lt; myImage.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>-1; ++j)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* previous = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j - 1);</div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* current  = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j    );</div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* next     = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j + 1);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* output = Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i= nChannels;i &lt; nChannels*(myImage.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>-1); ++i)</div>
<div class="line">        {</div>
<div class="line">            output[i] = saturate_cast&lt;uchar&gt;(5*current[i]</div>
<div class="line">                         -current[i-nChannels] - current[i+nChannels] - previous[i] - next[i]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">row</a>(0).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">row</a>(Result.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>-1).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a23df02a07ffbfa4aa59c19bc003919fe">col</a>(0).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a23df02a07ffbfa4aa59c19bc003919fe">col</a>(Result.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>-1).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">}</div>
</div><!-- fragment --><p>At first we make sure that the input images data is in unsigned char format. For this we use the <a class="el" href="../../db/de0/group__core__utils.html#gaf62bcd90f70e275191ab95136d85906b">CV_Assert</a> function (macro) that throws an error when the expression inside it is false. </p><div class="fragment"><div class="line">    <a class="code hl_define" href="../../db/de0/group__core__utils.html#gaf62bcd90f70e275191ab95136d85906b">CV_Assert</a>(myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8da9f853b6f3a29d738572fd1ffc44c0">depth</a>() == <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);  <span class="comment">// accept only uchar images</span></div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">double</span> saturate(<span class="keywordtype">double</span> x) {</div>
<div class="line">        <span class="keywordflow">return</span> x &gt; 255.0 ? 255.0 : (x &lt; 0.0 ? 0.0 : x);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> Mat sharpen(Mat myImage, Mat Result) {</div>
<div class="line">        myImage.convertTo(myImage, CvType.CV_8U);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> nChannels = myImage.channels();</div>
<div class="line">        Result.create(myImage.size(), myImage.type());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; myImage.rows() - 1; ++j) {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; myImage.cols() - 1; ++i) {</div>
<div class="line">                <span class="keywordtype">double</span> sum[] = <span class="keyword">new</span> <span class="keywordtype">double</span>[nChannels];</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; nChannels; ++k) {</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordtype">double</span> top = -myImage.get(j - 1, i)[k];</div>
<div class="line">                    <span class="keywordtype">double</span> bottom = -myImage.get(j + 1, i)[k];</div>
<div class="line">                    <span class="keywordtype">double</span> center = (5 * myImage.get(j, i)[k]);</div>
<div class="line">                    <span class="keywordtype">double</span> left = -myImage.get(j, i - 1)[k];</div>
<div class="line">                    <span class="keywordtype">double</span> right = -myImage.get(j, i + 1)[k];</div>
<div class="line"> </div>
<div class="line">                    sum[k] = saturate(top + bottom + center + left + right);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                Result.put(j, i, sum);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        Result.row(0).setTo(<span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line">        Result.row(Result.rows() - 1).setTo(<span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line">        Result.col(0).setTo(<span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line">        Result.col(Result.cols() - 1).setTo(<span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> Result;</div>
<div class="line">    }</div>
</div><!-- fragment --><p>At first we make sure that the input images data in unsigned 8 bit format. </p><div class="fragment"><div class="line">        myImage.convertTo(myImage, CvType.CV_8U);</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line"><span class="keyword">def </span>is_grayscale(my_image):</div>
<div class="line">    <span class="keywordflow">return</span> len(my_image.shape) &lt; 3</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>saturated(sum_value):</div>
<div class="line">    <span class="keywordflow">if</span> sum_value &gt; 255:</div>
<div class="line">        sum_value = 255</div>
<div class="line">    <span class="keywordflow">if</span> sum_value &lt; 0:</div>
<div class="line">        sum_value = 0</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> sum_value</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>sharpen(my_image):</div>
<div class="line">    <span class="keywordflow">if</span> is_grayscale(my_image):</div>
<div class="line">        height, width = my_image.shape</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        my_image = <a class="code hl_function" href="../../d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cv.cvtColor</a>(my_image, cv.CV_8U)</div>
<div class="line">        height, width, n_channels = my_image.shape</div>
<div class="line"> </div>
<div class="line">    result = np.zeros(my_image.shape, my_image.dtype)</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(1, height - 1):</div>
<div class="line">        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, width - 1):</div>
<div class="line">            <span class="keywordflow">if</span> is_grayscale(my_image):</div>
<div class="line">                sum_value = 5 * my_image[j, i] - my_image[j + 1, i] - my_image[j - 1, i] \</div>
<div class="line">                            - my_image[j, i + 1] - my_image[j, i - 1]</div>
<div class="line">                result[j, i] = saturated(sum_value)</div>
<div class="line">            <span class="keywordflow">else</span>:</div>
<div class="line">                <span class="keywordflow">for</span> k <span class="keywordflow">in</span> range(0, n_channels):</div>
<div class="line">                    sum_value = 5 * my_image[j, i, k] - my_image[j + 1, i, k]  \</div>
<div class="line">                                - my_image[j - 1, i, k] - my_image[j, i + 1, k]\</div>
<div class="line">                                - my_image[j, i - 1, k]</div>
<div class="line">                    result[j, i, k] = saturated(sum_value)</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> result</div>
</div><!-- fragment --><p>At first we make sure that the input images data in unsigned 8 bit format. </p><div class="fragment"><div class="line">my_image = <a class="code hl_function" href="../../d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cv.cvtColor</a>(my_image, cv.CV_8U)</div>
</div><!-- fragment --> </div> <p>We create an output image with the same size and the same type as our input. As you can see in the <a class="el" href="../../db/da5/tutorial_how_to_scan_images.html#tutorial_how_to_scan_images_storing">storing</a> section, depending on the number of channels we may have one or more subcolumns.</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'><p> We will iterate through them via pointers so the total number of elements depends on this number. </p><div class="fragment"><div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nChannels = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa11336b9ac538e0475d840657ce164be">channels</a>();</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a55ced2c8d844d683ea9a725c60037ad0">create</a>(myImage.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(),myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#af2d2652e552d7de635988f18a84b53e5">type</a>());</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line">        <span class="keywordtype">int</span> nChannels = myImage.channels();</div>
<div class="line">        Result.create(myImage.size(), myImage.type());</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">height, width, n_channels = my_image.shape</div>
<div class="line">result = np.zeros(my_image.shape, my_image.dtype)</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'><p> We'll use the plain C [] operator to access pixels. Because we need to access multiple rows at the same time we'll acquire the pointers for each of them (a previous, a current and a next line). We need another pointer to where we're going to save the calculation. Then simply access the right items with the [] operator. For moving the output pointer ahead we simply increase this (with one byte) after each operation: </p><div class="fragment"><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 1 ; j &lt; myImage.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>-1; ++j)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* previous = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j - 1);</div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* current  = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j    );</div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* next     = myImage.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j + 1);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>* output = Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8b2912f6a6f5d55a3c9a7aae9134d862">ptr</a>&lt;<a class="code hl_typedef" href="../../d1/d1b/group__core__hal__interface.html#ga65f85814a8290f9797005d3b28e7e5fc">uchar</a>&gt;(j);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i= nChannels;i &lt; nChannels*(myImage.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>-1); ++i)</div>
<div class="line">        {</div>
<div class="line">            output[i] = saturate_cast&lt;uchar&gt;(5*current[i]</div>
<div class="line">                         -current[i-nChannels] - current[i+nChannels] - previous[i] - next[i]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p>On the borders of the image the upper notation results inexistent pixel locations (like minus one - minus one). In these points our formula is undefined. A simple solution is to not apply the kernel in these points and, for example, set the pixels on the borders to zeros:</p>
<div class="fragment"><div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">row</a>(0).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">row</a>(Result.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>-1).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a23df02a07ffbfa4aa59c19bc003919fe">col</a>(0).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    Result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a23df02a07ffbfa4aa59c19bc003919fe">col</a>(Result.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>-1).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a030678ffd9ca6e12127b3fd1337bf6e2">setTo</a>(<a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'><p> We need to access multiple rows and columns which can be done by adding or subtracting 1 to the current center (i,j). Then we apply the sum and put the new value in the Result matrix. </p><div class="fragment"><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; myImage.rows() - 1; ++j) {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; myImage.cols() - 1; ++i) {</div>
<div class="line">                <span class="keywordtype">double</span> sum[] = <span class="keyword">new</span> <span class="keywordtype">double</span>[nChannels];</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; nChannels; ++k) {</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordtype">double</span> top = -myImage.get(j - 1, i)[k];</div>
<div class="line">                    <span class="keywordtype">double</span> bottom = -myImage.get(j + 1, i)[k];</div>
<div class="line">                    <span class="keywordtype">double</span> center = (5 * myImage.get(j, i)[k]);</div>
<div class="line">                    <span class="keywordtype">double</span> left = -myImage.get(j, i - 1)[k];</div>
<div class="line">                    <span class="keywordtype">double</span> right = -myImage.get(j, i + 1)[k];</div>
<div class="line"> </div>
<div class="line">                    sum[k] = saturate(top + bottom + center + left + right);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                Result.put(j, i, sum);</div>
<div class="line">            }</div>
<div class="line">        }</div>
</div><!-- fragment --><p>On the borders of the image the upper notation results in inexistent pixel locations (like (-1,-1)). In these points our formula is undefined. A simple solution is to not apply the kernel in these points and, for example, set the pixels on the borders to zeros:</p>
<div class="fragment"><div class="line">        Result.row(0).setTo(<span class="keyword">new</span> Scalar(0));</div>
<div class="line">        Result.row(Result.rows() - 1).setTo(<span class="keyword">new</span> Scalar(0));</div>
<div class="line">        Result.col(0).setTo(<span class="keyword">new</span> Scalar(0));</div>
<div class="line">        Result.col(Result.cols() - 1).setTo(<span class="keyword">new</span> Scalar(0));</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'><p> We need to access multiple rows and columns which can be done by adding or subtracting 1 to the current center (i,j). Then we apply the sum and put the new value in the Result matrix. </p><div class="fragment"><div class="line">    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(1, height - 1):</div>
<div class="line">        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, width - 1):</div>
<div class="line">            <span class="keywordflow">if</span> is_grayscale(my_image):</div>
<div class="line">                sum_value = 5 * my_image[j, i] - my_image[j + 1, i] - my_image[j - 1, i] \</div>
<div class="line">                            - my_image[j, i + 1] - my_image[j, i - 1]</div>
<div class="line">                result[j, i] = saturated(sum_value)</div>
<div class="line">            <span class="keywordflow">else</span>:</div>
<div class="line">                <span class="keywordflow">for</span> k <span class="keywordflow">in</span> range(0, n_channels):</div>
<div class="line">                    sum_value = 5 * my_image[j, i, k] - my_image[j + 1, i, k]  \</div>
<div class="line">                                - my_image[j - 1, i, k] - my_image[j, i + 1, k]\</div>
<div class="line">                                - my_image[j, i - 1, k]</div>
<div class="line">                    result[j, i, k] = saturated(sum_value)</div>
</div><!-- fragment -->  </div> <h1><a class="anchor" id="autotoc_md320"></a>
The filter2D function</h1>
<p>Applying such filters are so common in image processing that in OpenCV there is a function that will take care of applying the mask (also called a kernel in some places). For this you first need to define an object that holds the mask:</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> kernel = (<a class="code hl_class" href="../../df/dfc/classcv_1_1Mat__.html">Mat_&lt;char&gt;</a>(3,3) &lt;&lt;  0, -1,  0,</div>
<div class="line">                                   -1,  5, -1,</div>
<div class="line">                                    0, -1,  0);</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line">        Mat kern = <span class="keyword">new</span> Mat(3, 3, CvType.CV_8S);</div>
<div class="line">        <span class="keywordtype">int</span> row = 0, col = 0;</div>
<div class="line">        kern.put(row, col, 0, -1, 0, -1, 5, -1, 0, -1, 0);</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">    kernel = np.array([[0, -1, 0],</div>
<div class="line">                       [-1, 5, -1],</div>
<div class="line">                       [0, -1, 0]], np.float32)  <span class="comment"># kernel should be floating point type</span></div>
</div><!-- fragment -->  </div> <p>Then call the <b>filter2D()</b> function specifying the input, the output image and the kernel to use:</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line">    filter2D( src, dst1, src.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a8da9f853b6f3a29d738572fd1ffc44c0">depth</a>(), kernel );</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line">        Imgproc.filter2D(src, dst1, src.depth(), kern);</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">    dst1 = <a class="code hl_function" href="../../d4/d86/group__imgproc__filter.html#ga27c049795ce870216ddfb366086b5a04">cv.filter2D</a>(src, -1, kernel)</div>
<div class="line">    <span class="comment"># ddepth = -1, means destination image has depth same as input image</span></div>
</div><!-- fragment -->  </div> <p>The function even has a fifth optional argument to specify the center of the kernel, a sixth for adding an optional value to the filtered pixels before storing them in K and a seventh one for determining what to do in the regions where the operation is undefined (borders).</p>
<p>This function is shorter, less verbose and, because there are some optimizations, it is usually faster than the <em>hand-coded method</em>. For example in my test while the second one took only 13 milliseconds the first took around 31 milliseconds. Quite some difference.</p>
<p>For example:</p>
<div class="image">
<img src="../../resultMatMaskFilter2D.png" alt=""/>
</div>
     <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'><p> Check out an instance of running the program on our <a href="http://www.youtube.com/watch?v=7PF1tAU9se4" target="_blank">YouTube channel</a> . </p><div align='center'><iframe title='Video' width='560' height='349' src='https://www.youtube.com/embed/7PF1tAU9se4?rel=0' frameborder='0' align='middle' allowfullscreen></iframe></div>  </div>  </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 2 2024 21:52:13 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.8
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
