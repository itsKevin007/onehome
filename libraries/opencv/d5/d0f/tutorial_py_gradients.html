<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>OpenCV: Image Gradients</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.10.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d6/d00/tutorial_py_root.html">OpenCV-Python Tutorials</a></li><li class="navelem"><a class="el" href="../../d2/d96/tutorial_py_table_of_contents_imgproc.html">Image Processing in OpenCV</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Image Gradients</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1383"></a>
Goal</h1>
<p>In this chapter, we will learn to:</p>
<ul>
<li>Find Image gradients, edges etc</li>
<li>We will see following functions : <b><a class="el" href="../../d4/d86/group__imgproc__filter.html#gacea54f142e81b6758cb6f375ce782c8d" title="Calculates the first, second, third, or mixed image derivatives using an extended Sobel operator.">cv.Sobel()</a></b>, <b><a class="el" href="../../d4/d86/group__imgproc__filter.html#gaa13106761eedf14798f37aa2d60404c9" title="Calculates the first x- or y- image derivative using Scharr operator.">cv.Scharr()</a></b>, <b><a class="el" href="../../d4/d86/group__imgproc__filter.html#gad78703e4c8fe703d479c1860d76429e6" title="Calculates the Laplacian of an image.">cv.Laplacian()</a></b> etc</li>
</ul>
<h1><a class="anchor" id="autotoc_md1384"></a>
Theory</h1>
<p>OpenCV provides three types of gradient filters or High-pass filters, Sobel, Scharr and Laplacian. We will see each one of them.</p>
<h2><a class="anchor" id="autotoc_md1385"></a>
1. Sobel and Scharr Derivatives</h2>
<p>Sobel operators is a joint Gaussian smoothing plus differentiation operation, so it is more resistant to noise. You can specify the direction of derivatives to be taken, vertical or horizontal (by the arguments, yorder and xorder respectively). You can also specify the size of kernel by the argument ksize. If ksize = -1, a 3x3 Scharr filter is used which gives better results than 3x3 Sobel filter. Please see the docs for kernels used.</p>
<h2><a class="anchor" id="autotoc_md1386"></a>
2. Laplacian Derivatives</h2>
<p>It calculates the Laplacian of the image given by the relation, \(\Delta src = \frac{\partial ^2{src}}{\partial x^2} + \frac{\partial ^2{src}}{\partial y^2}\) where each derivative is found using Sobel derivatives. If ksize = 1, then following kernel is used for filtering:</p>
<p class="formulaDsp">
\[kernel = \begin{bmatrix} 0 &amp; 1 &amp; 0 \\ 1 &amp; -4 &amp; 1 \\ 0 &amp; 1 &amp; 0  \end{bmatrix}\]
</p>
<h1><a class="anchor" id="autotoc_md1387"></a>
Code</h1>
<p>Below code shows all operators in a single diagram. All kernels are of 5x5 size. Depth of output image is passed -1 to get the result in np.uint8 type. </p><div class="fragment"><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</div>
<div class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</div>
<div class="line"> </div>
<div class="line">img = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv.imread</a>(<span class="stringliteral">&#39;dave.jpg&#39;</span>, cv.IMREAD_GRAYSCALE)</div>
<div class="line"><span class="keyword">assert</span> img <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>, <span class="stringliteral">&quot;file could not be read, check with os.path.exists()&quot;</span></div>
<div class="line"> </div>
<div class="line">laplacian = <a class="code hl_function" href="../../d4/d86/group__imgproc__filter.html#gad78703e4c8fe703d479c1860d76429e6">cv.Laplacian</a>(img,cv.CV_64F)</div>
<div class="line">sobelx = <a class="code hl_function" href="../../d4/d86/group__imgproc__filter.html#gacea54f142e81b6758cb6f375ce782c8d">cv.Sobel</a>(img,cv.CV_64F,1,0,ksize=5)</div>
<div class="line">sobely = <a class="code hl_function" href="../../d4/d86/group__imgproc__filter.html#gacea54f142e81b6758cb6f375ce782c8d">cv.Sobel</a>(img,cv.CV_64F,0,1,ksize=5)</div>
<div class="line"> </div>
<div class="line">plt.subplot(2,2,1),plt.imshow(img,cmap = <span class="stringliteral">&#39;gray&#39;</span>)</div>
<div class="line">plt.title(<span class="stringliteral">&#39;Original&#39;</span>), plt.xticks([]), plt.yticks([])</div>
<div class="line">plt.subplot(2,2,2),plt.imshow(laplacian,cmap = <span class="stringliteral">&#39;gray&#39;</span>)</div>
<div class="line">plt.title(<span class="stringliteral">&#39;Laplacian&#39;</span>), plt.xticks([]), plt.yticks([])</div>
<div class="line">plt.subplot(2,2,3),plt.imshow(sobelx,cmap = <span class="stringliteral">&#39;gray&#39;</span>)</div>
<div class="line">plt.title(<span class="stringliteral">&#39;Sobel X&#39;</span>), plt.xticks([]), plt.yticks([])</div>
<div class="line">plt.subplot(2,2,4),plt.imshow(sobely,cmap = <span class="stringliteral">&#39;gray&#39;</span>)</div>
<div class="line">plt.title(<span class="stringliteral">&#39;Sobel Y&#39;</span>), plt.xticks([]), plt.yticks([])</div>
<div class="line"> </div>
<div class="line">plt.show()</div>
<div class="ttc" id="agroup__imgcodecs_html_gab32ee19e22660912565f8140d0f675a8"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv::imread</a></div><div class="ttdeci">CV_EXPORTS_W Mat imread(const String &amp;filename, int flags=IMREAD_COLOR)</div><div class="ttdoc">Loads an image from a file.</div></div>
<div class="ttc" id="agroup__imgproc__filter_html_gacea54f142e81b6758cb6f375ce782c8d"><div class="ttname"><a href="../../d4/d86/group__imgproc__filter.html#gacea54f142e81b6758cb6f375ce782c8d">cv::Sobel</a></div><div class="ttdeci">void Sobel(InputArray src, OutputArray dst, int ddepth, int dx, int dy, int ksize=3, double scale=1, double delta=0, int borderType=BORDER_DEFAULT)</div><div class="ttdoc">Calculates the first, second, third, or mixed image derivatives using an extended Sobel operator.</div></div>
<div class="ttc" id="agroup__imgproc__filter_html_gad78703e4c8fe703d479c1860d76429e6"><div class="ttname"><a href="../../d4/d86/group__imgproc__filter.html#gad78703e4c8fe703d479c1860d76429e6">cv::Laplacian</a></div><div class="ttdeci">void Laplacian(InputArray src, OutputArray dst, int ddepth, int ksize=1, double scale=1, double delta=0, int borderType=BORDER_DEFAULT)</div><div class="ttdoc">Calculates the Laplacian of an image.</div></div>
</div><!-- fragment --><p> Result:</p>
<div class="image">
<img src="../../gradients.jpg" alt=""/>
<div class="caption">
image</div></div>
    <h1><a class="anchor" id="autotoc_md1388"></a>
One Important Matter!</h1>
<p>In our last example, output datatype is cv.CV_8U or np.uint8. But there is a slight problem with that. Black-to-White transition is taken as Positive slope (it has a positive value) while White-to-Black transition is taken as a Negative slope (It has negative value). So when you convert data to np.uint8, all negative slopes are made zero. In simple words, you miss that edge.</p>
<p>If you want to detect both edges, better option is to keep the output datatype to some higher forms, like cv.CV_16S, cv.CV_64F etc, take its absolute value and then convert back to cv.CV_8U. Below code demonstrates this procedure for a horizontal Sobel filter and difference in results. </p><div class="fragment"><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</div>
<div class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</div>
<div class="line"> </div>
<div class="line">img = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv.imread</a>(<span class="stringliteral">&#39;box.png&#39;</span>, cv.IMREAD_GRAYSCALE)</div>
<div class="line"><span class="keyword">assert</span> img <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>, <span class="stringliteral">&quot;file could not be read, check with os.path.exists()&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Output dtype = cv.CV_8U</span></div>
<div class="line">sobelx8u = <a class="code hl_function" href="../../d4/d86/group__imgproc__filter.html#gacea54f142e81b6758cb6f375ce782c8d">cv.Sobel</a>(img,cv.CV_8U,1,0,ksize=5)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Output dtype = cv.CV_64F. Then take its absolute and convert to cv.CV_8U</span></div>
<div class="line">sobelx64f = <a class="code hl_function" href="../../d4/d86/group__imgproc__filter.html#gacea54f142e81b6758cb6f375ce782c8d">cv.Sobel</a>(img,cv.CV_64F,1,0,ksize=5)</div>
<div class="line">abs_sobel64f = np.absolute(sobelx64f)</div>
<div class="line">sobel_8u = np.uint8(abs_sobel64f)</div>
<div class="line"> </div>
<div class="line">plt.subplot(1,3,1),plt.imshow(img,cmap = <span class="stringliteral">&#39;gray&#39;</span>)</div>
<div class="line">plt.title(<span class="stringliteral">&#39;Original&#39;</span>), plt.xticks([]), plt.yticks([])</div>
<div class="line">plt.subplot(1,3,2),plt.imshow(sobelx8u,cmap = <span class="stringliteral">&#39;gray&#39;</span>)</div>
<div class="line">plt.title(<span class="stringliteral">&#39;Sobel CV_8U&#39;</span>), plt.xticks([]), plt.yticks([])</div>
<div class="line">plt.subplot(1,3,3),plt.imshow(sobel_8u,cmap = <span class="stringliteral">&#39;gray&#39;</span>)</div>
<div class="line">plt.title(<span class="stringliteral">&#39;Sobel abs(CV_64F)&#39;</span>), plt.xticks([]), plt.yticks([])</div>
<div class="line"> </div>
<div class="line">plt.show()</div>
</div><!-- fragment --><p> Check the result below:</p>
<div class="image">
<img src="../../double_edge.jpg" alt=""/>
<div class="caption">
image</div></div>
    <h1><a class="anchor" id="autotoc_md1389"></a>
Additional Resources</h1>
<h1><a class="anchor" id="autotoc_md1390"></a>
Exercises</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 2 2024 21:52:14 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.8
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
