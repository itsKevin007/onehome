<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/xhtml;charset=utf-8" http-equiv="Content-Type"/>
<meta content="IE=9" http-equiv="X-UA-Compatible"/>
<meta content="Doxygen 1.9.8" name="generator"/>
<title>OpenCV: cv::cuda::BufferPool Class Reference</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon"/>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script src="../../jquery.js" type="text/javascript"></script>
<script src="../../dynsections.js" type="text/javascript"></script>
<script src="../../tutorial-utils.js" type="text/javascript"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script src="../../search/searchdata.js" type="text/javascript"></script>
<script src="../../search/search.js" type="text/javascript"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script async="async" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js" type="text/javascript"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellpadding="0" cellspacing="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
    <span id="projectnumber">4.10.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script src="../../menudata.js" type="text/javascript"></script>
<script src="../../menu.js" type="text/javascript"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onkeydown="return searchBox.OnSearchSelectKey(event)" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()">
</div>
<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>
<div class="navpath" id="nav-path">
  <ul>
<li class="navelem"><a class="el" href="../../d2/d75/namespacecv.html">cv</a></li><li class="navelem"><a class="el" href="../../d1/d1a/namespacecv_1_1cuda.html">cuda</a></li><li class="navelem"><a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html">BufferPool</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> |
<a href="../../d7/dfb/classcv_1_1cuda_1_1BufferPool-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">cv::cuda::BufferPool Class Reference<div class="ingroups"><a class="el" href="../../d1/d1e/group__cuda.html">CUDA-accelerated Computer Vision</a> » <a class="el" href="../../d7/d05/group__cudacore.html">Core part</a> » <a class="el" href="../../d9/d41/group__cudacore__struct.html">Data Structures</a></div></div></div>
</div><!--header-->
<div class="contents">
<p><a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html" title="BufferPool for use with CUDA streams.">BufferPool</a> for use with CUDA streams.  
 <a href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html#details">More...</a></p>
<p><code>#include &lt;opencv2/core/cuda.hpp&gt;</code></p>
<div class="dynheader">
Collaboration diagram for cv::cuda::BufferPool:</div>
<div class="dyncontent">
<div class="center"><iframe frameborder="0" height="136" scrolling="no" src="../../d2/d52/classcv_1_1cuda_1_1BufferPool__coll__graph.svg" width="154"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0f1e0a518847d41663e7344927515761" id="r_a0f1e0a518847d41663e7344927515761"><td align="right" class="memItemLeft" valign="top"> </td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html#a0f1e0a518847d41663e7344927515761">BufferPool</a> (<a class="el" href="../../d9/df3/classcv_1_1cuda_1_1Stream.html">Stream</a> &amp;stream)</td></tr>
<tr class="memdesc:a0f1e0a518847d41663e7344927515761"><td class="mdescLeft"> </td><td class="mdescRight">Gets the <a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html" title="BufferPool for use with CUDA streams.">BufferPool</a> for the given stream.  <br/></td></tr>
<tr class="separator:a0f1e0a518847d41663e7344927515761"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:aa2a10fe169a94f4e221626e22454ea9c" id="r_aa2a10fe169a94f4e221626e22454ea9c"><td align="right" class="memItemLeft" valign="top"><a class="el" href="../../dc/d84/group__core__basic.html#ga6395ca871a678020c4a31fadf7e8cc63">Ptr</a>&lt; <a class="el" href="../../df/d98/classcv_1_1cuda_1_1GpuMat_1_1Allocator.html">GpuMat::Allocator</a> &gt; </td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html#aa2a10fe169a94f4e221626e22454ea9c">getAllocator</a> () const</td></tr>
<tr class="memdesc:aa2a10fe169a94f4e221626e22454ea9c"><td class="mdescLeft"> </td><td class="mdescRight">Returns the allocator associated with the stream.  <br/></td></tr>
<tr class="separator:aa2a10fe169a94f4e221626e22454ea9c"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a715fecc85a804935c8c5a6c4eb4f905e" id="r_a715fecc85a804935c8c5a6c4eb4f905e"><td align="right" class="memItemLeft" valign="top"><a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> </td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html#a715fecc85a804935c8c5a6c4eb4f905e">getBuffer</a> (int rows, int cols, int type)</td></tr>
<tr class="memdesc:a715fecc85a804935c8c5a6c4eb4f905e"><td class="mdescLeft"> </td><td class="mdescRight">Allocates a new <a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html" title="Base storage class for GPU memory with reference counting.">GpuMat</a> of given size and type.  <br/></td></tr>
<tr class="separator:a715fecc85a804935c8c5a6c4eb4f905e"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:ae3555cf098c2ca2b9112f18393f6095e" id="r_ae3555cf098c2ca2b9112f18393f6095e"><td align="right" class="memItemLeft" valign="top"><a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> </td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html#ae3555cf098c2ca2b9112f18393f6095e">getBuffer</a> (<a class="el" href="../../dc/d84/group__core__basic.html#ga346f563897249351a34549137c8532a0">Size</a> size, int type)</td></tr>
<tr class="memdesc:ae3555cf098c2ca2b9112f18393f6095e"><td class="mdescLeft"> </td><td class="mdescRight">Allocates a new <a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html" title="Base storage class for GPU memory with reference counting.">GpuMat</a> of given size and type.  <br/></td></tr>
<tr class="separator:ae3555cf098c2ca2b9112f18393f6095e"><td class="memSeparator" colspan="2"> </td></tr>
</table>
<a id="details" name="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html" title="BufferPool for use with CUDA streams.">BufferPool</a> for use with CUDA streams. </p>
<p><a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html" title="BufferPool for use with CUDA streams.">BufferPool</a> utilizes <a class="el" href="../../d9/df3/classcv_1_1cuda_1_1Stream.html" title="This class encapsulates a queue of asynchronous calls.">Stream</a>'s allocator to create new buffers for <a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html" title="Base storage class for GPU memory with reference counting.">GpuMat</a>'s. It is only useful when enabled with <a class="el" href="../../d9/d41/group__cudacore__struct.html#ga7dbf253e43493eb870c9759cc35bbffb" title="BufferPool management (must be called before Stream creation)">setBufferPoolUsage</a>.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="../../d9/d41/group__cudacore__struct.html#ga7dbf253e43493eb870c9759cc35bbffb">setBufferPoolUsage</a>(<span class="keyword">true</span>);</div>
<div class="ttc" id="agroup__cudacore__struct_html_ga7dbf253e43493eb870c9759cc35bbffb"><div class="ttname"><a href="../../d9/d41/group__cudacore__struct.html#ga7dbf253e43493eb870c9759cc35bbffb">cv::cuda::setBufferPoolUsage</a></div><div class="ttdeci">void setBufferPoolUsage(bool on)</div><div class="ttdoc">BufferPool management (must be called before Stream creation)</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><a class="el" href="../../d9/d41/group__cudacore__struct.html#ga7dbf253e43493eb870c9759cc35bbffb" title="BufferPool management (must be called before Stream creation)">setBufferPoolUsage</a> must be called <em>before</em> any <a class="el" href="../../d9/df3/classcv_1_1cuda_1_1Stream.html" title="This class encapsulates a queue of asynchronous calls.">Stream</a> declaration.</dd></dl>
<p>Users may specify custom allocator for <a class="el" href="../../d9/df3/classcv_1_1cuda_1_1Stream.html" title="This class encapsulates a queue of asynchronous calls.">Stream</a> and may implement their own stream based functions utilizing the same underlying GPU memory management.</p>
<p>If custom allocator is not specified, <a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html" title="BufferPool for use with CUDA streams.">BufferPool</a> utilizes StackAllocator by default. StackAllocator allocates a chunk of GPU device memory beforehand, and when <a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html" title="Base storage class for GPU memory with reference counting.">GpuMat</a> is declared later on, it is given the pre-allocated memory. This kind of strategy reduces the number of calls for memory allocating APIs such as cudaMalloc or cudaMallocPitch.</p>
<p>Below is an example that utilizes <a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html" title="BufferPool for use with CUDA streams.">BufferPool</a> with StackAllocator:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;opencv2/opencv.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d1/d1a/namespacecv_1_1cuda.html">cv::cuda</a></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="../../d9/d41/group__cudacore__struct.html#ga7dbf253e43493eb870c9759cc35bbffb">setBufferPoolUsage</a>(<span class="keyword">true</span>);                               <span class="comment">// Tell OpenCV that we are going to utilize BufferPool</span></div>
<div class="line">    <a class="code hl_function" href="../../d9/d41/group__cudacore__struct.html#ga93da1d4c64558590950409266b1e2a92">setBufferPoolConfig</a>(<a class="code hl_function" href="../../d8/d40/group__cudacore__init.html#ga6ded4ed8e4fc483a9863d31f34ec9c0e">getDevice</a>(), 1024 * 1024 * 64, 2);  <span class="comment">// Allocate 64 MB, 2 stacks (default is 10 MB, 5 stacks)</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d9/df3/classcv_1_1cuda_1_1Stream.html">Stream</a> stream1, stream2;                                <span class="comment">// Each stream uses 1 stack</span></div>
<div class="line">    <a class="code hl_class" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html">BufferPool</a> pool1(stream1), pool2(stream2);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> d_src1 = pool1.getBuffer(4096, 4096, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga81df635441b21f532fdace401e04f588">CV_8UC1</a>);   <span class="comment">// 16MB</span></div>
<div class="line">    <a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> d_dst1 = pool1.getBuffer(4096, 4096, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);   <span class="comment">// 48MB, pool1 is now full</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> d_src2 = pool2.getBuffer(1024, 1024, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga81df635441b21f532fdace401e04f588">CV_8UC1</a>);   <span class="comment">// 1MB</span></div>
<div class="line">    <a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> d_dst2 = pool2.getBuffer(1024, 1024, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);   <span class="comment">// 3MB</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="../../db/d8c/group__cudaimgproc__color.html#ga48d0f208181d5ca370d8ff6b62cbe826">cvtColor</a>(d_src1, d_dst1, <a class="code hl_enumvalue" href="../../d8/d01/group__imgproc__color__conversions.html#gga4e0972be5de079fed4e3a10e24ef5ef0a869da65c045477f2f17d39395df65b2d">cv::COLOR_GRAY2BGR</a>, 0, stream1);</div>
<div class="line">    <a class="code hl_function" href="../../db/d8c/group__cudaimgproc__color.html#ga48d0f208181d5ca370d8ff6b62cbe826">cvtColor</a>(d_src2, d_dst2, <a class="code hl_enumvalue" href="../../d8/d01/group__imgproc__color__conversions.html#gga4e0972be5de079fed4e3a10e24ef5ef0a869da65c045477f2f17d39395df65b2d">cv::COLOR_GRAY2BGR</a>, 0, stream2);</div>
<div class="line">}</div>
<div class="ttc" id="aclasscv_1_1cuda_1_1BufferPool_html"><div class="ttname"><a href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html">cv::cuda::BufferPool</a></div><div class="ttdoc">BufferPool for use with CUDA streams.</div><div class="ttdef"><b>Definition</b> cuda.hpp:739</div></div>
<div class="ttc" id="aclasscv_1_1cuda_1_1GpuMat_html"><div class="ttname"><a href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">cv::cuda::GpuMat</a></div><div class="ttdoc">Base storage class for GPU memory with reference counting.</div><div class="ttdef"><b>Definition</b> cuda.hpp:106</div></div>
<div class="ttc" id="aclasscv_1_1cuda_1_1Stream_html"><div class="ttname"><a href="../../d9/df3/classcv_1_1cuda_1_1Stream.html">cv::cuda::Stream</a></div><div class="ttdoc">This class encapsulates a queue of asynchronous calls.</div><div class="ttdef"><b>Definition</b> cuda.hpp:908</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga81df635441b21f532fdace401e04f588"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga81df635441b21f532fdace401e04f588">CV_8UC1</a></div><div class="ttdeci">#define CV_8UC1</div><div class="ttdef"><b>Definition</b> interface.h:88</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga88c4cd9de76f678f33928ef1e3f96047"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a></div><div class="ttdeci">#define CV_8UC3</div><div class="ttdef"><b>Definition</b> interface.h:90</div></div>
<div class="ttc" id="agroup__cudacore__init_html_ga6ded4ed8e4fc483a9863d31f34ec9c0e"><div class="ttname"><a href="../../d8/d40/group__cudacore__init.html#ga6ded4ed8e4fc483a9863d31f34ec9c0e">cv::cuda::getDevice</a></div><div class="ttdeci">int getDevice()</div><div class="ttdoc">Returns the current device index set by cuda::setDevice or initialized by default.</div></div>
<div class="ttc" id="agroup__cudacore__struct_html_ga93da1d4c64558590950409266b1e2a92"><div class="ttname"><a href="../../d9/d41/group__cudacore__struct.html#ga93da1d4c64558590950409266b1e2a92">cv::cuda::setBufferPoolConfig</a></div><div class="ttdeci">void setBufferPoolConfig(int deviceId, size_t stackSize, int stackCount)</div></div>
<div class="ttc" id="agroup__cudaimgproc__color_html_ga48d0f208181d5ca370d8ff6b62cbe826"><div class="ttname"><a href="../../db/d8c/group__cudaimgproc__color.html#ga48d0f208181d5ca370d8ff6b62cbe826">cv::cuda::cvtColor</a></div><div class="ttdeci">void cvtColor(InputArray src, OutputArray dst, int code, int dcn=0, Stream &amp;stream=Stream::Null())</div><div class="ttdoc">Converts an image from one color space to another.</div></div>
<div class="ttc" id="agroup__imgproc__color__conversions_html_gga4e0972be5de079fed4e3a10e24ef5ef0a869da65c045477f2f17d39395df65b2d"><div class="ttname"><a href="../../d8/d01/group__imgproc__color__conversions.html#gga4e0972be5de079fed4e3a10e24ef5ef0a869da65c045477f2f17d39395df65b2d">cv::COLOR_GRAY2BGR</a></div><div class="ttdeci">@ COLOR_GRAY2BGR</div><div class="ttdef"><b>Definition</b> imgproc.hpp:557</div></div>
<div class="ttc" id="ahighgui__qt_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition</b> highgui_qt.cpp:3</div></div>
<div class="ttc" id="anamespacecv_1_1cuda_html"><div class="ttname"><a href="../../d1/d1a/namespacecv_1_1cuda.html">cv::cuda</a></div><div class="ttdef"><b>Definition</b> cuda.hpp:65</div></div>
<div class="ttc" id="anamespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdoc">"black box" representation of the file storage associated with a file on disk.</div><div class="ttdef"><b>Definition</b> core.hpp:102</div></div>
</div><!-- fragment --><p>If we allocate another <a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html" title="Base storage class for GPU memory with reference counting.">GpuMat</a> on pool1 in the above example, it will be carried out by the DefaultAllocator since the stack for pool1 is full.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> d_add1 = pool1.getBuffer(1024, 1024, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga81df635441b21f532fdace401e04f588">CV_8UC1</a>);   <span class="comment">// Stack for pool1 is full, memory is allocated with DefaultAllocator</span></div>
</div><!-- fragment --><p>If a third stream is declared in the above example, allocating with <a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html#a715fecc85a804935c8c5a6c4eb4f905e" title="Allocates a new GpuMat of given size and type.">getBuffer</a> within that stream will also be carried out by the DefaultAllocator because we've run out of stacks.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="../../d9/df3/classcv_1_1cuda_1_1Stream.html">Stream</a> stream3;                                         <span class="comment">// Only 2 stacks were allocated, we've run out of stacks</span></div>
<div class="line"><a class="code hl_class" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html">BufferPool</a> pool3(stream3);</div>
<div class="line"><a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> d_src3 = pool3.getBuffer(1024, 1024, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga81df635441b21f532fdace401e04f588">CV_8UC1</a>);   <span class="comment">// Memory is allocated with DefaultAllocator</span></div>
</div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>When utilizing StackAllocator, deallocation order is important.</dd></dl>
<p>Just like a stack, deallocation must be done in LIFO order. Below is an example of erroneous usage that violates LIFO rule. If OpenCV is compiled in Debug mode, this sample code will emit CV_Assert error.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="../../d9/d41/group__cudacore__struct.html#ga7dbf253e43493eb870c9759cc35bbffb">setBufferPoolUsage</a>(<span class="keyword">true</span>);                               <span class="comment">// Tell OpenCV that we are going to utilize BufferPool</span></div>
<div class="line">    <a class="code hl_class" href="../../d9/df3/classcv_1_1cuda_1_1Stream.html">Stream</a> stream;                                          <span class="comment">// A default size (10 MB) stack is allocated to this stream</span></div>
<div class="line">    <a class="code hl_class" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html">BufferPool</a> pool(stream);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> mat1 = pool.getBuffer(1024, 1024, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga81df635441b21f532fdace401e04f588">CV_8UC1</a>);      <span class="comment">// Allocate mat1 (1MB)</span></div>
<div class="line">    <a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> mat2 = pool.getBuffer(1024, 1024, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga81df635441b21f532fdace401e04f588">CV_8UC1</a>);      <span class="comment">// Allocate mat2 (1MB)</span></div>
<div class="line"> </div>
<div class="line">    mat1.<a class="code hl_function" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html#a460951a00945774e9da0b1062ea0a319">release</a>();                                         <span class="comment">// erroneous usage : mat2 must be deallocated before mat1</span></div>
<div class="line">}</div>
<div class="ttc" id="aclasscv_1_1cuda_1_1GpuMat_html_a460951a00945774e9da0b1062ea0a319"><div class="ttname"><a href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html#a460951a00945774e9da0b1062ea0a319">cv::cuda::GpuMat::release</a></div><div class="ttdeci">void release()</div><div class="ttdoc">decreases reference counter, deallocate the data when reference counter reaches 0</div></div>
</div><!-- fragment --><p>Since C++ local variables are destroyed in the reverse order of construction, the code sample below satisfies the LIFO rule. Local <a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html" title="Base storage class for GPU memory with reference counting.">GpuMat</a>'s are deallocated and the corresponding memory is automatically returned to the pool for later usage.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="../../d9/d41/group__cudacore__struct.html#ga7dbf253e43493eb870c9759cc35bbffb">setBufferPoolUsage</a>(<span class="keyword">true</span>);                               <span class="comment">// Tell OpenCV that we are going to utilize BufferPool</span></div>
<div class="line">    <a class="code hl_function" href="../../d9/d41/group__cudacore__struct.html#ga93da1d4c64558590950409266b1e2a92">setBufferPoolConfig</a>(<a class="code hl_function" href="../../d8/d40/group__cudacore__init.html#ga6ded4ed8e4fc483a9863d31f34ec9c0e">getDevice</a>(), 1024 * 1024 * 64, 2);  <span class="comment">// Allocate 64 MB, 2 stacks (default is 10 MB, 5 stacks)</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d9/df3/classcv_1_1cuda_1_1Stream.html">Stream</a> stream1, stream2;                                <span class="comment">// Each stream uses 1 stack</span></div>
<div class="line">    <a class="code hl_class" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html">BufferPool</a> pool1(stream1), pool2(stream2);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 10; i++)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> d_src1 = pool1.getBuffer(4096, 4096, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga81df635441b21f532fdace401e04f588">CV_8UC1</a>);   <span class="comment">// 16MB</span></div>
<div class="line">        <a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> d_dst1 = pool1.getBuffer(4096, 4096, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);   <span class="comment">// 48MB, pool1 is now full</span></div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> d_src2 = pool2.getBuffer(1024, 1024, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga81df635441b21f532fdace401e04f588">CV_8UC1</a>);   <span class="comment">// 1MB</span></div>
<div class="line">        <a class="code hl_class" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> d_dst2 = pool2.getBuffer(1024, 1024, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);   <span class="comment">// 3MB</span></div>
<div class="line"> </div>
<div class="line">        d_src1.<a class="code hl_function" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html#aa4c50630ceb28bb28cb861a9a96945a1">setTo</a>(<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(i), stream1);</div>
<div class="line">        d_src2.<a class="code hl_function" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html#aa4c50630ceb28bb28cb861a9a96945a1">setTo</a>(<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(i), stream2);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_function" href="../../db/d8c/group__cudaimgproc__color.html#ga48d0f208181d5ca370d8ff6b62cbe826">cvtColor</a>(d_src1, d_dst1, <a class="code hl_enumvalue" href="../../d8/d01/group__imgproc__color__conversions.html#gga4e0972be5de079fed4e3a10e24ef5ef0a869da65c045477f2f17d39395df65b2d">cv::COLOR_GRAY2BGR</a>, 0, stream1);</div>
<div class="line">        <a class="code hl_function" href="../../db/d8c/group__cudaimgproc__color.html#ga48d0f208181d5ca370d8ff6b62cbe826">cvtColor</a>(d_src2, d_dst2, <a class="code hl_enumvalue" href="../../d8/d01/group__imgproc__color__conversions.html#gga4e0972be5de079fed4e3a10e24ef5ef0a869da65c045477f2f17d39395df65b2d">cv::COLOR_GRAY2BGR</a>, 0, stream2);</div>
<div class="line">                                                                <span class="comment">// The order of destruction of the local variables is:</span></div>
<div class="line">                                                                <span class="comment">//   d_dst2 =&gt; d_src2 =&gt; d_dst1 =&gt; d_src1</span></div>
<div class="line">                                                                <span class="comment">// LIFO rule is satisfied, this code runs without error</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclasscv_1_1cuda_1_1GpuMat_html_aa4c50630ceb28bb28cb861a9a96945a1"><div class="ttname"><a href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html#aa4c50630ceb28bb28cb861a9a96945a1">cv::cuda::GpuMat::setTo</a></div><div class="ttdeci">GpuMat &amp; setTo(Scalar s)</div><div class="ttdoc">sets some of the GpuMat elements to s (Blocking call)</div></div>
<div class="ttc" id="agroup__core__basic_html_ga599fe92e910c027be274233eccad7beb"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">cv::Scalar</a></div><div class="ttdeci">Scalar_&lt; double &gt; Scalar</div><div class="ttdef"><b>Definition</b> types.hpp:702</div></div>
</div><!-- fragment --> </div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a0f1e0a518847d41663e7344927515761" name="a0f1e0a518847d41663e7344927515761"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f1e0a518847d41663e7344927515761">◆ </a></span>BufferPool()</h2>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">cv::cuda::BufferPool::BufferPool </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/df3/classcv_1_1cuda_1_1Stream.html">Stream</a> &amp; </td>
          <td class="paramname"><em>stream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table><table class="python_language"><tr><th colspan="999" style="text-align:left">Python:</th></tr><tr><td style="width: 20px;"></td><td>cv.cuda.BufferPool(</td><td class="paramname">stream</td><td>) -&gt; </td><td>&lt;cuda_BufferPool object&gt;</td></tr></table>
</div><div class="memdoc">
<p>Gets the <a class="el" href="../../d5/d08/classcv_1_1cuda_1_1BufferPool.html" title="BufferPool for use with CUDA streams.">BufferPool</a> for the given stream. </p>
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa2a10fe169a94f4e221626e22454ea9c" name="aa2a10fe169a94f4e221626e22454ea9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2a10fe169a94f4e221626e22454ea9c">◆ </a></span>getAllocator()</h2>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dc/d84/group__core__basic.html#ga6395ca871a678020c4a31fadf7e8cc63">Ptr</a>&lt; <a class="el" href="../../df/d98/classcv_1_1cuda_1_1GpuMat_1_1Allocator.html">GpuMat::Allocator</a> &gt; cv::cuda::BufferPool::getAllocator </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table><table class="python_language"><tr><th colspan="999" style="text-align:left">Python:</th></tr><tr><td style="width: 20px;"></td><td>cv.cuda.BufferPool.getAllocator(</td><td class="paramname"></td><td>) -&gt; </td><td>retval</td></tr></table>
</div><div class="memdoc">
<p>Returns the allocator associated with the stream. </p>
</div>
</div>
<a id="a715fecc85a804935c8c5a6c4eb4f905e" name="a715fecc85a804935c8c5a6c4eb4f905e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a715fecc85a804935c8c5a6c4eb4f905e">◆ </a></span>getBuffer() <span class="overload">[1/2]</span></h2>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> cv::cuda::BufferPool::getBuffer </td>
          <td>(</td>
          <td class="paramtype">int </td>
          <td class="paramname"><em>rows</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int </td>
          <td class="paramname"><em>cols</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int </td>
          <td class="paramname"><em>type</em> </td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table><table class="python_language"><tr><th colspan="999" style="text-align:left">Python:</th></tr><tr><td style="width: 20px;"></td><td>cv.cuda.BufferPool.getBuffer(</td><td class="paramname">rows, cols, type</td><td>) -&gt; </td><td>retval</td></tr><tr><td style="width: 20px;"></td><td>cv.cuda.BufferPool.getBuffer(</td><td class="paramname">size, type</td><td>) -&gt; </td><td>retval</td></tr></table>
</div><div class="memdoc">
<p>Allocates a new <a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html" title="Base storage class for GPU memory with reference counting.">GpuMat</a> of given size and type. </p>
</div>
</div>
<a id="ae3555cf098c2ca2b9112f18393f6095e" name="ae3555cf098c2ca2b9112f18393f6095e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3555cf098c2ca2b9112f18393f6095e">◆ </a></span>getBuffer() <span class="overload">[2/2]</span></h2>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html">GpuMat</a> cv::cuda::BufferPool::getBuffer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d84/group__core__basic.html#ga346f563897249351a34549137c8532a0">Size</a> </td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int </td>
          <td class="paramname"><em>type</em> </td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table><table class="python_language"><tr><th colspan="999" style="text-align:left">Python:</th></tr><tr><td style="width: 20px;"></td><td>cv.cuda.BufferPool.getBuffer(</td><td class="paramname">rows, cols, type</td><td>) -&gt; </td><td>retval</td></tr><tr><td style="width: 20px;"></td><td>cv.cuda.BufferPool.getBuffer(</td><td class="paramname">size, type</td><td>) -&gt; </td><td>retval</td></tr></table>
</div><div class="memdoc">
<p>Allocates a new <a class="el" href="../../d0/d60/classcv_1_1cuda_1_1GpuMat.html" title="Base storage class for GPU memory with reference counting.">GpuMat</a> of given size and type. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe frameborder="0" height="75" scrolling="no" src="../../d5/d08/classcv_1_1cuda_1_1BufferPool_ae3555cf098c2ca2b9112f18393f6095e_cgraph.svg" width="162"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>opencv2/core/<a class="el" href="../../d8/dd1/modules_2core_2include_2opencv2_2core_2cuda_8hpp.html">cuda.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 2 2024 21:52:16 for OpenCV by  <a href="http://www.doxygen.org/index.html">
<img alt="doxygen" class="footer" src="../../doxygen.png"/>
</a> 1.9.8
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
