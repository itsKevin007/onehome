<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>OpenCV: Periodic Noise Removing Filter</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.10.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d7/da8/tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Periodic Noise Removing Filter</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md758">Goal</a></li>
<li class="level1"><a href="#autotoc_md759">Theory</a><ul><li class="level2"><a href="#autotoc_md760">How to remove periodic noise in the Fourier domain?</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md761">Source code</a></li>
<li class="level1"><a href="#autotoc_md762">Explanation</a></li>
<li class="level1"><a href="#autotoc_md763">Result</a></li>
</ul>
</div>
<div class="textblock"><p><b>Prev Tutorial:</b> <a class="el" href="../../d4/d70/tutorial_anisotropic_image_segmentation_by_a_gst.html">Anisotropic image segmentation by a gradient structure tensor</a> <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight"></th><th class="markdownTableHeadLeft"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">Original author   </td><td class="markdownTableBodyLeft">Karpushin Vladislav    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">Compatibility   </td><td class="markdownTableBodyLeft">OpenCV &gt;= 3.0   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md758"></a>
Goal</h1>
<p>In this tutorial you will learn:</p>
<ul>
<li>how to remove periodic noise in the Fourier domain</li>
</ul>
<h1><a class="anchor" id="autotoc_md759"></a>
Theory</h1>
<dl class="section note"><dt>Note</dt><dd>The explanation is based on the book <a class="el" href="../../d0/de3/citelist.html#CITEREF_gonzalez">[108]</a>. The image on this page is a real world image.</dd></dl>
<p>Periodic noise produces spikes in the Fourier domain that can often be detected by visual analysis.</p>
<h2><a class="anchor" id="autotoc_md760"></a>
How to remove periodic noise in the Fourier domain?</h2>
<p>Periodic noise can be reduced significantly via frequency domain filtering. On this page we use a notch reject filter with an appropriate radius to completely enclose the noise spikes in the Fourier domain. The notch filter rejects frequencies in predefined neighborhoods around a center frequency. The number of notch filters is arbitrary. The shape of the notch areas can also be arbitrary (e.g. rectangular or circular). On this page we use three circular shape notch reject filters. Power spectrum densify of an image is used for the noise spikeâ€™s visual detection.</p>
<h1><a class="anchor" id="autotoc_md761"></a>
Source code</h1>
<p>You can find source code in the <code>samples/cpp/tutorial_code/ImgProc/periodic_noise_removing_filter/periodic_noise_removing_filter.cpp</code> of the OpenCV source code library.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d6/d87/imgcodecs_8hpp.html">opencv2/imgcodecs.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">opencv2/imgproc.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> fftshift(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg);</div>
<div class="line"><span class="keywordtype">void</span> filter2DFreq(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; H);</div>
<div class="line"><span class="keywordtype">void</span> synthesizeFilterH(<a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputOutput_H, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> center, <span class="keywordtype">int</span> radius);</div>
<div class="line"><span class="keywordtype">void</span> calcPSD(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <span class="keywordtype">int</span> flag = 0);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a> keys =</div>
<div class="line"><span class="stringliteral">&quot;{help h usage ? |             | print this message   }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{@image          |period_input.jpg | input image name     }&quot;</span></div>
<div class="line">;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="../../d0/d2e/classcv_1_1CommandLineParser.html">CommandLineParser</a> parser(argc, argv, keys);</div>
<div class="line">    <span class="keywordtype">string</span> strInFileName = parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;@image&quot;</span>);</div>
<div class="line">    samples::addSamplesDataSearchSubDirectory(<span class="stringliteral">&quot;doc/tutorials/imgproc/periodic_noise_removing_filter/images&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imgIn = imread(samples::findFile(strInFileName), IMREAD_GRAYSCALE);</div>
<div class="line">    <span class="keywordflow">if</span> (imgIn.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#abbec3525a852e77998aba034813fded4">empty</a>()) <span class="comment">//check whether the image is loaded or not</span></div>
<div class="line">    {</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;ERROR : Image cannot be loaded..!!&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    imshow(<span class="stringliteral">&quot;Image corrupted&quot;</span>, imgIn);</div>
<div class="line">    imgIn.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(imgIn, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// it needs to process even image only</span></div>
<div class="line">    <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a> roi = <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(0, 0, imgIn.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> &amp; -2, imgIn.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> &amp; -2);</div>
<div class="line">    imgIn = imgIn(roi);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// PSD calculation (start)</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imgPSD;</div>
<div class="line">    calcPSD(imgIn, imgPSD);</div>
<div class="line">    fftshift(imgPSD, imgPSD);</div>
<div class="line">    normalize(imgPSD, imgPSD, 0, 255, NORM_MINMAX);</div>
<div class="line">    <span class="comment">// PSD calculation (stop)</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//H calculation (start)</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> H = <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>(roi.<a class="code hl_function" href="../../d2/d44/classcv_1_1Rect__.html#a9c727936bddffe38079628e0ec7942cc">size</a>(), <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(1));</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> r = 21;</div>
<div class="line">    synthesizeFilterH(H, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>(705, 458), r);</div>
<div class="line">    synthesizeFilterH(H, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>(850, 391), r);</div>
<div class="line">    synthesizeFilterH(H, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>(993, 325), r);</div>
<div class="line">    <span class="comment">//H calculation (stop)</span></div>
<div class="line">    <span class="comment">// filtering (start)</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imgOut;</div>
<div class="line">    fftshift(H, H);</div>
<div class="line">    filter2DFreq(imgIn, imgOut, H);</div>
<div class="line">    <span class="comment">// filtering (stop)</span></div>
<div class="line"> </div>
<div class="line">    imgOut.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(imgOut, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);</div>
<div class="line">    normalize(imgOut, imgOut, 0, 255, NORM_MINMAX);</div>
<div class="line">    imwrite(<span class="stringliteral">&quot;result.jpg&quot;</span>, imgOut);</div>
<div class="line">    imwrite(<span class="stringliteral">&quot;PSD.jpg&quot;</span>, imgPSD);</div>
<div class="line">    fftshift(H, H);</div>
<div class="line">    normalize(H, H, 0, 255, NORM_MINMAX);</div>
<div class="line">    imshow(<span class="stringliteral">&quot;Debluring&quot;</span>, imgOut);</div>
<div class="line">    imwrite(<span class="stringliteral">&quot;filter.jpg&quot;</span>, H);</div>
<div class="line">    waitKey(0);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> fftshift(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg)</div>
<div class="line">{</div>
<div class="line">    outputImg = inputImg.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>();</div>
<div class="line">    <span class="keywordtype">int</span> cx = outputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> / 2;</div>
<div class="line">    <span class="keywordtype">int</span> cy = outputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> / 2;</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> q0(outputImg, <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(0, 0, cx, cy));</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> q1(outputImg, <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(cx, 0, cx, cy));</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> q2(outputImg, <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(0, cy, cx, cy));</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> q3(outputImg, <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(cx, cy, cx, cy));</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> tmp;</div>
<div class="line">    q0.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>(tmp);</div>
<div class="line">    q3.copyTo(q0);</div>
<div class="line">    tmp.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>(q3);</div>
<div class="line">    q1.copyTo(tmp);</div>
<div class="line">    q2.copyTo(q1);</div>
<div class="line">    tmp.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>(q2);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> filter2DFreq(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; H)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> planes[2] = { <a class="code hl_class" href="../../df/dfc/classcv_1_1Mat__.html">Mat_&lt;float&gt;</a>(inputImg.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>()), Mat::zeros(inputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>) };</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> complexI;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(planes, 2, complexI);</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#gadd6cf9baf2b8b704a11b5f04aaf4f39d">dft</a>(complexI, complexI, DFT_SCALE);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> planesH[2] = { <a class="code hl_class" href="../../df/dfc/classcv_1_1Mat__.html">Mat_&lt;float&gt;</a>(H.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>()), Mat::zeros(H.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>) };</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> complexH;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(planesH, 2, complexH);</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> complexIH;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga3ab38646463c59bf0ce962a9d51db64f">mulSpectrums</a>(complexI, complexH, complexIH, 0);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#gaa708aa2d2e57a508f968eb0f69aa5ff1">idft</a>(complexIH, complexIH);</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga0547c7fed86152d7e9d0096029c8518a">split</a>(complexIH, planes);</div>
<div class="line">    outputImg = planes[0];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> synthesizeFilterH(<a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputOutput_H, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> center, <span class="keywordtype">int</span> radius)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> c2 = center, c3 = center, c4 = center;</div>
<div class="line">    c2.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a> = inputOutput_H.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> - center.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a>;</div>
<div class="line">    c3.x = inputOutput_H.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> - center.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a>;</div>
<div class="line">    c4 = <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>(c3.x,c2.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a>);</div>
<div class="line">    <a class="code hl_enumvalue" href="../../d9/db7/group__datasets__gr.html#gga610754124ced68d1f05760b5948fbb76a6f0d8b2d9e3e947b2a5c1eff9e81ee95">circle</a>(inputOutput_H, center, radius, 0, -1, 8);</div>
<div class="line">    <a class="code hl_enumvalue" href="../../d9/db7/group__datasets__gr.html#gga610754124ced68d1f05760b5948fbb76a6f0d8b2d9e3e947b2a5c1eff9e81ee95">circle</a>(inputOutput_H, c2, radius, 0, -1, 8);</div>
<div class="line">    <a class="code hl_enumvalue" href="../../d9/db7/group__datasets__gr.html#gga610754124ced68d1f05760b5948fbb76a6f0d8b2d9e3e947b2a5c1eff9e81ee95">circle</a>(inputOutput_H, c3, radius, 0, -1, 8);</div>
<div class="line">    <a class="code hl_enumvalue" href="../../d9/db7/group__datasets__gr.html#gga610754124ced68d1f05760b5948fbb76a6f0d8b2d9e3e947b2a5c1eff9e81ee95">circle</a>(inputOutput_H, c4, radius, 0, -1, 8);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Function calculates PSD(Power spectrum density) by fft with two flags</span></div>
<div class="line"><span class="comment">// flag = 0 means to return PSD</span></div>
<div class="line"><span class="comment">// flag = 1 means to return log(PSD)</span></div>
<div class="line"><span class="keywordtype">void</span> calcPSD(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <span class="keywordtype">int</span> flag)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> planes[2] = { <a class="code hl_class" href="../../df/dfc/classcv_1_1Mat__.html">Mat_&lt;float&gt;</a>(inputImg.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>()), Mat::zeros(inputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>) };</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> complexI;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(planes, 2, complexI);</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#gadd6cf9baf2b8b704a11b5f04aaf4f39d">dft</a>(complexI, complexI);</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga0547c7fed86152d7e9d0096029c8518a">split</a>(complexI, planes);            <span class="comment">// planes[0] = Re(DFT(I)), planes[1] = Im(DFT(I))</span></div>
<div class="line"> </div>
<div class="line">    planes[0].<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(0) = 0;</div>
<div class="line">    planes[1].<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(0) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// compute the PSD = sqrt(Re(DFT(I))^2 + Im(DFT(I))^2)^2</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imgPSD;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga6d3b097586bca4409873d64a90fe64c3">magnitude</a>(planes[0], planes[1], imgPSD);        <span class="comment">//imgPSD = sqrt(Power spectrum density)</span></div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#gaf0d056b5bd1dc92500d6f6cf6bac41ef">pow</a>(imgPSD, 2, imgPSD);                         <span class="comment">//it needs ^2 in order to get PSD</span></div>
<div class="line">    outputImg = imgPSD;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// logPSD = log(1 + PSD)</span></div>
<div class="line">    <span class="keywordflow">if</span> (flag)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imglogPSD;</div>
<div class="line">        imglogPSD = imgPSD + Scalar::all(1);</div>
<div class="line">        <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga937ecdce4679a77168730830a955bea7">log</a>(imglogPSD, imglogPSD);</div>
<div class="line">        outputImg = imglogPSD;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclasscv_1_1CommandLineParser_html"><div class="ttname"><a href="../../d0/d2e/classcv_1_1CommandLineParser.html">cv::CommandLineParser</a></div><div class="ttdoc">Designed for command line parsing.</div><div class="ttdef"><b>Definition</b> utility.hpp:820</div></div>
<div class="ttc" id="aclasscv_1_1Mat___html"><div class="ttname"><a href="../../df/dfc/classcv_1_1Mat__.html">cv::Mat_</a></div><div class="ttdoc">Template matrix class derived from Mat.</div><div class="ttdef"><b>Definition</b> mat.hpp:2230</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a></div><div class="ttdoc">n-dimensional dense array class</div><div class="ttdef"><b>Definition</b> mat.hpp:812</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a03d2a2570d06dcae378f788725789aa4"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">cv::Mat::clone</a></div><div class="ttdeci">CV_NODISCARD_STD Mat clone() const</div><div class="ttdoc">Creates a full copy of the array and the underlying data.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a146f8e8dda07d1365a575ab83d9828d1"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">cv::Mat::size</a></div><div class="ttdeci">MatSize size</div><div class="ttdef"><b>Definition</b> mat.hpp:2160</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a33fd5d125b4c302b0c9aa86980791a77"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">cv::Mat::copyTo</a></div><div class="ttdeci">void copyTo(OutputArray m) const</div><div class="ttdoc">Copies the matrix to another one.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_aa10d804e90b51d4157b5c26e12c5d2df"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">cv::Mat::at</a></div><div class="ttdeci">_Tp &amp; at(int i0=0)</div><div class="ttdoc">Returns a reference to the specified array element.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_aa3e5a47585c9ef6a0842556739155e3e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cv::Mat::cols</a></div><div class="ttdeci">int cols</div><div class="ttdef"><b>Definition</b> mat.hpp:2138</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_abbec3525a852e77998aba034813fded4"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abbec3525a852e77998aba034813fded4">cv::Mat::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Returns true if the array has no elements.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_abed816466c45234254d25bc59c31245e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">cv::Mat::rows</a></div><div class="ttdeci">int rows</div><div class="ttdoc">the number of rows and columns or (-1, -1) when the matrix has more than 2 dimensions</div><div class="ttdef"><b>Definition</b> mat.hpp:2138</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_adf88c60c5b4980e05bb556080916978b"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">cv::Mat::convertTo</a></div><div class="ttdeci">void convertTo(OutputArray m, int rtype, double alpha=1, double beta=0) const</div><div class="ttdoc">Converts an array to another data type with optional scaling.</div></div>
<div class="ttc" id="aclasscv_1_1Point___html"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html">cv::Point_&lt; int &gt;</a></div></div>
<div class="ttc" id="aclasscv_1_1Point___html_a157337197338ff199e5df1a393022f15"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">cv::Point_::y</a></div><div class="ttdeci">_Tp y</div><div class="ttdoc">y coordinate of the point</div><div class="ttdef"><b>Definition</b> types.hpp:202</div></div>
<div class="ttc" id="aclasscv_1_1Point___html_a4c96fa7bdbfe390be5ed356edb274ff3"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">cv::Point_::x</a></div><div class="ttdeci">_Tp x</div><div class="ttdoc">x coordinate of the point</div><div class="ttdef"><b>Definition</b> types.hpp:201</div></div>
<div class="ttc" id="aclasscv_1_1Rect___html"><div class="ttname"><a href="../../d2/d44/classcv_1_1Rect__.html">cv::Rect_</a></div><div class="ttdoc">Template class for 2D rectangles.</div><div class="ttdef"><b>Definition</b> types.hpp:444</div></div>
<div class="ttc" id="aclasscv_1_1Rect___html_a9c727936bddffe38079628e0ec7942cc"><div class="ttname"><a href="../../d2/d44/classcv_1_1Rect__.html#a9c727936bddffe38079628e0ec7942cc">cv::Rect_::size</a></div><div class="ttdeci">Size_&lt; _Tp &gt; size() const</div><div class="ttdoc">size (width, height) of the rectangle</div></div>
<div class="ttc" id="aclasscv_1_1Scalar___html"><div class="ttname"><a href="../../d1/da0/classcv_1_1Scalar__.html">cv::Scalar_&lt; double &gt;</a></div></div>
<div class="ttc" id="agroup__core__array_html_ga0547c7fed86152d7e9d0096029c8518a"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga0547c7fed86152d7e9d0096029c8518a">cv::split</a></div><div class="ttdeci">void split(const Mat &amp;src, Mat *mvbegin)</div><div class="ttdoc">Divides a multi-channel array into several single-channel arrays.</div></div>
<div class="ttc" id="agroup__core__array_html_ga3ab38646463c59bf0ce962a9d51db64f"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga3ab38646463c59bf0ce962a9d51db64f">cv::mulSpectrums</a></div><div class="ttdeci">void mulSpectrums(InputArray a, InputArray b, OutputArray c, int flags, bool conjB=false)</div><div class="ttdoc">Performs the per-element multiplication of two Fourier spectrums.</div></div>
<div class="ttc" id="agroup__core__array_html_ga6d3b097586bca4409873d64a90fe64c3"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga6d3b097586bca4409873d64a90fe64c3">cv::magnitude</a></div><div class="ttdeci">void magnitude(InputArray x, InputArray y, OutputArray magnitude)</div><div class="ttdoc">Calculates the magnitude of 2D vectors.</div></div>
<div class="ttc" id="agroup__core__array_html_ga7d7b4d6c6ee504b30a20b1680029c7b4"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">cv::merge</a></div><div class="ttdeci">void merge(const Mat *mv, size_t count, OutputArray dst)</div><div class="ttdoc">Creates one multi-channel array out of several single-channel ones.</div></div>
<div class="ttc" id="agroup__core__array_html_ga937ecdce4679a77168730830a955bea7"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga937ecdce4679a77168730830a955bea7">cv::log</a></div><div class="ttdeci">void log(InputArray src, OutputArray dst)</div><div class="ttdoc">Calculates the natural logarithm of every array element.</div></div>
<div class="ttc" id="agroup__core__array_html_gaa708aa2d2e57a508f968eb0f69aa5ff1"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gaa708aa2d2e57a508f968eb0f69aa5ff1">cv::idft</a></div><div class="ttdeci">void idft(InputArray src, OutputArray dst, int flags=0, int nonzeroRows=0)</div><div class="ttdoc">Calculates the inverse Discrete Fourier Transform of a 1D or 2D array.</div></div>
<div class="ttc" id="agroup__core__array_html_gadd6cf9baf2b8b704a11b5f04aaf4f39d"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gadd6cf9baf2b8b704a11b5f04aaf4f39d">cv::dft</a></div><div class="ttdeci">void dft(InputArray src, OutputArray dst, int flags=0, int nonzeroRows=0)</div><div class="ttdoc">Performs a forward or inverse Discrete Fourier transform of a 1D or 2D floating-point array.</div></div>
<div class="ttc" id="agroup__core__array_html_gaf0d056b5bd1dc92500d6f6cf6bac41ef"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gaf0d056b5bd1dc92500d6f6cf6bac41ef">cv::pow</a></div><div class="ttdeci">void pow(InputArray src, double power, OutputArray dst)</div><div class="ttdoc">Raises every array element to a power.</div></div>
<div class="ttc" id="agroup__core__basic_html_ga1f6634802eeadfd7245bc75cf3e216c2"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">cv::String</a></div><div class="ttdeci">std::string String</div><div class="ttdef"><b>Definition</b> cvstd.hpp:151</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga32b18d904ee2b1731a9416a8eef67d06"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a></div><div class="ttdeci">#define CV_8U</div><div class="ttdef"><b>Definition</b> interface.h:73</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga4a3def5d72b74bed31f5f8ab7676099c"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a></div><div class="ttdeci">#define CV_32F</div><div class="ttdef"><b>Definition</b> interface.h:78</div></div>
<div class="ttc" id="agroup__datasets__gr_html_gga610754124ced68d1f05760b5948fbb76a6f0d8b2d9e3e947b2a5c1eff9e81ee95"><div class="ttname"><a href="../../d9/db7/group__datasets__gr.html#gga610754124ced68d1f05760b5948fbb76a6f0d8b2d9e3e947b2a5c1eff9e81ee95">cv::datasets::circle</a></div><div class="ttdeci">@ circle</div><div class="ttdef"><b>Definition</b> gr_skig.hpp:62</div></div>
<div class="ttc" id="ahighgui_8hpp_html"><div class="ttname"><a href="../../d4/dd5/highgui_8hpp.html">highgui.hpp</a></div></div>
<div class="ttc" id="ahighgui__qt_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition</b> highgui_qt.cpp:3</div></div>
<div class="ttc" id="aimgcodecs_8hpp_html"><div class="ttname"><a href="../../d6/d87/imgcodecs_8hpp.html">imgcodecs.hpp</a></div></div>
<div class="ttc" id="aimgproc_2include_2opencv2_2imgproc_8hpp_html"><div class="ttname"><a href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="anamespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdoc">&quot;black box&quot; representation of the file storage associated with a file on disk.</div><div class="ttdef"><b>Definition</b> core.hpp:102</div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md762"></a>
Explanation</h1>
<p>Periodic noise reduction by frequency domain filtering consists of power spectrum density calculation (for the noise spikes visual detection), notch reject filter synthesis and frequency filtering: </p><div class="fragment"><div class="line">    <span class="comment">// it needs to process even image only</span></div>
<div class="line">    <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a> roi = <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(0, 0, imgIn.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> &amp; -2, imgIn.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> &amp; -2);</div>
<div class="line">    imgIn = imgIn(roi);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// PSD calculation (start)</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imgPSD;</div>
<div class="line">    calcPSD(imgIn, imgPSD);</div>
<div class="line">    fftshift(imgPSD, imgPSD);</div>
<div class="line">    normalize(imgPSD, imgPSD, 0, 255, NORM_MINMAX);</div>
<div class="line">    <span class="comment">// PSD calculation (stop)</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//H calculation (start)</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> H = <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>(roi.<a class="code hl_function" href="../../d2/d44/classcv_1_1Rect__.html#a9c727936bddffe38079628e0ec7942cc">size</a>(), <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(1));</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> r = 21;</div>
<div class="line">    synthesizeFilterH(H, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>(705, 458), r);</div>
<div class="line">    synthesizeFilterH(H, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>(850, 391), r);</div>
<div class="line">    synthesizeFilterH(H, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>(993, 325), r);</div>
<div class="line">    <span class="comment">//H calculation (stop)</span></div>
<div class="line">    <span class="comment">// filtering (start)</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imgOut;</div>
<div class="line">    fftshift(H, H);</div>
<div class="line">    filter2DFreq(imgIn, imgOut, H);</div>
<div class="line">    <span class="comment">// filtering (stop)</span></div>
</div><!-- fragment --><p>A function calcPSD() calculates power spectrum density of an image: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> calcPSD(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <span class="keywordtype">int</span> flag)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> planes[2] = { <a class="code hl_class" href="../../df/dfc/classcv_1_1Mat__.html">Mat_&lt;float&gt;</a>(inputImg.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>()), Mat::zeros(inputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>) };</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> complexI;</div>
<div class="line">    merge(planes, 2, complexI);</div>
<div class="line">    dft(complexI, complexI);</div>
<div class="line">    split(complexI, planes);            <span class="comment">// planes[0] = Re(DFT(I)), planes[1] = Im(DFT(I))</span></div>
<div class="line"> </div>
<div class="line">    planes[0].<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(0) = 0;</div>
<div class="line">    planes[1].<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(0) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// compute the PSD = sqrt(Re(DFT(I))^2 + Im(DFT(I))^2)^2</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imgPSD;</div>
<div class="line">    magnitude(planes[0], planes[1], imgPSD);        <span class="comment">//imgPSD = sqrt(Power spectrum density)</span></div>
<div class="line">    pow(imgPSD, 2, imgPSD);                         <span class="comment">//it needs ^2 in order to get PSD</span></div>
<div class="line">    outputImg = imgPSD;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// logPSD = log(1 + PSD)</span></div>
<div class="line">    <span class="keywordflow">if</span> (flag)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imglogPSD;</div>
<div class="line">        imglogPSD = imgPSD + Scalar::all(1);</div>
<div class="line">        log(imglogPSD, imglogPSD);</div>
<div class="line">        outputImg = imglogPSD;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>A function synthesizeFilterH() forms a transfer function of an ideal circular shape notch reject filter according to a center frequency and a radius: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> synthesizeFilterH(<a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputOutput_H, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> center, <span class="keywordtype">int</span> radius)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> c2 = center, c3 = center, c4 = center;</div>
<div class="line">    c2.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a> = inputOutput_H.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> - center.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a>;</div>
<div class="line">    c3.x = inputOutput_H.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> - center.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a>;</div>
<div class="line">    c4 = <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>(c3.x,c2.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a>);</div>
<div class="line">    circle(inputOutput_H, center, radius, 0, -1, 8);</div>
<div class="line">    circle(inputOutput_H, c2, radius, 0, -1, 8);</div>
<div class="line">    circle(inputOutput_H, c3, radius, 0, -1, 8);</div>
<div class="line">    circle(inputOutput_H, c4, radius, 0, -1, 8);</div>
<div class="line">}</div>
</div><!-- fragment --><p>A function filter2DFreq() filters an image in the frequency domain. The functions fftshift() and filter2DFreq() are copied from the tutorial <a class="el" href="../../de/d3c/tutorial_out_of_focus_deblur_filter.html">Out-of-focus Deblur Filter</a>.</p>
<h1><a class="anchor" id="autotoc_md763"></a>
Result</h1>
<p>The figure below shows an image heavily corrupted by periodical noise of various frequencies. <img src="../../period_input.jpg" alt="" class="inline" title="Image corrupted by periodic noise"/>    </p>
<p>The noise components are easily seen as bright dots (spikes) in the Power spectrum density shown in the figure below. <img src="../../period_psd.jpg" alt="" class="inline" title="Power spectrum density showing periodic noise"/>    </p>
<p>The figure below shows a notch reject filter with an appropriate radius to completely enclose the noise spikes. <img src="../../period_filter.jpg" alt="" class="inline" title="Notch reject filter"/>    </p>
<p>The result of processing the image with the notch reject filter is shown below. <img src="../../period_output.jpg" alt="" class="inline" title="Result of filtering"/>    </p>
<p>The improvement is quite evident. This image contains significantly less visible periodic noise than the original image.</p>
<p>You can also find a quick video demonstration of this filtering idea on <a href="https://youtu.be/Qne51TcWwAc" target="_blank">YouTube</a>. </p><div align='center'><iframe title='Video' width='560' height='349' src='https://www.youtube.com/embed/Qne51TcWwAc?rel=0' frameborder='0' align='middle' allowfullscreen></iframe></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 2 2024 21:52:14 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.8
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
