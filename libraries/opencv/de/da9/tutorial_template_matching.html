<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>OpenCV: Template Matching</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.10.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d7/da8/tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Template Matching</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md603">Goal</a></li>
<li class="level1"><a href="#autotoc_md604">Theory</a><ul><li class="level2"><a href="#autotoc_md605">What is template matching?</a></li>
<li class="level2"><a href="#autotoc_md606">How does it work?</a></li>
<li class="level2"><a href="#autotoc_md607">How does the mask work?</a></li>
<li class="level2"><a href="#autotoc_md608">Which are the matching methods available in OpenCV?</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md609">Code</a></li>
<li class="level1"><a href="#autotoc_md610">Explanation</a></li>
<li class="level1"><a href="#autotoc_md611">Results</a></li>
</ul>
</div>
<div class="textblock"><p><b>Prev Tutorial:</b> <a class="el" href="../../da/d7f/tutorial_back_projection.html">Back Projection</a> <br  />
<b>Next Tutorial:</b> <a class="el" href="../../df/d0d/tutorial_find_contours.html">Finding contours in your image</a> <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight"></th><th class="markdownTableHeadLeft"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">Original author   </td><td class="markdownTableBodyLeft">Ana Huam√°n    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">Compatibility   </td><td class="markdownTableBodyLeft">OpenCV &gt;= 3.0   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md603"></a>
Goal</h1>
<p>In this tutorial you will learn how to:</p>
<ul>
<li>Use the OpenCV function <b>matchTemplate()</b> to search for matches between an image patch and an input image</li>
<li>Use the OpenCV function <b>minMaxLoc()</b> to find the maximum and minimum values (as well as their positions) in a given array.</li>
</ul>
<h1><a class="anchor" id="autotoc_md604"></a>
Theory</h1>
<h2><a class="anchor" id="autotoc_md605"></a>
What is template matching?</h2>
<p>Template matching is a technique for finding areas of an image that match (are similar) to a template image (patch).</p>
<p>While the patch must be a rectangle it may be that not all of the rectangle is relevant. In such a case, a mask can be used to isolate the portion of the patch that should be used to find the match.</p>
<h2><a class="anchor" id="autotoc_md606"></a>
How does it work?</h2>
<ul>
<li><p class="startli">We need two primary components:</p><ol type="1">
<li><b>Source image (I):</b> The image in which we expect to find a match to the template image</li>
<li><b>Template image (T):</b> The patch image which will be compared to the source image</li>
</ol>
<p class="startli">our goal is to detect the highest matching area:</p>
</li>
</ul>
<div class="image">
<img src="../../Template_Matching_Template_Theory_Summary.jpg" alt=""/>
</div>
    <ul>
<li>To identify the matching area, we have to <em>compare</em> the template image against the source image by sliding it:</li>
</ul>
<div class="image">
<img src="../../Template_Matching_Template_Theory_Sliding.jpg" alt=""/>
</div>
    <ul>
<li>By <b>sliding</b>, we mean moving the patch one pixel at a time (left to right, up to down). At each location, a metric is calculated so it represents how "good" or "bad" the match at that location is (or how similar the patch is to that particular area of the source image).</li>
<li>For each location of <b>T</b> over <b>I</b>, you <em>store</em> the metric in the <em>result matrix</em> <b>R</b>. Each location \((x,y)\) in <b>R</b> contains the match metric:</li>
</ul>
<div class="image">
<img src="../../Template_Matching_Template_Theory_Result.jpg" alt=""/>
</div>
    <p>the image above is the result <b>R</b> of sliding the patch with a metric <b>TM_CCORR_NORMED</b>. The brightest locations indicate the highest matches. As you can see, the location marked by the red circle is probably the one with the highest value, so that location (the rectangle formed by that point as a corner and width and height equal to the patch image) is considered the match.</p><ul>
<li>In practice, we locate the highest value (or lower, depending of the type of matching method) in the <em>R</em> matrix, using the function <b>minMaxLoc()</b></li>
</ul>
<h2><a class="anchor" id="autotoc_md607"></a>
How does the mask work?</h2>
<ul>
<li>If masking is needed for the match, three components are required:<ol type="1">
<li><b>Source image (I):</b> The image in which we expect to find a match to the template image</li>
<li><b>Template image (T):</b> The patch image which will be compared to the source image</li>
<li><b>Mask image (M):</b> The mask, a grayscale image that masks the template</li>
</ol>
</li>
<li>Only two matching methods currently accept a mask: TM_SQDIFF and TM_CCORR_NORMED (see below for explanation of all the matching methods available in opencv).</li>
<li>The mask must have the same dimensions as the template</li>
<li>The mask should have a CV_8U or CV_32F depth and the same number of channels as the template image. In CV_8U case, the mask values are treated as binary, i.e. zero and non-zero. In CV_32F case, the values should fall into [0..1] range and the template pixels will be multiplied by the corresponding mask pixel values. Since the input images in the sample have the CV_8UC3 type, the mask is also read as color image.</li>
</ul>
<div class="image">
<img src="../../Template_Matching_Mask_Example.jpg" alt=""/>
</div>
    <h2><a class="anchor" id="autotoc_md608"></a>
Which are the matching methods available in OpenCV?</h2>
<p>Good question. OpenCV implements Template matching in the function <b>matchTemplate()</b>. The available methods are 6:</p>
<ol type="1">
<li><p class="startli"><b>method=TM_SQDIFF</b></p>
<p class="formulaDsp">
\[R(x,y)= \sum _{x&#39;,y&#39;} (T(x&#39;,y&#39;)-I(x+x&#39;,y+y&#39;))^2\]
</p>
</li>
<li><p class="startli"><b>method=TM_SQDIFF_NORMED</b></p>
<p class="formulaDsp">
\[R(x,y)= \frac{\sum_{x&#39;,y&#39;} (T(x&#39;,y&#39;)-I(x+x&#39;,y+y&#39;))^2}{\sqrt{\sum_{x&#39;,y&#39;}T(x&#39;,y&#39;)^2 \cdot \sum_{x&#39;,y&#39;} I(x+x&#39;,y+y&#39;)^2}}\]
</p>
</li>
<li><p class="startli"><b>method=TM_CCORR</b></p>
<p class="formulaDsp">
\[R(x,y)= \sum _{x&#39;,y&#39;} (T(x&#39;,y&#39;)  \cdot I(x+x&#39;,y+y&#39;))\]
</p>
</li>
<li><p class="startli"><b>method=TM_CCORR_NORMED</b></p>
<p class="formulaDsp">
\[R(x,y)= \frac{\sum_{x&#39;,y&#39;} (T(x&#39;,y&#39;) \cdot I(x+x&#39;,y+y&#39;))}{\sqrt{\sum_{x&#39;,y&#39;}T(x&#39;,y&#39;)^2 \cdot \sum_{x&#39;,y&#39;} I(x+x&#39;,y+y&#39;)^2}}\]
</p>
</li>
<li><p class="startli"><b>method=TM_CCOEFF</b></p>
<p class="formulaDsp">
\[R(x,y)= \sum _{x&#39;,y&#39;} (T&#39;(x&#39;,y&#39;)  \cdot I&#39;(x+x&#39;,y+y&#39;))\]
</p>
<p class="startli">where</p>
<p class="formulaDsp">
\[\begin{array}{l} T&#39;(x&#39;,y&#39;)=T(x&#39;,y&#39;) - 1/(w  \cdot h)  \cdot \sum _{x&#39;&#39;,y&#39;&#39;} T(x&#39;&#39;,y&#39;&#39;) \\ I&#39;(x+x&#39;,y+y&#39;)=I(x+x&#39;,y+y&#39;) - 1/(w  \cdot h)  \cdot \sum _{x&#39;&#39;,y&#39;&#39;} I(x+x&#39;&#39;,y+y&#39;&#39;) \end{array}\]
</p>
</li>
<li><p class="startli"><b>method=TM_CCOEFF_NORMED</b></p>
<p class="formulaDsp">
\[R(x,y)= \frac{ \sum_{x&#39;,y&#39;} (T&#39;(x&#39;,y&#39;) \cdot I&#39;(x+x&#39;,y+y&#39;)) }{ \sqrt{\sum_{x&#39;,y&#39;}T&#39;(x&#39;,y&#39;)^2 \cdot \sum_{x&#39;,y&#39;} I&#39;(x+x&#39;,y+y&#39;)^2} }\]
</p>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md609"></a>
Code</h1>
<ul>
<li><b>What does this program do?</b><ul>
<li>Loads an input image, an image patch (<em>template</em>), and optionally a mask</li>
<li>Perform a template matching procedure by using the OpenCV function <b>matchTemplate()</b> with any of the 6 matching methods described before. The user can choose the method by entering its selection in the Trackbar. If a mask is supplied, it will only be used for the methods that support masking</li>
<li>Normalize the output of the matching procedure</li>
<li>Localize the location with higher matching probability</li>
<li>Draw a rectangle around the area corresponding to the highest match</li>
</ul>
</li>
</ul>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'><ul>
<li><b>Downloadable code</b>: Click <a href="https://github.com/opencv/opencv/tree/4.x/samples/cpp/tutorial_code/Histograms_Matching/MatchTemplate_Demo.cpp" target="_blank">here</a></li>
<li><b>Code at glance:</b> <div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d6/d87/imgcodecs_8hpp.html">opencv2/imgcodecs.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">opencv2/imgproc.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> use_mask;</div>
<div class="line"><a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> img; <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> templ; <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> mask; <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> result;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* image_window = <span class="stringliteral">&quot;Source Image&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* result_window = <span class="stringliteral">&quot;Result window&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> match_method;</div>
<div class="line"><span class="keywordtype">int</span> max_Trackbar = 5;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MatchingMethod( <span class="keywordtype">int</span>, <span class="keywordtype">void</span>* );</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* keys =</div>
<div class="line"><span class="stringliteral">&quot;{ help  h| | Print help message. }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{ @input1 | Template_Matching_Original_Image.jpg | image_name }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{ @input2 | Template_Matching_Template_Image.jpg | template_name }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{ @input3 |  | mask_name }&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv )</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_class" href="../../d0/d2e/classcv_1_1CommandLineParser.html">CommandLineParser</a> parser( argc, argv, keys );</div>
<div class="line">  samples::addSamplesDataSearchSubDirectory( <span class="stringliteral">&quot;doc/tutorials/imgproc/histograms/template_matching/images&quot;</span> );</div>
<div class="line"> </div>
<div class="line">  img = imread( samples::findFile( parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;@input1&quot;</span>) ) );</div>
<div class="line">  templ = imread( samples::findFile( parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;@input2&quot;</span>) ), IMREAD_COLOR );</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>(argc &gt; 3) {</div>
<div class="line">    use_mask = <span class="keyword">true</span>;</div>
<div class="line">    mask = imread(samples::findFile( parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;@input3&quot;</span>) ), IMREAD_COLOR );</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>(img.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#abbec3525a852e77998aba034813fded4">empty</a>() || templ.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#abbec3525a852e77998aba034813fded4">empty</a>() || (use_mask &amp;&amp; mask.empty()))</div>
<div class="line">  {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Can&#39;t read one of the images&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  namedWindow( image_window, WINDOW_AUTOSIZE );</div>
<div class="line">  namedWindow( result_window, WINDOW_AUTOSIZE );</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* trackbar_label = <span class="stringliteral">&quot;Method: \n 0: SQDIFF \n 1: SQDIFF NORMED \n 2: TM CCORR \n 3: TM CCORR NORMED \n 4: TM COEFF \n 5: TM COEFF NORMED&quot;</span>;</div>
<div class="line">  createTrackbar( trackbar_label, image_window, &amp;match_method, max_Trackbar, MatchingMethod );</div>
<div class="line"> </div>
<div class="line">  MatchingMethod( 0, 0 );</div>
<div class="line"> </div>
<div class="line">  waitKey(0);</div>
<div class="line">  <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MatchingMethod( <span class="keywordtype">int</span>, <span class="keywordtype">void</span>* )</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> img_display;</div>
<div class="line">  img.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>( img_display );</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> result_cols = img.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> - templ.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> + 1;</div>
<div class="line">  <span class="keywordtype">int</span> result_rows = img.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> - templ.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> + 1;</div>
<div class="line"> </div>
<div class="line">  result.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a55ced2c8d844d683ea9a725c60037ad0">create</a>( result_rows, result_cols, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a> );</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">bool</span> method_accepts_mask = (TM_SQDIFF == match_method || match_method == TM_CCORR_NORMED);</div>
<div class="line">  <span class="keywordflow">if</span> (use_mask &amp;&amp; method_accepts_mask)</div>
<div class="line">    { matchTemplate( img, templ, result, match_method, mask); }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    { <a class="code hl_function" href="../../df/dfb/group__imgproc__object.html#ga586ebfb0a7fb604b35a23d85391329be">matchTemplate</a>( img, templ, result, match_method); }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga87eef7ee3970f86906d69a92cbf064bd">normalize</a>( result, result, 0, 1, NORM_MINMAX, -1, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>() );</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> minVal; <span class="keywordtype">double</span> maxVal; <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> minLoc; <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> maxLoc;</div>
<div class="line">  <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> matchLoc;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="../../d2/de8/group__core__array.html#gab473bf2eb6d14ff97e89b355dac20707">minMaxLoc</a>( result, &amp;minVal, &amp;maxVal, &amp;minLoc, &amp;maxLoc, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>() );</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>( match_method  == TM_SQDIFF || match_method == TM_SQDIFF_NORMED )</div>
<div class="line">    { matchLoc = minLoc; }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    { matchLoc = maxLoc; }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">rectangle</a>( img_display, matchLoc, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>( matchLoc.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a> + templ.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> , matchLoc.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a> + templ.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> ), Scalar::all(0), 2, 8, 0 );</div>
<div class="line">  <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">rectangle</a>( result, matchLoc, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>( matchLoc.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a> + templ.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> , matchLoc.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a> + templ.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> ), Scalar::all(0), 2, 8, 0 );</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( image_window, img_display );</div>
<div class="line">  <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( result_window, result );</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclasscv_1_1CommandLineParser_html"><div class="ttname"><a href="../../d0/d2e/classcv_1_1CommandLineParser.html">cv::CommandLineParser</a></div><div class="ttdoc">Designed for command line parsing.</div><div class="ttdef"><b>Definition</b> utility.hpp:820</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a></div><div class="ttdoc">n-dimensional dense array class</div><div class="ttdef"><b>Definition</b> mat.hpp:812</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a33fd5d125b4c302b0c9aa86980791a77"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">cv::Mat::copyTo</a></div><div class="ttdeci">void copyTo(OutputArray m) const</div><div class="ttdoc">Copies the matrix to another one.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a55ced2c8d844d683ea9a725c60037ad0"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a55ced2c8d844d683ea9a725c60037ad0">cv::Mat::create</a></div><div class="ttdeci">void create(int rows, int cols, int type)</div><div class="ttdoc">Allocates new array data if needed.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_aa3e5a47585c9ef6a0842556739155e3e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cv::Mat::cols</a></div><div class="ttdeci">int cols</div><div class="ttdef"><b>Definition</b> mat.hpp:2138</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_abbec3525a852e77998aba034813fded4"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abbec3525a852e77998aba034813fded4">cv::Mat::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Returns true if the array has no elements.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_abed816466c45234254d25bc59c31245e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">cv::Mat::rows</a></div><div class="ttdeci">int rows</div><div class="ttdoc">the number of rows and columns or (-1, -1) when the matrix has more than 2 dimensions</div><div class="ttdef"><b>Definition</b> mat.hpp:2138</div></div>
<div class="ttc" id="aclasscv_1_1Point___html"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html">cv::Point_&lt; int &gt;</a></div></div>
<div class="ttc" id="aclasscv_1_1Point___html_a157337197338ff199e5df1a393022f15"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">cv::Point_::y</a></div><div class="ttdeci">_Tp y</div><div class="ttdoc">y coordinate of the point</div><div class="ttdef"><b>Definition</b> types.hpp:202</div></div>
<div class="ttc" id="aclasscv_1_1Point___html_a4c96fa7bdbfe390be5ed356edb274ff3"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">cv::Point_::x</a></div><div class="ttdeci">_Tp x</div><div class="ttdoc">x coordinate of the point</div><div class="ttdef"><b>Definition</b> types.hpp:201</div></div>
<div class="ttc" id="agroup__core__array_html_ga87eef7ee3970f86906d69a92cbf064bd"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga87eef7ee3970f86906d69a92cbf064bd">cv::normalize</a></div><div class="ttdeci">void normalize(InputArray src, InputOutputArray dst, double alpha=1, double beta=0, int norm_type=NORM_L2, int dtype=-1, InputArray mask=noArray())</div><div class="ttdoc">Normalizes the norm or value range of an array.</div></div>
<div class="ttc" id="agroup__core__array_html_gab473bf2eb6d14ff97e89b355dac20707"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gab473bf2eb6d14ff97e89b355dac20707">cv::minMaxLoc</a></div><div class="ttdeci">void minMaxLoc(InputArray src, double *minVal, double *maxVal=0, Point *minLoc=0, Point *maxLoc=0, InputArray mask=noArray())</div><div class="ttdoc">Finds the global minimum and maximum in an array.</div></div>
<div class="ttc" id="agroup__core__basic_html_ga1f6634802eeadfd7245bc75cf3e216c2"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">cv::String</a></div><div class="ttdeci">std::string String</div><div class="ttdef"><b>Definition</b> cvstd.hpp:151</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga32ec76240e43e4c9c7b2e2785180a7e6"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a></div><div class="ttdeci">#define CV_32FC1</div><div class="ttdef"><b>Definition</b> interface.h:118</div></div>
<div class="ttc" id="agroup__highgui_html_ga453d42fe4cb60e5723281a89973ee563"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv::imshow</a></div><div class="ttdeci">void imshow(const String &amp;winname, InputArray mat)</div><div class="ttdoc">Displays an image in the specified window.</div></div>
<div class="ttc" id="agroup__imgproc__draw_html_ga07d2f74cadcf8e305e810ce8eed13bc9"><div class="ttname"><a href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">cv::rectangle</a></div><div class="ttdeci">void rectangle(InputOutputArray img, Point pt1, Point pt2, const Scalar &amp;color, int thickness=1, int lineType=LINE_8, int shift=0)</div><div class="ttdoc">Draws a simple, thick, or filled up-right rectangle.</div></div>
<div class="ttc" id="agroup__imgproc__object_html_ga586ebfb0a7fb604b35a23d85391329be"><div class="ttname"><a href="../../df/dfb/group__imgproc__object.html#ga586ebfb0a7fb604b35a23d85391329be">cv::matchTemplate</a></div><div class="ttdeci">void matchTemplate(InputArray image, InputArray templ, OutputArray result, int method, InputArray mask=noArray())</div><div class="ttdoc">Compares a template against overlapped image regions.</div></div>
<div class="ttc" id="ahighgui_8hpp_html"><div class="ttname"><a href="../../d4/dd5/highgui_8hpp.html">highgui.hpp</a></div></div>
<div class="ttc" id="ahighgui__qt_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition</b> highgui_qt.cpp:3</div></div>
<div class="ttc" id="aimgcodecs_8hpp_html"><div class="ttname"><a href="../../d6/d87/imgcodecs_8hpp.html">imgcodecs.hpp</a></div></div>
<div class="ttc" id="aimgproc_2include_2opencv2_2imgproc_8hpp_html"><div class="ttname"><a href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="anamespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdoc">&quot;black box&quot; representation of the file storage associated with a file on disk.</div><div class="ttdef"><b>Definition</b> core.hpp:102</div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace.</div></div>
</div><!-- fragment --></li>
</ul>
 </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'><ul>
<li><b>Downloadable code</b>: Click <a href="https://github.com/opencv/opencv/tree/4.x/samples/java/tutorial_code/ImgProc/tutorial_template_matching/MatchTemplateDemo.java" target="_blank">here</a></li>
<li><b>Code at glance:</b> <div class="fragment"><div class="line"><span class="keyword">import</span> java.awt.GridLayout;</div>
<div class="line"><span class="keyword">import</span> java.awt.Image;</div>
<div class="line"><span class="keyword">import</span> java.util.Hashtable;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> javax.swing.ImageIcon;</div>
<div class="line"><span class="keyword">import</span> javax.swing.JFrame;</div>
<div class="line"><span class="keyword">import</span> javax.swing.JLabel;</div>
<div class="line"><span class="keyword">import</span> javax.swing.JSlider;</div>
<div class="line"><span class="keyword">import</span> javax.swing.event.ChangeEvent;</div>
<div class="line"><span class="keyword">import</span> javax.swing.event.ChangeListener;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> org.opencv.core.Core;</div>
<div class="line"><span class="keyword">import</span> org.opencv.core.CvType;</div>
<div class="line"><span class="keyword">import</span> org.opencv.core.Mat;</div>
<div class="line"><span class="keyword">import</span> org.opencv.core.Point;</div>
<div class="line"><span class="keyword">import</span> org.opencv.core.Scalar;</div>
<div class="line"><span class="keyword">import</span> org.opencv.highgui.HighGui;</div>
<div class="line"><span class="keyword">import</span> org.opencv.imgcodecs.Imgcodecs;</div>
<div class="line"><span class="keyword">import</span> org.opencv.imgproc.Imgproc;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MatchTemplateDemoRun <span class="keyword">implements</span> ChangeListener {</div>
<div class="line"> </div>
<div class="line">    Boolean use_mask = <span class="keyword">false</span>;</div>
<div class="line">    Mat img = <span class="keyword">new</span> Mat(), templ = <span class="keyword">new</span> Mat();</div>
<div class="line">    Mat mask = <span class="keyword">new</span> Mat();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> match_method;</div>
<div class="line"> </div>
<div class="line">    JLabel imgDisplay = <span class="keyword">new</span> JLabel(), resultDisplay = <span class="keyword">new</span> JLabel();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> run(String[] args) {</div>
<div class="line">        <span class="keywordflow">if</span> (args.length &lt; 2) {</div>
<div class="line">            System.out.println(<span class="stringliteral">&quot;Not enough parameters&quot;</span>);</div>
<div class="line">            System.out.println(<span class="stringliteral">&quot;Program arguments:\n&lt;image_name&gt; &lt;template_name&gt; [&lt;mask_name&gt;]&quot;</span>);</div>
<div class="line">            System.exit(-1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        img = Imgcodecs.imread(args[0], Imgcodecs.IMREAD_COLOR);</div>
<div class="line">        templ = Imgcodecs.imread(args[1], Imgcodecs.IMREAD_COLOR);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (args.length &gt; 2) {</div>
<div class="line">            use_mask = <span class="keyword">true</span>;</div>
<div class="line">            mask = Imgcodecs.imread(args[2], Imgcodecs.IMREAD_COLOR);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (img.empty() || templ.empty() || (use_mask &amp;&amp; mask.empty())) {</div>
<div class="line">            System.out.println(<span class="stringliteral">&quot;Can&#39;t read one of the images&quot;</span>);</div>
<div class="line">            System.exit(-1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        matchingMethod();</div>
<div class="line">        createJFrame();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> matchingMethod() {</div>
<div class="line">        Mat result = <span class="keyword">new</span> Mat();</div>
<div class="line"> </div>
<div class="line">        Mat img_display = <span class="keyword">new</span> Mat();</div>
<div class="line">        img.copyTo(img_display);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> result_cols = img.cols() - templ.cols() + 1;</div>
<div class="line">        <span class="keywordtype">int</span> result_rows = img.rows() - templ.rows() + 1;</div>
<div class="line"> </div>
<div class="line">        result.create(result_rows, result_cols, CvType.CV_32FC1);</div>
<div class="line"> </div>
<div class="line">        Boolean method_accepts_mask = (Imgproc.TM_SQDIFF == match_method || match_method == Imgproc.TM_CCORR_NORMED);</div>
<div class="line">        <span class="keywordflow">if</span> (use_mask &amp;&amp; method_accepts_mask) {</div>
<div class="line">            Imgproc.matchTemplate(img, templ, result, match_method, mask);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            Imgproc.matchTemplate(img, templ, result, match_method);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        Core.normalize(result, result, 0, 1, Core.NORM_MINMAX, -1, <span class="keyword">new</span> Mat());</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a> matchLoc;</div>
<div class="line"> </div>
<div class="line">        Core.MinMaxLocResult mmr = Core.minMaxLoc(result);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (match_method == Imgproc.TM_SQDIFF || match_method == Imgproc.TM_SQDIFF_NORMED) {</div>
<div class="line">            matchLoc = mmr.minLoc;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            matchLoc = mmr.maxLoc;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        Imgproc.rectangle(img_display, matchLoc, <span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a>(matchLoc.x + templ.cols(), matchLoc.y + templ.rows()),</div>
<div class="line">                <span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0, 0, 0), 2, 8, 0);</div>
<div class="line">        Imgproc.rectangle(result, matchLoc, <span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a>(matchLoc.x + templ.cols(), matchLoc.y + templ.rows()),</div>
<div class="line">                <span class="keyword">new</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0, 0, 0), 2, 8, 0);</div>
<div class="line"> </div>
<div class="line">        Image tmpImg = HighGui.toBufferedImage(img_display);</div>
<div class="line">        ImageIcon icon = <span class="keyword">new</span> ImageIcon(tmpImg);</div>
<div class="line">        imgDisplay.setIcon(icon);</div>
<div class="line"> </div>
<div class="line">        result.convertTo(result, CvType.CV_8UC1, 255.0);</div>
<div class="line">        tmpImg = HighGui.toBufferedImage(result);</div>
<div class="line">        icon = <span class="keyword">new</span> ImageIcon(tmpImg);</div>
<div class="line">        resultDisplay.setIcon(icon);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    @Override</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> stateChanged(ChangeEvent e) {</div>
<div class="line">        JSlider source = (JSlider) e.getSource();</div>
<div class="line">        <span class="keywordflow">if</span> (!source.getValueIsAdjusting()) {</div>
<div class="line">            match_method = source.getValue();</div>
<div class="line">            matchingMethod();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> createJFrame() {</div>
<div class="line">        <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a> title = <span class="stringliteral">&quot;Source image; Control; Result image&quot;</span>;</div>
<div class="line">        JFrame frame = <span class="keyword">new</span> JFrame(title);</div>
<div class="line">        frame.setLayout(<span class="keyword">new</span> GridLayout(2, 2));</div>
<div class="line">        frame.add(imgDisplay);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga9af368f182ee76d0463d0d8d5330b764">min</a> = 0, <a class="code hl_function" href="../../d2/de8/group__core__array.html#gacc40fa15eac0fb83f8ca70b7cc0b588d">max</a> = 5;</div>
<div class="line">        JSlider slider = <span class="keyword">new</span> JSlider(JSlider.VERTICAL, min, max, match_method);</div>
<div class="line"> </div>
<div class="line">        slider.setPaintTicks(<span class="keyword">true</span>);</div>
<div class="line">        slider.setPaintLabels(<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set the spacing for the minor tick mark</span></div>
<div class="line">        slider.setMinorTickSpacing(1);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Customizing the labels</span></div>
<div class="line">        Hashtable&lt;Integer, JLabel&gt; labelTable = <span class="keyword">new</span> Hashtable&lt;&gt;();</div>
<div class="line">        labelTable.put(<span class="keyword">new</span> Integer(0), <span class="keyword">new</span> JLabel(<span class="stringliteral">&quot;0 - SQDIFF&quot;</span>));</div>
<div class="line">        labelTable.put(<span class="keyword">new</span> Integer(1), <span class="keyword">new</span> JLabel(<span class="stringliteral">&quot;1 - SQDIFF NORMED&quot;</span>));</div>
<div class="line">        labelTable.put(<span class="keyword">new</span> Integer(2), <span class="keyword">new</span> JLabel(<span class="stringliteral">&quot;2 - TM CCORR&quot;</span>));</div>
<div class="line">        labelTable.put(<span class="keyword">new</span> Integer(3), <span class="keyword">new</span> JLabel(<span class="stringliteral">&quot;3 - TM CCORR NORMED&quot;</span>));</div>
<div class="line">        labelTable.put(<span class="keyword">new</span> Integer(4), <span class="keyword">new</span> JLabel(<span class="stringliteral">&quot;4 - TM COEFF&quot;</span>));</div>
<div class="line">        labelTable.put(<span class="keyword">new</span> Integer(5), <span class="keyword">new</span> JLabel(<span class="stringliteral">&quot;5 - TM COEFF NORMED : (Method)&quot;</span>));</div>
<div class="line">        slider.setLabelTable(labelTable);</div>
<div class="line"> </div>
<div class="line">        slider.addChangeListener(<span class="keyword">this</span>);</div>
<div class="line"> </div>
<div class="line">        frame.add(slider);</div>
<div class="line"> </div>
<div class="line">        frame.add(resultDisplay);</div>
<div class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</div>
<div class="line">        frame.pack();</div>
<div class="line">        frame.setVisible(<span class="keyword">true</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>MatchTemplateDemo {</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(String[] args) {</div>
<div class="line">        <span class="comment">// load the native OpenCV library</span></div>
<div class="line">        System.loadLibrary(Core.NATIVE_LIBRARY_NAME);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// run code</span></div>
<div class="line">        <span class="keyword">new</span> MatchTemplateDemoRun().run(args);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__core__array_html_ga9af368f182ee76d0463d0d8d5330b764"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga9af368f182ee76d0463d0d8d5330b764">cv::min</a></div><div class="ttdeci">void min(InputArray src1, InputArray src2, OutputArray dst)</div><div class="ttdoc">Calculates per-element minimum of two arrays or an array and a scalar.</div></div>
<div class="ttc" id="agroup__core__array_html_gacc40fa15eac0fb83f8ca70b7cc0b588d"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gacc40fa15eac0fb83f8ca70b7cc0b588d">cv::max</a></div><div class="ttdeci">void max(InputArray src1, InputArray src2, OutputArray dst)</div><div class="ttdoc">Calculates per-element maximum of two arrays or an array and a scalar.</div></div>
<div class="ttc" id="agroup__core__basic_html_ga1e83eafb2d26b3c93f09e8338bcab192"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">cv::Point</a></div><div class="ttdeci">Point2i Point</div><div class="ttdef"><b>Definition</b> types.hpp:209</div></div>
<div class="ttc" id="agroup__core__basic_html_ga599fe92e910c027be274233eccad7beb"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">cv::Scalar</a></div><div class="ttdeci">Scalar_&lt; double &gt; Scalar</div><div class="ttdef"><b>Definition</b> types.hpp:702</div></div>
</div><!-- fragment --></li>
</ul>
 </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'><ul>
<li><b>Downloadable code</b>: Click <a href="https://github.com/opencv/opencv/tree/4.x/samples/python/tutorial_code/imgProc/match_template/match_template.py" target="_blank">here</a></li>
<li><b>Code at glance:</b> <div class="fragment"><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</div>
<div class="line"><span class="keyword">import</span> sys</div>
<div class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">use_mask = <span class="keyword">False</span></div>
<div class="line">img = <span class="keywordtype">None</span></div>
<div class="line">templ = <span class="keywordtype">None</span></div>
<div class="line">mask = <span class="keywordtype">None</span></div>
<div class="line">image_window = <span class="stringliteral">&quot;Source Image&quot;</span></div>
<div class="line">result_window = <span class="stringliteral">&quot;Result window&quot;</span></div>
<div class="line"> </div>
<div class="line">match_method = 0</div>
<div class="line">max_Trackbar = 5</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span><a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(argv):</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (len(sys.argv) &lt; 3):</div>
<div class="line">        print(<span class="stringliteral">&#39;Not enough parameters&#39;</span>)</div>
<div class="line">        print(<span class="stringliteral">&#39;Usage:\nmatch_template_demo.py &lt;image_name&gt; &lt;template_name&gt; [&lt;mask_name&gt;]&#39;</span>)</div>
<div class="line">        <span class="keywordflow">return</span> -1</div>
<div class="line"> </div>
<div class="line">    </div>
<div class="line">    <span class="keyword">global</span> img</div>
<div class="line">    <span class="keyword">global</span> templ</div>
<div class="line">    img = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv.imread</a>(sys.argv[1], cv.IMREAD_COLOR)</div>
<div class="line">    templ = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv.imread</a>(sys.argv[2], cv.IMREAD_COLOR)</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (len(sys.argv) &gt; 3):</div>
<div class="line">        <span class="keyword">global</span> use_mask</div>
<div class="line">        use_mask = <span class="keyword">True</span></div>
<div class="line">        <span class="keyword">global</span> mask</div>
<div class="line">        mask = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv.imread</a>( sys.argv[3], cv.IMREAD_COLOR )</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((img <span class="keywordflow">is</span> <span class="keywordtype">None</span>) <span class="keywordflow">or</span> (templ <span class="keywordflow">is</span> <span class="keywordtype">None</span>) <span class="keywordflow">or</span> (use_mask <span class="keywordflow">and</span> (mask <span class="keywordflow">is</span> <span class="keywordtype">None</span>))):</div>
<div class="line">        print(<span class="stringliteral">&#39;Can\&#39;t read one of the images&#39;</span>)</div>
<div class="line">        <span class="keywordflow">return</span> -1</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    </div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">cv.namedWindow</a>( image_window, cv.WINDOW_AUTOSIZE )</div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">cv.namedWindow</a>( result_window, cv.WINDOW_AUTOSIZE )</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    </div>
<div class="line">    trackbar_label = <span class="stringliteral">&#39;Method: \n 0: SQDIFF \n 1: SQDIFF NORMED \n 2: TM CCORR \n 3: TM CCORR NORMED \n 4: TM COEFF \n 5: TM COEFF NORMED&#39;</span></div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#gaf78d2155d30b728fc413803745b67a9b">cv.createTrackbar</a>( trackbar_label, image_window, match_method, max_Trackbar, MatchingMethod )</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    MatchingMethod(match_method)</div>
<div class="line"> </div>
<div class="line">    </div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv.waitKey</a>(0)</div>
<div class="line">    <span class="keywordflow">return</span> 0</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>MatchingMethod(param):</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">global</span> match_method</div>
<div class="line">    match_method = param</div>
<div class="line"> </div>
<div class="line">    </div>
<div class="line">    img_display = img.copy()</div>
<div class="line">    </div>
<div class="line">    method_accepts_mask = (cv.TM_SQDIFF == match_method <span class="keywordflow">or</span> match_method == cv.TM_CCORR_NORMED)</div>
<div class="line">    <span class="keywordflow">if</span> (use_mask <span class="keywordflow">and</span> method_accepts_mask):</div>
<div class="line">        result = <a class="code hl_function" href="../../df/dfb/group__imgproc__object.html#ga586ebfb0a7fb604b35a23d85391329be">cv.matchTemplate</a>(img, templ, match_method, <span class="keywordtype">None</span>, mask)</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        result = <a class="code hl_function" href="../../df/dfb/group__imgproc__object.html#ga586ebfb0a7fb604b35a23d85391329be">cv.matchTemplate</a>(img, templ, match_method)</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    </div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga87eef7ee3970f86906d69a92cbf064bd">cv.normalize</a>( result, result, 0, 1, cv.NORM_MINMAX, -1 )</div>
<div class="line">    </div>
<div class="line">    _minVal, _maxVal, minLoc, maxLoc = <a class="code hl_function" href="../../d2/de8/group__core__array.html#gab473bf2eb6d14ff97e89b355dac20707">cv.minMaxLoc</a>(result, <span class="keywordtype">None</span>)</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (match_method == cv.TM_SQDIFF <span class="keywordflow">or</span> match_method == cv.TM_SQDIFF_NORMED):</div>
<div class="line">        matchLoc = minLoc</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        matchLoc = maxLoc</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    </div>
<div class="line">    <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">cv.rectangle</a>(img_display, matchLoc, (matchLoc[0] + templ.shape[0], matchLoc[1] + templ.shape[1]), (0,0,0), 2, 8, 0 )</div>
<div class="line">    <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">cv.rectangle</a>(result, matchLoc, (matchLoc[0] + templ.shape[0], matchLoc[1] + templ.shape[1]), (0,0,0), 2, 8, 0 )</div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(image_window, img_display)</div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(result_window, result)</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">pass</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(sys.argv[1:])</div>
<div class="ttc" id="agroup__highgui_html_ga5628525ad33f52eab17feebcfba38bd7"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv::waitKey</a></div><div class="ttdeci">int waitKey(int delay=0)</div><div class="ttdoc">Waits for a pressed key.</div></div>
<div class="ttc" id="agroup__highgui_html_ga5afdf8410934fd099df85c75b2e0888b"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">cv::namedWindow</a></div><div class="ttdeci">void namedWindow(const String &amp;winname, int flags=WINDOW_AUTOSIZE)</div><div class="ttdoc">Creates a window.</div></div>
<div class="ttc" id="agroup__highgui_html_gaf78d2155d30b728fc413803745b67a9b"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#gaf78d2155d30b728fc413803745b67a9b">cv::createTrackbar</a></div><div class="ttdeci">int createTrackbar(const String &amp;trackbarname, const String &amp;winname, int *value, int count, TrackbarCallback onChange=0, void *userdata=0)</div><div class="ttdoc">Creates a trackbar and attaches it to the specified window.</div></div>
<div class="ttc" id="agroup__imgcodecs_html_gab32ee19e22660912565f8140d0f675a8"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv::imread</a></div><div class="ttdeci">CV_EXPORTS_W Mat imread(const String &amp;filename, int flags=IMREAD_COLOR)</div><div class="ttdoc">Loads an image from a file.</div></div>
</div><!-- fragment --></li>
</ul>
 </div> <h1><a class="anchor" id="autotoc_md610"></a>
Explanation</h1>
<ul>
<li><p class="startli">Declare some global variables, such as the image, template and result matrices, as well as the match method and the window names:</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> use_mask;</div>
<div class="line"><a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> img; <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> templ; <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> mask; <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> result;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* image_window = <span class="stringliteral">&quot;Source Image&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* result_window = <span class="stringliteral">&quot;Result window&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> match_method;</div>
<div class="line"><span class="keywordtype">int</span> max_Trackbar = 5;</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">    Boolean use_mask = <span class="keyword">false</span>;</div>
<div class="line">    Mat img = <span class="keyword">new</span> Mat(), templ = <span class="keyword">new</span> Mat();</div>
<div class="line">    Mat mask = <span class="keyword">new</span> Mat();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> match_method;</div>
<div class="line"> </div>
<div class="line">    JLabel imgDisplay = <span class="keyword">new</span> JLabel(), resultDisplay = <span class="keyword">new</span> JLabel();</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">use_mask = <span class="keyword">False</span></div>
<div class="line">img = <span class="keywordtype">None</span></div>
<div class="line">templ = <span class="keywordtype">None</span></div>
<div class="line">mask = <span class="keywordtype">None</span></div>
<div class="line">image_window = <span class="stringliteral">&quot;Source Image&quot;</span></div>
<div class="line">result_window = <span class="stringliteral">&quot;Result window&quot;</span></div>
<div class="line"> </div>
<div class="line">match_method = 0</div>
<div class="line">max_Trackbar = 5</div>
</div><!-- fragment -->  </div> </li>
<li><p class="startli">Load the source image, template, and optionally, if supported for the matching method, a mask:</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">  img = imread( samples::findFile( parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;@input1&quot;</span>) ) );</div>
<div class="line">  templ = imread( samples::findFile( parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;@input2&quot;</span>) ), IMREAD_COLOR );</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>(argc &gt; 3) {</div>
<div class="line">    use_mask = <span class="keyword">true</span>;</div>
<div class="line">    mask = imread(samples::findFile( parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;@input3&quot;</span>) ), IMREAD_COLOR );</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>(img.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#abbec3525a852e77998aba034813fded4">empty</a>() || templ.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#abbec3525a852e77998aba034813fded4">empty</a>() || (use_mask &amp;&amp; mask.empty()))</div>
<div class="line">  {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Can&#39;t read one of the images&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">  }</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">        img = Imgcodecs.imread(args[0], Imgcodecs.IMREAD_COLOR);</div>
<div class="line">        templ = Imgcodecs.imread(args[1], Imgcodecs.IMREAD_COLOR);</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">    <span class="keyword">global</span> img</div>
<div class="line">    <span class="keyword">global</span> templ</div>
<div class="line">    img = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv.imread</a>(sys.argv[1], cv.IMREAD_COLOR)</div>
<div class="line">    templ = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv.imread</a>(sys.argv[2], cv.IMREAD_COLOR)</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (len(sys.argv) &gt; 3):</div>
<div class="line">        <span class="keyword">global</span> use_mask</div>
<div class="line">        use_mask = <span class="keyword">True</span></div>
<div class="line">        <span class="keyword">global</span> mask</div>
<div class="line">        mask = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv.imread</a>( sys.argv[3], cv.IMREAD_COLOR )</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((img <span class="keywordflow">is</span> <span class="keywordtype">None</span>) <span class="keywordflow">or</span> (templ <span class="keywordflow">is</span> <span class="keywordtype">None</span>) <span class="keywordflow">or</span> (use_mask <span class="keywordflow">and</span> (mask <span class="keywordflow">is</span> <span class="keywordtype">None</span>))):</div>
<div class="line">        print(<span class="stringliteral">&#39;Can\&#39;t read one of the images&#39;</span>)</div>
<div class="line">        <span class="keywordflow">return</span> -1</div>
</div><!-- fragment -->  </div> </li>
<li><p class="startli">Create the Trackbar to enter the kind of matching method to be used. When a change is detected the callback function is called.</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* trackbar_label = <span class="stringliteral">&quot;Method: \n 0: SQDIFF \n 1: SQDIFF NORMED \n 2: TM CCORR \n 3: TM CCORR NORMED \n 4: TM COEFF \n 5: TM COEFF NORMED&quot;</span>;</div>
<div class="line">  createTrackbar( trackbar_label, image_window, &amp;match_method, max_Trackbar, MatchingMethod );</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line">        <span class="keywordtype">int</span> min = 0, max = 5;</div>
<div class="line">        JSlider slider = <span class="keyword">new</span> JSlider(JSlider.VERTICAL, min, max, match_method);</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">    trackbar_label = <span class="stringliteral">&#39;Method: \n 0: SQDIFF \n 1: SQDIFF NORMED \n 2: TM CCORR \n 3: TM CCORR NORMED \n 4: TM COEFF \n 5: TM COEFF NORMED&#39;</span></div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#gaf78d2155d30b728fc413803745b67a9b">cv.createTrackbar</a>( trackbar_label, image_window, match_method, max_Trackbar, MatchingMethod )</div>
</div><!-- fragment -->  </div> </li>
<li><p class="startli">Let's check out the callback function. First, it makes a copy of the source image:</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">  <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> img_display;</div>
<div class="line">  img.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>( img_display );</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">        Mat img_display = <span class="keyword">new</span> Mat();</div>
<div class="line">        img.copyTo(img_display);</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">    img_display = img.copy()</div>
</div><!-- fragment -->  </div> </li>
<li><p class="startli">Perform the template matching operation. The arguments are naturally the input image <b>I</b>, the template <b>T</b>, the result <b>R</b> and the match_method (given by the Trackbar), and optionally the mask image <b>M</b>.</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">  <span class="keywordtype">bool</span> method_accepts_mask = (TM_SQDIFF == match_method || match_method == TM_CCORR_NORMED);</div>
<div class="line">  <span class="keywordflow">if</span> (use_mask &amp;&amp; method_accepts_mask)</div>
<div class="line">    { matchTemplate( img, templ, result, match_method, mask); }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    { matchTemplate( img, templ, result, match_method); }</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">        Boolean method_accepts_mask = (Imgproc.TM_SQDIFF == match_method || match_method == Imgproc.TM_CCORR_NORMED);</div>
<div class="line">        <span class="keywordflow">if</span> (use_mask &amp;&amp; method_accepts_mask) {</div>
<div class="line">            Imgproc.matchTemplate(img, templ, result, match_method, mask);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            Imgproc.matchTemplate(img, templ, result, match_method);</div>
<div class="line">        }</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">    method_accepts_mask = (cv.TM_SQDIFF == match_method <span class="keywordflow">or</span> match_method == cv.TM_CCORR_NORMED)</div>
<div class="line">    <span class="keywordflow">if</span> (use_mask <span class="keywordflow">and</span> method_accepts_mask):</div>
<div class="line">        result = <a class="code hl_function" href="../../df/dfb/group__imgproc__object.html#ga586ebfb0a7fb604b35a23d85391329be">cv.matchTemplate</a>(img, templ, match_method, <span class="keywordtype">None</span>, mask)</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        result = <a class="code hl_function" href="../../df/dfb/group__imgproc__object.html#ga586ebfb0a7fb604b35a23d85391329be">cv.matchTemplate</a>(img, templ, match_method)</div>
</div><!-- fragment -->  </div> </li>
<li><p class="startli">We normalize the results:</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line">  normalize( result, result, 0, 1, NORM_MINMAX, -1, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>() );</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line">        Core.normalize(result, result, 0, 1, Core.NORM_MINMAX, -1, <span class="keyword">new</span> Mat());</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga87eef7ee3970f86906d69a92cbf064bd">cv.normalize</a>( result, result, 0, 1, cv.NORM_MINMAX, -1 )</div>
</div><!-- fragment -->  </div> </li>
<li><p class="startli">We localize the minimum and maximum values in the result matrix <b>R</b> by using <b>minMaxLoc()</b>.</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> minVal; <span class="keywordtype">double</span> maxVal; <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> minLoc; <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> maxLoc;</div>
<div class="line">  <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> matchLoc;</div>
<div class="line"> </div>
<div class="line">  minMaxLoc( result, &amp;minVal, &amp;maxVal, &amp;minLoc, &amp;maxLoc, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>() );</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">        Point matchLoc;</div>
<div class="line"> </div>
<div class="line">        Core.MinMaxLocResult mmr = Core.minMaxLoc(result);</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">    _minVal, _maxVal, minLoc, maxLoc = <a class="code hl_function" href="../../d2/de8/group__core__array.html#gab473bf2eb6d14ff97e89b355dac20707">cv.minMaxLoc</a>(result, <span class="keywordtype">None</span>)</div>
</div><!-- fragment -->  </div> </li>
<li><p class="startli">For the first two methods ( TM_SQDIFF and MT_SQDIFF_NORMED ) the best match are the lowest values. For all the others, higher values represent better matches. So, we save the corresponding value in the <b>matchLoc</b> variable:</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>( match_method  == TM_SQDIFF || match_method == TM_SQDIFF_NORMED )</div>
<div class="line">    { matchLoc = minLoc; }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    { matchLoc = maxLoc; }</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (match_method == Imgproc.TM_SQDIFF || match_method == Imgproc.TM_SQDIFF_NORMED) {</div>
<div class="line">            matchLoc = mmr.minLoc;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            matchLoc = mmr.maxLoc;</div>
<div class="line">        }</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">    <span class="keywordflow">if</span> (match_method == cv.TM_SQDIFF <span class="keywordflow">or</span> match_method == cv.TM_SQDIFF_NORMED):</div>
<div class="line">        matchLoc = minLoc</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        matchLoc = maxLoc</div>
</div><!-- fragment -->  </div> </li>
<li><p class="startli">Display the source image and the result matrix. Draw a rectangle around the highest possible matching area:</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">  rectangle( img_display, matchLoc, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>( matchLoc.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a> + templ.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> , matchLoc.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a> + templ.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> ), Scalar::all(0), 2, 8, 0 );</div>
<div class="line">  rectangle( result, matchLoc, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>( matchLoc.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a> + templ.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> , matchLoc.<a class="code hl_variable" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a> + templ.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> ), Scalar::all(0), 2, 8, 0 );</div>
<div class="line"> </div>
<div class="line">  imshow( image_window, img_display );</div>
<div class="line">  imshow( result_window, result );</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='java' style='display: none;'>Java</div><div class='toggleable_div label_java' style='display: none;'> <div class="fragment"><div class="line"> </div>
<div class="line">        Imgproc.rectangle(img_display, matchLoc, <span class="keyword">new</span> Point(matchLoc.x + templ.cols(), matchLoc.y + templ.rows()),</div>
<div class="line">                <span class="keyword">new</span> Scalar(0, 0, 0), 2, 8, 0);</div>
<div class="line">        Imgproc.rectangle(result, matchLoc, <span class="keyword">new</span> Point(matchLoc.x + templ.cols(), matchLoc.y + templ.rows()),</div>
<div class="line">                <span class="keyword">new</span> Scalar(0, 0, 0), 2, 8, 0);</div>
<div class="line"> </div>
<div class="line">        Image tmpImg = HighGui.toBufferedImage(img_display);</div>
<div class="line">        ImageIcon icon = <span class="keyword">new</span> ImageIcon(tmpImg);</div>
<div class="line">        imgDisplay.setIcon(icon);</div>
<div class="line"> </div>
<div class="line">        result.convertTo(result, CvType.CV_8UC1, 255.0);</div>
<div class="line">        tmpImg = HighGui.toBufferedImage(result);</div>
<div class="line">        icon = <span class="keyword">new</span> ImageIcon(tmpImg);</div>
<div class="line">        resultDisplay.setIcon(icon);</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">    <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">cv.rectangle</a>(img_display, matchLoc, (matchLoc[0] + templ.shape[0], matchLoc[1] + templ.shape[1]), (0,0,0), 2, 8, 0 )</div>
<div class="line">    <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">cv.rectangle</a>(result, matchLoc, (matchLoc[0] + templ.shape[0], matchLoc[1] + templ.shape[1]), (0,0,0), 2, 8, 0 )</div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(image_window, img_display)</div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(result_window, result)</div>
</div><!-- fragment -->  </div> </li>
</ul>
<h1><a class="anchor" id="autotoc_md611"></a>
Results</h1>
<ol type="1">
<li>Testing our program with an input image such as:</li>
</ol>
<div class="image">
<img src="../../Template_Matching_Original_Image.jpg" alt=""/>
</div>
    <p>and a template image:</p>
<div class="image">
<img src="../../Template_Matching_Template_Image.jpg" alt=""/>
</div>
    <ol type="1">
<li>Generate the following result matrices (first row are the standard methods SQDIFF, CCORR and CCOEFF, second row are the same methods in its normalized version). In the first column, the darkest is the better match, for the other two columns, the brighter a location, the higher the match. <img src="../../Template_Matching_Correl_Result_0.jpg" alt="" class="inline" title="Result_0"/>     <img src="../../Template_Matching_Correl_Result_1.jpg" alt="" class="inline" title="Result_1"/>     <img src="../../Template_Matching_Correl_Result_2.jpg" alt="" class="inline" title="Result_2"/>     <img src="../../Template_Matching_Correl_Result_3.jpg" alt="" class="inline" title="Result_3"/>     <img src="../../Template_Matching_Correl_Result_4.jpg" alt="" class="inline" title="Result_4"/>     <img src="../../Template_Matching_Correl_Result_5.jpg" alt="" class="inline" title="Result_5"/>    </li>
<li>The right match is shown below (black rectangle around the face of the guy at the right). Notice that CCORR and CCDEFF gave erroneous best matches, however their normalized version did it right, this may be due to the fact that we are only considering the "highest match" and not the other possible high matches.</li>
</ol>
<div class="image">
<img src="../../Template_Matching_Image_Result.jpg" alt=""/>
</div>
     </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 2 2024 21:52:13 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.8
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
