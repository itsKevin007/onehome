<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>OpenCV: Decode Gray code pattern tutorial</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.10.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d3/d81/tutorial_contrib_root.html">Tutorials for contrib modules</a></li><li class="navelem"><a class="el" href="../../d3/d81/tutorial_structured_light.html">Structured Light tutorials</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Decode Gray code pattern tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md2011"></a>
Goal</h1>
<p>In this tutorial you will learn how to use the <em>GrayCodePattern</em> class to:</p>
<ul>
<li>Decode a previously acquired Gray code pattern.</li>
<li>Generate a disparity map.</li>
<li>Generate a pointcloud.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2012"></a>
Code</h1>
<div class="fragment"><div class="line"><span class="comment">/*M///////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"> //</span></div>
<div class="line"><span class="comment"> //  IMPORTANT: READ BEFORE DOWNLOADING, COPYING, INSTALLING OR USING.</span></div>
<div class="line"><span class="comment"> //</span></div>
<div class="line"><span class="comment"> //  By downloading, copying, installing or using the software you agree to this license.</span></div>
<div class="line"><span class="comment"> //  If you do not agree to this license, do not download, install,</span></div>
<div class="line"><span class="comment"> //  copy or use the software.</span></div>
<div class="line"><span class="comment"> //</span></div>
<div class="line"><span class="comment"> //</span></div>
<div class="line"><span class="comment"> //                           License Agreement</span></div>
<div class="line"><span class="comment"> //                For Open Source Computer Vision Library</span></div>
<div class="line"><span class="comment"> //</span></div>
<div class="line"><span class="comment"> // Copyright (C) 2015, OpenCV Foundation, all rights reserved.</span></div>
<div class="line"><span class="comment"> // Third party copyrights are property of their respective owners.</span></div>
<div class="line"><span class="comment"> //</span></div>
<div class="line"><span class="comment"> // Redistribution and use in source and binary forms, with or without modification,</span></div>
<div class="line"><span class="comment"> // are permitted provided that the following conditions are met:</span></div>
<div class="line"><span class="comment"> //</span></div>
<div class="line"><span class="comment"> //   * Redistribution&#39;s of source code must retain the above copyright notice,</span></div>
<div class="line"><span class="comment"> //     this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> //</span></div>
<div class="line"><span class="comment"> //   * Redistribution&#39;s in binary form must reproduce the above copyright notice,</span></div>
<div class="line"><span class="comment"> //     this list of conditions and the following disclaimer in the documentation</span></div>
<div class="line"><span class="comment"> //     and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment"> //</span></div>
<div class="line"><span class="comment"> //   * The name of the copyright holders may not be used to endorse or promote products</span></div>
<div class="line"><span class="comment"> //     derived from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> //</span></div>
<div class="line"><span class="comment"> // This software is provided by the copyright holders and contributors &quot;as is&quot; and</span></div>
<div class="line"><span class="comment"> // any express or implied warranties, including, but not limited to, the implied</span></div>
<div class="line"><span class="comment"> // warranties of merchantability and fitness for a particular purpose are disclaimed.</span></div>
<div class="line"><span class="comment"> // In no event shall the Intel Corporation or contributors be liable for any direct,</span></div>
<div class="line"><span class="comment"> // indirect, incidental, special, exemplary, or consequential damages</span></div>
<div class="line"><span class="comment"> // (including, but not limited to, procurement of substitute goods or services;</span></div>
<div class="line"><span class="comment"> // loss of use, data, or profits; or business interruption) however caused</span></div>
<div class="line"><span class="comment"> // and on any theory of liability, whether in contract, strict liability,</span></div>
<div class="line"><span class="comment"> // or tort (including negligence or otherwise) arising in any way out of</span></div>
<div class="line"><span class="comment"> // the use of this software, even if advised of the possibility of such damage.</span></div>
<div class="line"><span class="comment"> //</span></div>
<div class="line"><span class="comment"> //M*/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d0/d9c/core_2include_2opencv2_2core_8hpp.html">opencv2/core.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d2/d28/calib3d_8hpp.html">opencv2/calib3d.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">opencv2/imgproc.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d3/d23/structured__light_8hpp.html">opencv2/structured_light.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;opencv2/opencv_modules.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// (if you did not build the opencv_viz module, you will only see the disparity images)</span></div>
<div class="line"><span class="preprocessor">#ifdef HAVE_OPENCV_VIZ</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d0/d7e/viz_8hpp.html">opencv2/viz.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* keys =</div>
<div class="line">{ <span class="stringliteral">&quot;{@images_list | | Image list where the captured pattern images are saved}&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{@calib_param_path     | | Calibration_parameters            }&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{@proj_width      | | The projector width used to acquire the pattern          }&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{@proj_height     | | The projector height used to acquire the pattern}&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{@white_thresh     | | The white threshold height (optional)}&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{@black_thresh     | | The black threshold (optional)}&quot;</span> };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> help()</div>
<div class="line">{</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;\nThis example shows how to use the \&quot;Structured Light module\&quot; to decode a previously acquired gray code pattern, generating a pointcloud&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\nCall:\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;./example_structured_light_pointcloud &lt;images_list&gt; &lt;calib_param_path&gt; &lt;proj_width&gt; &lt;proj_height&gt; &lt;white_thresh&gt; &lt;black_thresh&gt;\n&quot;</span></div>
<div class="line">        &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> readStringList( <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; filename, vector&lt;string&gt;&amp; l )</div>
<div class="line">{</div>
<div class="line">  l.resize( 0 );</div>
<div class="line">  <a class="code hl_class" href="../../da/d56/classcv_1_1FileStorage.html">FileStorage</a> fs( filename, FileStorage::READ );</div>
<div class="line">  <span class="keywordflow">if</span>( !fs.isOpened() )</div>
<div class="line">  {</div>
<div class="line">    cerr &lt;&lt; <span class="stringliteral">&quot;failed to open &quot;</span> &lt;&lt; filename &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">  }</div>
<div class="line">  <a class="code hl_class" href="../../de/dd9/classcv_1_1FileNode.html">FileNode</a> n = fs.getFirstTopLevelNode();</div>
<div class="line">  <span class="keywordflow">if</span>( n.<a class="code hl_function" href="../../de/dd9/classcv_1_1FileNode.html#ad0fd448e25719a94320ebe574b87f997">type</a>() != FileNode::SEQ )</div>
<div class="line">  {</div>
<div class="line">    cerr &lt;&lt; <span class="stringliteral">&quot;cam 1 images are not a sequence! FAIL&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="../../d7/d4e/classcv_1_1FileNodeIterator.html">FileNodeIterator</a> it = n.<a class="code hl_function" href="../../de/dd9/classcv_1_1FileNode.html#a0f299820227506079f5b9013dd8c3558">begin</a>(), it_end = n.<a class="code hl_function" href="../../de/dd9/classcv_1_1FileNode.html#a58b033e34726eb73f0238a1bfbe0c8e9">end</a>();</div>
<div class="line">  <span class="keywordflow">for</span>( ; it != it_end; ++it )</div>
<div class="line">  {</div>
<div class="line">    l.push_back( ( <span class="keywordtype">string</span> ) *it );</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  n = fs[<span class="stringliteral">&quot;cam2&quot;</span>];</div>
<div class="line">  <span class="keywordflow">if</span>( n.<a class="code hl_function" href="../../de/dd9/classcv_1_1FileNode.html#ad0fd448e25719a94320ebe574b87f997">type</a>() != FileNode::SEQ )</div>
<div class="line">  {</div>
<div class="line">    cerr &lt;&lt; <span class="stringliteral">&quot;cam 2 images are not a sequence! FAIL&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  it = n.<a class="code hl_function" href="../../de/dd9/classcv_1_1FileNode.html#a0f299820227506079f5b9013dd8c3558">begin</a>(), it_end = n.<a class="code hl_function" href="../../de/dd9/classcv_1_1FileNode.html#a58b033e34726eb73f0238a1bfbe0c8e9">end</a>();</div>
<div class="line">  <span class="keywordflow">for</span>( ; it != it_end; ++it )</div>
<div class="line">  {</div>
<div class="line">    l.push_back( ( <span class="keywordtype">string</span> ) *it );</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>( l.size() % 2 != 0 )</div>
<div class="line">  {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Error: the image list contains odd (non-even) number of elements\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv )</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_struct" href="../../d3/d4d/structcv_1_1structured__light_1_1GrayCodePattern_1_1Params.html">structured_light::GrayCodePattern::Params</a> <a class="code hl_function" href="../../d1/dae/namespacecv_1_1gapi_1_1ie.html#a3ab1729bcaf2d08e30dd2bc645410908">params</a>;</div>
<div class="line">  <a class="code hl_class" href="../../d0/d2e/classcv_1_1CommandLineParser.html">CommandLineParser</a> parser( argc, argv, keys );</div>
<div class="line">  <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a> images_file = parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;( 0 );</div>
<div class="line">  <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a> calib_file = parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;( 1 );</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="../../d1/dae/namespacecv_1_1gapi_1_1ie.html#a3ab1729bcaf2d08e30dd2bc645410908">params</a>.width = parser.get&lt;<span class="keywordtype">int</span>&gt;( 2 );</div>
<div class="line">  <a class="code hl_function" href="../../d1/dae/namespacecv_1_1gapi_1_1ie.html#a3ab1729bcaf2d08e30dd2bc645410908">params</a>.height = parser.get&lt;<span class="keywordtype">int</span>&gt;( 3 );</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>( images_file.empty() || calib_file.empty() || <a class="code hl_function" href="../../d1/dae/namespacecv_1_1gapi_1_1ie.html#a3ab1729bcaf2d08e30dd2bc645410908">params</a>.width &lt; 1 || <a class="code hl_function" href="../../d1/dae/namespacecv_1_1gapi_1_1ie.html#a3ab1729bcaf2d08e30dd2bc645410908">params</a>.height &lt; 1 || argc &lt; 5 || argc &gt; 7 )</div>
<div class="line">  {</div>
<div class="line">    help();</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Set up GraycodePattern with params</span></div>
<div class="line">  <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga6395ca871a678020c4a31fadf7e8cc63">Ptr&lt;structured_light::GrayCodePattern&gt;</a> graycode = structured_light::GrayCodePattern::create( params );</div>
<div class="line">  <span class="keywordtype">size_t</span> white_thresh = 0;</div>
<div class="line">  <span class="keywordtype">size_t</span> black_thresh = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>( argc == 7 )</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// If passed, setting the white and black threshold, otherwise using default values</span></div>
<div class="line">    white_thresh = parser.get&lt;<span class="keywordtype">unsigned</span>&gt;( 4 );</div>
<div class="line">    black_thresh = parser.get&lt;<span class="keywordtype">unsigned</span>&gt;( 5 );</div>
<div class="line"> </div>
<div class="line">    graycode-&gt;setWhiteThreshold( white_thresh );</div>
<div class="line">    graycode-&gt;setBlackThreshold( black_thresh );</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  vector&lt;string&gt; imagelist;</div>
<div class="line">  <span class="keywordtype">bool</span> ok = readStringList( images_file, imagelist );</div>
<div class="line">  <span class="keywordflow">if</span>( !ok || imagelist.empty() )</div>
<div class="line">  {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;can not open &quot;</span> &lt;&lt; images_file &lt;&lt; <span class="stringliteral">&quot; or the string list is empty&quot;</span> &lt;&lt; endl;</div>
<div class="line">    help();</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="../../da/d56/classcv_1_1FileStorage.html">FileStorage</a> fs( calib_file, FileStorage::READ );</div>
<div class="line">  <span class="keywordflow">if</span>( !fs.isOpened() )</div>
<div class="line">  {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Failed to open Calibration Data File.&quot;</span> &lt;&lt; endl;</div>
<div class="line">    help();</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Loading calibration parameters</span></div>
<div class="line">  <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> cam1intrinsics, cam1distCoeffs, cam2intrinsics, cam2distCoeffs, R, T;</div>
<div class="line">  fs[<span class="stringliteral">&quot;cam1_intrinsics&quot;</span>] &gt;&gt; cam1intrinsics;</div>
<div class="line">  fs[<span class="stringliteral">&quot;cam2_intrinsics&quot;</span>] &gt;&gt; cam2intrinsics;</div>
<div class="line">  fs[<span class="stringliteral">&quot;cam1_distorsion&quot;</span>] &gt;&gt; cam1distCoeffs;</div>
<div class="line">  fs[<span class="stringliteral">&quot;cam2_distorsion&quot;</span>] &gt;&gt; cam2distCoeffs;</div>
<div class="line">  fs[<span class="stringliteral">&quot;R&quot;</span>] &gt;&gt; R;</div>
<div class="line">  fs[<span class="stringliteral">&quot;T&quot;</span>] &gt;&gt; T;</div>
<div class="line"> </div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;cam1intrinsics&quot;</span> &lt;&lt; endl &lt;&lt; cam1intrinsics &lt;&lt; endl;</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;cam1distCoeffs&quot;</span> &lt;&lt; endl &lt;&lt; cam1distCoeffs &lt;&lt; endl;</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;cam2intrinsics&quot;</span> &lt;&lt; endl &lt;&lt; cam2intrinsics &lt;&lt; endl;</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;cam2distCoeffs&quot;</span> &lt;&lt; endl &lt;&lt; cam2distCoeffs &lt;&lt; endl;</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;T&quot;</span> &lt;&lt; endl &lt;&lt; T &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;R&quot;</span> &lt;&lt; endl &lt;&lt; R &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>( (!R.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a4d33bed1c850265370d2af0ff02e1564">data</a>) || (!T.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a4d33bed1c850265370d2af0ff02e1564">data</a>) || (!cam1intrinsics.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a4d33bed1c850265370d2af0ff02e1564">data</a>) || (!cam2intrinsics.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a4d33bed1c850265370d2af0ff02e1564">data</a>) || (!cam1distCoeffs.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a4d33bed1c850265370d2af0ff02e1564">data</a>) || (!cam2distCoeffs.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a4d33bed1c850265370d2af0ff02e1564">data</a>) )</div>
<div class="line">  {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Failed to load cameras calibration parameters&quot;</span> &lt;&lt; endl;</div>
<div class="line">    help();</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">size_t</span> numberOfPatternImages = graycode-&gt;getNumberOfPatternImages();</div>
<div class="line">  vector&lt;vector&lt;Mat&gt; &gt; captured_pattern;</div>
<div class="line">  captured_pattern.resize( 2 );</div>
<div class="line">  captured_pattern[0].resize( numberOfPatternImages );</div>
<div class="line">  captured_pattern[1].resize( numberOfPatternImages );</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> color = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">imread</a>( imagelist[numberOfPatternImages], IMREAD_COLOR );</div>
<div class="line">  <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a> imagesSize = color.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Stereo rectify</span></div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;Rectifying images...&quot;</span> &lt;&lt; endl;</div>
<div class="line">  <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> R1, R2, P1, P2, Q;</div>
<div class="line">  <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a> validRoi[2];</div>
<div class="line">  <a class="code hl_function" href="../../d9/d0c/group__calib3d.html#ga617b1685d4059c6040827800e72ad2b6">stereoRectify</a>( cam1intrinsics, cam1distCoeffs, cam2intrinsics, cam2distCoeffs, imagesSize, R, T, R1, R2, P1, P2, Q, 0,</div>
<div class="line">                -1, imagesSize, &amp;validRoi[0], &amp;validRoi[1] );</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> map1x, map1y, map2x, map2y;</div>
<div class="line">  <a class="code hl_function" href="../../d9/d0c/group__calib3d.html#ga7dfb72c9cf9780a347fbe3d1c47e5d5a">initUndistortRectifyMap</a>( cam1intrinsics, cam1distCoeffs, R1, P1, imagesSize, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a>, map1x, map1y );</div>
<div class="line">  <a class="code hl_function" href="../../d9/d0c/group__calib3d.html#ga7dfb72c9cf9780a347fbe3d1c47e5d5a">initUndistortRectifyMap</a>( cam2intrinsics, cam2distCoeffs, R2, P2, imagesSize, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a>, map2x, map2y );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Loading pattern images</span></div>
<div class="line">  <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; numberOfPatternImages; i++ )</div>
<div class="line">  {</div>
<div class="line">    captured_pattern[0][i] = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">imread</a>( imagelist[i], IMREAD_GRAYSCALE );</div>
<div class="line">    captured_pattern[1][i] = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">imread</a>( imagelist[i + numberOfPatternImages + 2], IMREAD_GRAYSCALE );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( (!captured_pattern[0][i].data) || (!captured_pattern[1][i].data) )</div>
<div class="line">    {</div>
<div class="line">      cout &lt;&lt; <span class="stringliteral">&quot;Empty images&quot;</span> &lt;&lt; endl;</div>
<div class="line">      help();</div>
<div class="line">      <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#gab75ef31ce5cdfb5c44b6da5f3b908ea4">remap</a>( captured_pattern[1][i], captured_pattern[1][i], map1x, map1y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line">    <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#gab75ef31ce5cdfb5c44b6da5f3b908ea4">remap</a>( captured_pattern[0][i], captured_pattern[0][i], map2x, map2y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;done&quot;</span> &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">  vector&lt;Mat&gt; blackImages;</div>
<div class="line">  vector&lt;Mat&gt; whiteImages;</div>
<div class="line"> </div>
<div class="line">  blackImages.resize( 2 );</div>
<div class="line">  whiteImages.resize( 2 );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Loading images (all white + all black) needed for shadows computation</span></div>
<div class="line">  <a class="code hl_function" href="../../d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>( color, whiteImages[0], COLOR_RGB2GRAY );</div>
<div class="line"> </div>
<div class="line">  whiteImages[1] = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">imread</a>( imagelist[2 * numberOfPatternImages + 2], IMREAD_GRAYSCALE );</div>
<div class="line">  blackImages[0] = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">imread</a>( imagelist[numberOfPatternImages + 1], IMREAD_GRAYSCALE );</div>
<div class="line">  blackImages[1] = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">imread</a>( imagelist[2 * numberOfPatternImages + 2 + 1], IMREAD_GRAYSCALE );</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#gab75ef31ce5cdfb5c44b6da5f3b908ea4">remap</a>( color, color, map2x, map2y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#gab75ef31ce5cdfb5c44b6da5f3b908ea4">remap</a>( whiteImages[0], whiteImages[0], map2x, map2y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line">  <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#gab75ef31ce5cdfb5c44b6da5f3b908ea4">remap</a>( whiteImages[1], whiteImages[1], map1x, map1y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#gab75ef31ce5cdfb5c44b6da5f3b908ea4">remap</a>( blackImages[0], blackImages[0], map2x, map2y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line">  <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#gab75ef31ce5cdfb5c44b6da5f3b908ea4">remap</a>( blackImages[1], blackImages[1], map1x, map1y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line"> </div>
<div class="line">  cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;Decoding pattern ...&quot;</span> &lt;&lt; endl;</div>
<div class="line">  <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> disparityMap;</div>
<div class="line">  <span class="keywordtype">bool</span> decoded = graycode-&gt;decode( captured_pattern, disparityMap, blackImages, whiteImages,</div>
<div class="line">                                  structured_light::DECODE_3D_UNDERWORLD );</div>
<div class="line">  <span class="keywordflow">if</span>( decoded )</div>
<div class="line">  {</div>
<div class="line">    cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;pattern decoded&quot;</span> &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// To better visualize the result, apply a colormap to the computed disparity</span></div>
<div class="line">    <span class="keywordtype">double</span> <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga9af368f182ee76d0463d0d8d5330b764">min</a>;</div>
<div class="line">    <span class="keywordtype">double</span> <a class="code hl_function" href="../../d2/de8/group__core__array.html#gacc40fa15eac0fb83f8ca70b7cc0b588d">max</a>;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga7622c466c628a75d9ed008b42250a73f">minMaxIdx</a>(disparityMap, &amp;min, &amp;max);</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> cm_disp, scaledDisparityMap;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;disp min &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga9af368f182ee76d0463d0d8d5330b764">min</a> &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;disp max &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d2/de8/group__core__array.html#gacc40fa15eac0fb83f8ca70b7cc0b588d">max</a> &lt;&lt; endl;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga3460e9c9f37b563ab9dd550c4d8c4e7d">convertScaleAbs</a>( disparityMap, scaledDisparityMap, 255 / ( max - min ) );</div>
<div class="line">    <a class="code hl_function" href="../../d3/d50/group__imgproc__colormap.html#gadf478a5e5ff49d8aa24e726ea6f65d15">applyColorMap</a>( scaledDisparityMap, cm_disp, COLORMAP_JET );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Show the result</span></div>
<div class="line">    <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#ga47a974309e9102f5f08231edc7e7529d">resize</a>( cm_disp, cm_disp, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a>( 640, 480 ), 0, 0, INTER_LINEAR_EXACT );</div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( <span class="stringliteral">&quot;cm disparity m&quot;</span>, cm_disp );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Compute the point cloud</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> pointcloud;</div>
<div class="line">    disparityMap.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>( disparityMap, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a> );</div>
<div class="line">    <a class="code hl_function" href="../../d9/d0c/group__calib3d.html#ga1bc1152bd57d63bc524204f21fde6e02">reprojectImageTo3D</a>( disparityMap, pointcloud, Q, <span class="keyword">true</span>, -1 );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Compute a mask to remove background</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> dst, thresholded_disp;</div>
<div class="line">    <a class="code hl_function" href="../../d7/d1b/group__imgproc__misc.html#gae8a4a146d1ca78c626a53577199e9c57">threshold</a>( scaledDisparityMap, thresholded_disp, 0, 255, THRESH_OTSU + THRESH_BINARY );</div>
<div class="line">    <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#ga47a974309e9102f5f08231edc7e7529d">resize</a>( thresholded_disp, dst, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a>( 640, 480 ), 0, 0, INTER_LINEAR_EXACT );</div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( <span class="stringliteral">&quot;threshold disp otsu&quot;</span>, dst );</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef HAVE_OPENCV_VIZ</span></div>
<div class="line">    <span class="comment">// Apply the mask to the point cloud</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> pointcloud_tresh, color_tresh;</div>
<div class="line">    pointcloud.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>( pointcloud_tresh, thresholded_disp );</div>
<div class="line">    color.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>( color_tresh, thresholded_disp );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Show the point cloud on viz</span></div>
<div class="line">    <a class="code hl_class" href="../../d6/d32/classcv_1_1viz_1_1Viz3d.html">viz::Viz3d</a> myWindow( <span class="stringliteral">&quot;Point cloud with color&quot;</span> );</div>
<div class="line">    myWindow.setBackgroundMeshLab();</div>
<div class="line">    myWindow.showWidget( <span class="stringliteral">&quot;coosys&quot;</span>, <a class="code hl_class" href="../../df/d63/classcv_1_1viz_1_1WCoordinateSystem.html">viz::WCoordinateSystem</a>() );</div>
<div class="line">    myWindow.showWidget( <span class="stringliteral">&quot;pointcloud&quot;</span>, <a class="code hl_class" href="../../db/d82/classcv_1_1viz_1_1WCloud.html">viz::WCloud</a>( pointcloud_tresh, color_tresh ) );</div>
<div class="line">    myWindow.showWidget( <span class="stringliteral">&quot;text2d&quot;</span>, <a class="code hl_class" href="../../de/d0b/classcv_1_1viz_1_1WText.html">viz::WText</a>( <span class="stringliteral">&quot;Point cloud&quot;</span>, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>(20, 20), 20, viz::Color::green() ) );</div>
<div class="line">    myWindow.spin();</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// HAVE_OPENCV_VIZ</span></div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="acalib3d_8hpp_html"><div class="ttname"><a href="../../d2/d28/calib3d_8hpp.html">calib3d.hpp</a></div></div>
<div class="ttc" id="aclasscv_1_1CommandLineParser_html"><div class="ttname"><a href="../../d0/d2e/classcv_1_1CommandLineParser.html">cv::CommandLineParser</a></div><div class="ttdoc">Designed for command line parsing.</div><div class="ttdef"><b>Definition</b> utility.hpp:820</div></div>
<div class="ttc" id="aclasscv_1_1FileNodeIterator_html"><div class="ttname"><a href="../../d7/d4e/classcv_1_1FileNodeIterator.html">cv::FileNodeIterator</a></div><div class="ttdoc">used to iterate through sequences and mappings.</div><div class="ttdef"><b>Definition</b> persistence.hpp:634</div></div>
<div class="ttc" id="aclasscv_1_1FileNode_html"><div class="ttname"><a href="../../de/dd9/classcv_1_1FileNode.html">cv::FileNode</a></div><div class="ttdoc">File Storage Node class.</div><div class="ttdef"><b>Definition</b> persistence.hpp:482</div></div>
<div class="ttc" id="aclasscv_1_1FileNode_html_a0f299820227506079f5b9013dd8c3558"><div class="ttname"><a href="../../de/dd9/classcv_1_1FileNode.html#a0f299820227506079f5b9013dd8c3558">cv::FileNode::begin</a></div><div class="ttdeci">FileNodeIterator begin() const</div><div class="ttdoc">returns iterator pointing to the first node element</div></div>
<div class="ttc" id="aclasscv_1_1FileNode_html_a58b033e34726eb73f0238a1bfbe0c8e9"><div class="ttname"><a href="../../de/dd9/classcv_1_1FileNode.html#a58b033e34726eb73f0238a1bfbe0c8e9">cv::FileNode::end</a></div><div class="ttdeci">FileNodeIterator end() const</div><div class="ttdoc">returns iterator pointing to the element following the last node element</div></div>
<div class="ttc" id="aclasscv_1_1FileNode_html_ad0fd448e25719a94320ebe574b87f997"><div class="ttname"><a href="../../de/dd9/classcv_1_1FileNode.html#ad0fd448e25719a94320ebe574b87f997">cv::FileNode::type</a></div><div class="ttdeci">int type() const</div><div class="ttdoc">Returns type of the node.</div></div>
<div class="ttc" id="aclasscv_1_1FileStorage_html"><div class="ttname"><a href="../../da/d56/classcv_1_1FileStorage.html">cv::FileStorage</a></div><div class="ttdoc">XML/YAML/JSON file storage class that encapsulates all the information necessary for writing or readi...</div><div class="ttdef"><b>Definition</b> persistence.hpp:304</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a></div><div class="ttdoc">n-dimensional dense array class</div><div class="ttdef"><b>Definition</b> mat.hpp:812</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a146f8e8dda07d1365a575ab83d9828d1"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">cv::Mat::size</a></div><div class="ttdeci">MatSize size</div><div class="ttdef"><b>Definition</b> mat.hpp:2160</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a33fd5d125b4c302b0c9aa86980791a77"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">cv::Mat::copyTo</a></div><div class="ttdeci">void copyTo(OutputArray m) const</div><div class="ttdoc">Copies the matrix to another one.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a4d33bed1c850265370d2af0ff02e1564"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a4d33bed1c850265370d2af0ff02e1564">cv::Mat::data</a></div><div class="ttdeci">uchar * data</div><div class="ttdoc">pointer to the data</div><div class="ttdef"><b>Definition</b> mat.hpp:2140</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_adf88c60c5b4980e05bb556080916978b"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">cv::Mat::convertTo</a></div><div class="ttdeci">void convertTo(OutputArray m, int rtype, double alpha=1, double beta=0) const</div><div class="ttdoc">Converts an array to another data type with optional scaling.</div></div>
<div class="ttc" id="aclasscv_1_1Point___html"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html">cv::Point_&lt; int &gt;</a></div></div>
<div class="ttc" id="aclasscv_1_1Rect___html"><div class="ttname"><a href="../../d2/d44/classcv_1_1Rect__.html">cv::Rect_</a></div><div class="ttdoc">Template class for 2D rectangles.</div><div class="ttdef"><b>Definition</b> types.hpp:444</div></div>
<div class="ttc" id="aclasscv_1_1Scalar___html"><div class="ttname"><a href="../../d1/da0/classcv_1_1Scalar__.html">cv::Scalar_&lt; double &gt;</a></div></div>
<div class="ttc" id="aclasscv_1_1Size___html"><div class="ttname"><a href="../../d6/d50/classcv_1_1Size__.html">cv::Size_</a></div><div class="ttdoc">Template class for specifying the size of an image or rectangle.</div><div class="ttdef"><b>Definition</b> types.hpp:335</div></div>
<div class="ttc" id="aclasscv_1_1viz_1_1Viz3d_html"><div class="ttname"><a href="../../d6/d32/classcv_1_1viz_1_1Viz3d.html">cv::viz::Viz3d</a></div><div class="ttdoc">The Viz3d class represents a 3D visualizer window. This class is implicitly shared.</div><div class="ttdef"><b>Definition</b> viz3d.hpp:68</div></div>
<div class="ttc" id="aclasscv_1_1viz_1_1WCloud_html"><div class="ttname"><a href="../../db/d82/classcv_1_1viz_1_1WCloud.html">cv::viz::WCloud</a></div><div class="ttdoc">Clouds.</div><div class="ttdef"><b>Definition</b> widgets.hpp:681</div></div>
<div class="ttc" id="aclasscv_1_1viz_1_1WCoordinateSystem_html"><div class="ttname"><a href="../../df/d63/classcv_1_1viz_1_1WCoordinateSystem.html">cv::viz::WCoordinateSystem</a></div><div class="ttdoc">Compound widgets.</div><div class="ttdef"><b>Definition</b> widgets.hpp:514</div></div>
<div class="ttc" id="aclasscv_1_1viz_1_1WText_html"><div class="ttname"><a href="../../de/d0b/classcv_1_1viz_1_1WText.html">cv::viz::WText</a></div><div class="ttdoc">Text and image widgets.</div><div class="ttdef"><b>Definition</b> widgets.hpp:408</div></div>
<div class="ttc" id="acore_2include_2opencv2_2core_8hpp_html"><div class="ttname"><a href="../../d0/d9c/core_2include_2opencv2_2core_8hpp.html">core.hpp</a></div></div>
<div class="ttc" id="agroup__calib3d_html_ga1bc1152bd57d63bc524204f21fde6e02"><div class="ttname"><a href="../../d9/d0c/group__calib3d.html#ga1bc1152bd57d63bc524204f21fde6e02">cv::reprojectImageTo3D</a></div><div class="ttdeci">void reprojectImageTo3D(InputArray disparity, OutputArray _3dImage, InputArray Q, bool handleMissingValues=false, int ddepth=-1)</div><div class="ttdoc">Reprojects a disparity image to 3D space.</div></div>
<div class="ttc" id="agroup__calib3d_html_ga617b1685d4059c6040827800e72ad2b6"><div class="ttname"><a href="../../d9/d0c/group__calib3d.html#ga617b1685d4059c6040827800e72ad2b6">cv::stereoRectify</a></div><div class="ttdeci">void stereoRectify(InputArray cameraMatrix1, InputArray distCoeffs1, InputArray cameraMatrix2, InputArray distCoeffs2, Size imageSize, InputArray R, InputArray T, OutputArray R1, OutputArray R2, OutputArray P1, OutputArray P2, OutputArray Q, int flags=CALIB_ZERO_DISPARITY, double alpha=-1, Size newImageSize=Size(), Rect *validPixROI1=0, Rect *validPixROI2=0)</div><div class="ttdoc">Computes rectification transforms for each head of a calibrated stereo camera.</div></div>
<div class="ttc" id="agroup__calib3d_html_ga7dfb72c9cf9780a347fbe3d1c47e5d5a"><div class="ttname"><a href="../../d9/d0c/group__calib3d.html#ga7dfb72c9cf9780a347fbe3d1c47e5d5a">cv::initUndistortRectifyMap</a></div><div class="ttdeci">void initUndistortRectifyMap(InputArray cameraMatrix, InputArray distCoeffs, InputArray R, InputArray newCameraMatrix, Size size, int m1type, OutputArray map1, OutputArray map2)</div><div class="ttdoc">Computes the undistortion and rectification transformation map.</div></div>
<div class="ttc" id="agroup__core__array_html_ga3460e9c9f37b563ab9dd550c4d8c4e7d"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga3460e9c9f37b563ab9dd550c4d8c4e7d">cv::convertScaleAbs</a></div><div class="ttdeci">void convertScaleAbs(InputArray src, OutputArray dst, double alpha=1, double beta=0)</div><div class="ttdoc">Scales, calculates absolute values, and converts the result to 8-bit.</div></div>
<div class="ttc" id="agroup__core__array_html_ga7622c466c628a75d9ed008b42250a73f"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga7622c466c628a75d9ed008b42250a73f">cv::minMaxIdx</a></div><div class="ttdeci">void minMaxIdx(InputArray src, double *minVal, double *maxVal=0, int *minIdx=0, int *maxIdx=0, InputArray mask=noArray())</div><div class="ttdoc">Finds the global minimum and maximum in an array.</div></div>
<div class="ttc" id="agroup__core__array_html_ga9af368f182ee76d0463d0d8d5330b764"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga9af368f182ee76d0463d0d8d5330b764">cv::min</a></div><div class="ttdeci">void min(InputArray src1, InputArray src2, OutputArray dst)</div><div class="ttdoc">Calculates per-element minimum of two arrays or an array and a scalar.</div></div>
<div class="ttc" id="agroup__core__array_html_gacc40fa15eac0fb83f8ca70b7cc0b588d"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gacc40fa15eac0fb83f8ca70b7cc0b588d">cv::max</a></div><div class="ttdeci">void max(InputArray src1, InputArray src2, OutputArray dst)</div><div class="ttdoc">Calculates per-element maximum of two arrays or an array and a scalar.</div></div>
<div class="ttc" id="agroup__core__basic_html_ga1f6634802eeadfd7245bc75cf3e216c2"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">cv::String</a></div><div class="ttdeci">std::string String</div><div class="ttdef"><b>Definition</b> cvstd.hpp:151</div></div>
<div class="ttc" id="agroup__core__basic_html_ga6395ca871a678020c4a31fadf7e8cc63"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga6395ca871a678020c4a31fadf7e8cc63">cv::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; _Tp &gt; Ptr</div><div class="ttdef"><b>Definition</b> cvstd_wrapper.hpp:23</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga32ec76240e43e4c9c7b2e2785180a7e6"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a></div><div class="ttdeci">#define CV_32FC1</div><div class="ttdef"><b>Definition</b> interface.h:118</div></div>
<div class="ttc" id="agroup__highgui_html_ga453d42fe4cb60e5723281a89973ee563"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv::imshow</a></div><div class="ttdeci">void imshow(const String &amp;winname, InputArray mat)</div><div class="ttdoc">Displays an image in the specified window.</div></div>
<div class="ttc" id="agroup__highgui_html_ga5628525ad33f52eab17feebcfba38bd7"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv::waitKey</a></div><div class="ttdeci">int waitKey(int delay=0)</div><div class="ttdoc">Waits for a pressed key.</div></div>
<div class="ttc" id="agroup__imgcodecs_html_gab32ee19e22660912565f8140d0f675a8"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv::imread</a></div><div class="ttdeci">CV_EXPORTS_W Mat imread(const String &amp;filename, int flags=IMREAD_COLOR)</div><div class="ttdoc">Loads an image from a file.</div></div>
<div class="ttc" id="agroup__imgproc__color__conversions_html_ga397ae87e1288a81d2363b61574eb8cab"><div class="ttname"><a href="../../d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cv::cvtColor</a></div><div class="ttdeci">void cvtColor(InputArray src, OutputArray dst, int code, int dstCn=0)</div><div class="ttdoc">Converts an image from one color space to another.</div></div>
<div class="ttc" id="agroup__imgproc__colormap_html_gadf478a5e5ff49d8aa24e726ea6f65d15"><div class="ttname"><a href="../../d3/d50/group__imgproc__colormap.html#gadf478a5e5ff49d8aa24e726ea6f65d15">cv::applyColorMap</a></div><div class="ttdeci">void applyColorMap(InputArray src, OutputArray dst, int colormap)</div><div class="ttdoc">Applies a GNU Octave/MATLAB equivalent colormap on a given image.</div></div>
<div class="ttc" id="agroup__imgproc__misc_html_gae8a4a146d1ca78c626a53577199e9c57"><div class="ttname"><a href="../../d7/d1b/group__imgproc__misc.html#gae8a4a146d1ca78c626a53577199e9c57">cv::threshold</a></div><div class="ttdeci">double threshold(InputArray src, OutputArray dst, double thresh, double maxval, int type)</div><div class="ttdoc">Applies a fixed-level threshold to each array element.</div></div>
<div class="ttc" id="agroup__imgproc__transform_html_ga47a974309e9102f5f08231edc7e7529d"><div class="ttname"><a href="../../da/d54/group__imgproc__transform.html#ga47a974309e9102f5f08231edc7e7529d">cv::resize</a></div><div class="ttdeci">void resize(InputArray src, OutputArray dst, Size dsize, double fx=0, double fy=0, int interpolation=INTER_LINEAR)</div><div class="ttdoc">Resizes an image.</div></div>
<div class="ttc" id="agroup__imgproc__transform_html_gab75ef31ce5cdfb5c44b6da5f3b908ea4"><div class="ttname"><a href="../../da/d54/group__imgproc__transform.html#gab75ef31ce5cdfb5c44b6da5f3b908ea4">cv::remap</a></div><div class="ttdeci">void remap(InputArray src, OutputArray dst, InputArray map1, InputArray map2, int interpolation, int borderMode=BORDER_CONSTANT, const Scalar &amp;borderValue=Scalar())</div><div class="ttdoc">Applies a generic geometrical transformation to an image.</div></div>
<div class="ttc" id="ahighgui_8hpp_html"><div class="ttname"><a href="../../d4/dd5/highgui_8hpp.html">highgui.hpp</a></div></div>
<div class="ttc" id="ahighgui__qt_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition</b> highgui_qt.cpp:3</div></div>
<div class="ttc" id="aimgproc_2include_2opencv2_2imgproc_8hpp_html"><div class="ttname"><a href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="anamespacecv_1_1gapi_1_1ie_html_a3ab1729bcaf2d08e30dd2bc645410908"><div class="ttname"><a href="../../d1/dae/namespacecv_1_1gapi_1_1ie.html#a3ab1729bcaf2d08e30dd2bc645410908">cv::gapi::ie::params</a></div><div class="ttdeci">PyParams params(const std::string &amp;tag, const std::string &amp;model, const std::string &amp;weights, const std::string &amp;device)</div></div>
<div class="ttc" id="anamespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdoc">&quot;black box&quot; representation of the file storage associated with a file on disk.</div><div class="ttdef"><b>Definition</b> core.hpp:102</div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace.</div></div>
<div class="ttc" id="astructcv_1_1structured__light_1_1GrayCodePattern_1_1Params_html"><div class="ttname"><a href="../../d3/d4d/structcv_1_1structured__light_1_1GrayCodePattern_1_1Params.html">cv::structured_light::GrayCodePattern::Params</a></div><div class="ttdoc">Parameters of StructuredLightPattern constructor.</div><div class="ttdef"><b>Definition</b> graycodepattern.hpp:77</div></div>
<div class="ttc" id="astructured__light_8hpp_html"><div class="ttname"><a href="../../d3/d23/structured__light_8hpp.html">structured_light.hpp</a></div></div>
<div class="ttc" id="aviz_8hpp_html"><div class="ttname"><a href="../../d0/d7e/viz_8hpp.html">viz.hpp</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2013"></a>
Explanation</h1>
<p>First of all the needed parameters must be passed to the program. The first is the name list of previously acquired pattern images, stored in a .yaml file organized as below:</p>
<div class="fragment"><div class="line">%YAML:1.0</div>
<div class="line">cam1:</div>
<div class="line">   - <span class="stringliteral">&quot;/data/pattern_cam1_im1.png&quot;</span></div>
<div class="line">   - <span class="stringliteral">&quot;/data/pattern_cam1_im2.png&quot;</span></div>
<div class="line">           ..............</div>
<div class="line">   - <span class="stringliteral">&quot;/data/pattern_cam1_im42.png&quot;</span></div>
<div class="line">   - <span class="stringliteral">&quot;/data/pattern_cam1_im43.png&quot;</span></div>
<div class="line">   - <span class="stringliteral">&quot;/data/pattern_cam1_im44.png&quot;</span></div>
<div class="line">cam2:</div>
<div class="line">   - <span class="stringliteral">&quot;/data/pattern_cam2_im1.png&quot;</span></div>
<div class="line">   - <span class="stringliteral">&quot;/data/pattern_cam2_im2.png&quot;</span></div>
<div class="line">           ..............</div>
<div class="line">   - <span class="stringliteral">&quot;/data/pattern_cam2_im42.png&quot;</span></div>
<div class="line">   - <span class="stringliteral">&quot;/data/pattern_cam2_im43.png&quot;</span></div>
<div class="line">   - <span class="stringliteral">&quot;/data/pattern_cam2_im44.png&quot;</span></div>
</div><!-- fragment --><p>For example, the dataset used for this tutorial has been acquired using a projector with a resolution of 1280x800, so 42 pattern images (from number 1 to 42) + 1 white (number 43) and 1 black (number 44) were captured with both the two cameras.</p>
<p>Then the cameras calibration parameters, stored in another .yml file, together with the width and the height of the projector used to project the pattern, and, optionally, the values of white and black tresholds, must be passed to the tutorial program.</p>
<p>In this way, <em>GrayCodePattern</em> class parameters can be set up with the width and the height of the projector used during the pattern acquisition and a pointer to a GrayCodePattern object can be created:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="../../d3/d4d/structcv_1_1structured__light_1_1GrayCodePattern_1_1Params.html">structured_light::GrayCodePattern::Params</a> params;</div>
<div class="line">   ....</div>
<div class="line">params.width = parser.get&lt;<span class="keywordtype">int</span>&gt;( 2 );</div>
<div class="line">params.height = parser.get&lt;<span class="keywordtype">int</span>&gt;( 3 );</div>
<div class="line">   ....</div>
<div class="line"><span class="comment">// Set up GraycodePattern with params</span></div>
<div class="line"><a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga6395ca871a678020c4a31fadf7e8cc63">Ptr&lt;structured_light::GrayCodePattern&gt;</a> graycode = structured_light::GrayCodePattern::create( params );</div>
</div><!-- fragment --><p>If the white and black thresholds are passed as parameters (these thresholds influence the number of decoded pixels), their values can be set, otherwise the algorithm will use the default values.</p>
<div class="fragment"><div class="line"><span class="keywordtype">size_t</span> white_thresh = 0;</div>
<div class="line"><span class="keywordtype">size_t</span> black_thresh = 0;</div>
<div class="line"><span class="keywordflow">if</span>( argc == 7 )</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// If passed, setting the white and black threshold, otherwise using default values</span></div>
<div class="line">  white_thresh = parser.get&lt;<span class="keywordtype">size_t</span>&gt;( 4 );</div>
<div class="line">  black_thresh = parser.get&lt;<span class="keywordtype">size_t</span>&gt;( 5 );</div>
<div class="line">  graycode-&gt;setWhiteThreshold( white_thresh );</div>
<div class="line">  graycode-&gt;setBlackThreshold( black_thresh );</div>
<div class="line">}</div>
</div><!-- fragment --><p>At this point, to use the <em>decode</em> method of <em>GrayCodePattern</em> class, the acquired pattern images must be stored in a vector of vector of Mat. The external vector has a size of two because two are the cameras: the first vector stores the pattern images captured from the left camera, the second those acquired from the right one. The number of pattern images is obviously the same for both cameras and can be retrieved using the getNumberOfPatternImages() method:</p>
<div class="fragment"><div class="line"><span class="keywordtype">size_t</span> numberOfPatternImages = graycode-&gt;getNumberOfPatternImages();</div>
<div class="line">vector&lt;vector&lt;Mat&gt; &gt; captured_pattern;</div>
<div class="line">captured_pattern.resize( 2 );</div>
<div class="line">captured_pattern[0].resize( numberOfPatternImages );</div>
<div class="line">captured_pattern[1].resize( numberOfPatternImages );</div>
<div class="line"> </div>
<div class="line">.....</div>
<div class="line"> </div>
<div class="line">for( <span class="keywordtype">size_t</span> i = 0; i &lt; numberOfPatternImages; i++ )</div>
<div class="line">{</div>
<div class="line">  captured_pattern[0][i] = imread( imagelist[i], IMREAD_GRAYSCALE );</div>
<div class="line">  captured_pattern[1][i] = imread( imagelist[i + numberOfPatternImages + 2], IMREAD_GRAYSCALE );</div>
<div class="line">   ......</div>
<div class="line">}</div>
</div><!-- fragment --><p>As regards the black and white images, they must be stored in two different vectors of Mat:</p>
<div class="fragment"><div class="line">vector&lt;Mat&gt; blackImages;</div>
<div class="line">vector&lt;Mat&gt; whiteImages;</div>
<div class="line">blackImages.resize( 2 );</div>
<div class="line">whiteImages.resize( 2 );</div>
<div class="line"><span class="comment">// Loading images (all white + all black) needed for shadows computation</span></div>
<div class="line">cvtColor( color, whiteImages[0], COLOR_RGB2GRAY );</div>
<div class="line">whiteImages[1] = imread( imagelist[2 * numberOfPatternImages + 2], IMREAD_GRAYSCALE );</div>
<div class="line">blackImages[0] = imread( imagelist[numberOfPatternImages + 1], IMREAD_GRAYSCALE );</div>
<div class="line">blackImages[1] = imread( imagelist[2 * numberOfPatternImages + 2 + 1], IMREAD_GRAYSCALE );</div>
</div><!-- fragment --><p>It is important to underline that all the images, the pattern ones, black and white, must be loaded as grayscale images and rectified before being passed to decode method:</p>
<div class="fragment"><div class="line"><span class="comment">// Stereo rectify</span></div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Rectifying images...&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> R1, R2, P1, P2, Q;</div>
<div class="line"><a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a> validRoi[2];</div>
<div class="line">stereoRectify( cam1intrinsics, cam1distCoeffs, cam2intrinsics, cam2distCoeffs, imagesSize, R, T, R1, R2, P1, P2, Q, 0,</div>
<div class="line">              -1, imagesSize, &amp;validRoi[0], &amp;validRoi[1] );</div>
<div class="line"><a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> map1x, map1y, map2x, map2y;</div>
<div class="line">initUndistortRectifyMap( cam1intrinsics, cam1distCoeffs, R1, P1, imagesSize, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a>, map1x, map1y );</div>
<div class="line">initUndistortRectifyMap( cam2intrinsics, cam2distCoeffs, R2, P2, imagesSize, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a>, map2x, map2y );</div>
<div class="line">       ........</div>
<div class="line"><span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; numberOfPatternImages; i++ )</div>
<div class="line">{</div>
<div class="line">       ........</div>
<div class="line">  remap( captured_pattern[1][i], captured_pattern[1][i], map1x, map1y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line">  remap( captured_pattern[0][i], captured_pattern[0][i], map2x, map2y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line">}</div>
<div class="line">       ........</div>
<div class="line">remap( color, color, map2x, map2y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line">remap( whiteImages[0], whiteImages[0], map2x, map2y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line">remap( whiteImages[1], whiteImages[1], map1x, map1y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line">remap( blackImages[0], blackImages[0], map2x, map2y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
<div class="line">remap( blackImages[1], blackImages[1], map1x, map1y, INTER_NEAREST, BORDER_CONSTANT, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>() );</div>
</div><!-- fragment --><p>In this way the <em>decode</em> method can be called to decode the pattern and to generate the corresponding disparity map, computed on the first camera (left): </p><div class="fragment"><div class="line"><a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> disparityMap;</div>
<div class="line"><span class="keywordtype">bool</span> decoded = graycode-&gt;decode(captured_pattern, disparityMap, blackImages, whiteImages,</div>
<div class="line">                                structured_light::DECODE_3D_UNDERWORLD);</div>
</div><!-- fragment --><p>To better visualize the result, a colormap is applied to the computed disparity: </p><div class="fragment"><div class="line"><span class="keywordtype">double</span> min;</div>
<div class="line"><span class="keywordtype">double</span> max;</div>
<div class="line">minMaxIdx(disparityMap, &amp;min, &amp;max);</div>
<div class="line"><a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> cm_disp, scaledDisparityMap;</div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;disp min &quot;</span> &lt;&lt; min &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;disp max &quot;</span> &lt;&lt; max &lt;&lt; endl;</div>
<div class="line">convertScaleAbs( disparityMap, scaledDisparityMap, 255 / ( max - min ) );</div>
<div class="line">applyColorMap( scaledDisparityMap, cm_disp, COLORMAP_JET );</div>
<div class="line"><span class="comment">// Show the result</span></div>
<div class="line">resize( cm_disp, cm_disp, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a>( 640, 480 ) );</div>
<div class="line">imshow( <span class="stringliteral">&quot;cm disparity m&quot;</span>, cm_disp )</div>
</div><!-- fragment --><div class="image">
<img src="../../cm_disparity.png" alt=""/>
</div>
    <p>At this point the point cloud can be generated using the reprojectImageTo3D method, taking care to convert the computed disparity in a CV_32FC1 Mat (decode method computes a CV_64FC1 disparity map): </p><div class="fragment"><div class="line"><a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> pointcloud;</div>
<div class="line">disparityMap.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>( disparityMap, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a> );</div>
<div class="line">reprojectImageTo3D( disparityMap, pointcloud, Q, <span class="keyword">true</span>, -1 );</div>
</div><!-- fragment --><p>Then a mask to remove the unwanted background is computed: </p><div class="fragment"><div class="line"><a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> dst, thresholded_disp;</div>
<div class="line">threshold( scaledDisparityMap, thresholded_disp, 0, 255, THRESH_OTSU + THRESH_BINARY );</div>
<div class="line">resize( thresholded_disp, dst, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a>( 640, 480 ) );</div>
<div class="line">imshow( <span class="stringliteral">&quot;threshold disp otsu&quot;</span>, dst );</div>
</div><!-- fragment --><p> <img src="../../threshold_disp.png" alt="" class="inline"/>    </p>
<p>The white image of cam1 was previously loaded also as a color image, in order to map the color of the object on its reconstructed pointcloud: </p><div class="fragment"><div class="line"><a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> color = imread( imagelist[numberOfPatternImages], IMREAD_COLOR );</div>
</div><!-- fragment --><p>The background renoval mask is thus applied to the point cloud and to the color image: </p><div class="fragment"><div class="line"><a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> pointcloud_tresh, color_tresh;</div>
<div class="line">pointcloud.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>(pointcloud_tresh, thresholded_disp);</div>
<div class="line">color.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>(color_tresh, thresholded_disp);</div>
</div><!-- fragment --><p>Finally the computed point cloud of the scanned object can be visualized on viz: </p><div class="fragment"><div class="line"><a class="code hl_class" href="../../d6/d32/classcv_1_1viz_1_1Viz3d.html">viz::Viz3d</a> myWindow( <span class="stringliteral">&quot;Point cloud with color&quot;</span>);</div>
<div class="line">myWindow.setBackgroundMeshLab();</div>
<div class="line">myWindow.showWidget( <span class="stringliteral">&quot;coosys&quot;</span>, <a class="code hl_class" href="../../df/d63/classcv_1_1viz_1_1WCoordinateSystem.html">viz::WCoordinateSystem</a>());</div>
<div class="line">myWindow.showWidget( <span class="stringliteral">&quot;pointcloud&quot;</span>, <a class="code hl_class" href="../../db/d82/classcv_1_1viz_1_1WCloud.html">viz::WCloud</a>( pointcloud_tresh, color_tresh ) );</div>
<div class="line">myWindow.showWidget( <span class="stringliteral">&quot;text2d&quot;</span>, <a class="code hl_class" href="../../de/d0b/classcv_1_1viz_1_1WText.html">viz::WText</a>( <span class="stringliteral">&quot;Point cloud&quot;</span>, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>(20, 20), 20, viz::Color::green() ) );</div>
<div class="line">myWindow.spin();</div>
</div><!-- fragment --><div class="image">
<img src="../../plane_viz.png" alt=""/>
</div>
     </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 2 2024 21:52:14 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.8
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
