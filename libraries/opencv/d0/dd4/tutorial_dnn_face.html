<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>OpenCV: DNN-based Face Detection And Recognition</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.10.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d2/d58/tutorial_table_of_content_dnn.html">Deep Neural Networks (dnn module)</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">DNN-based Face Detection And Recognition</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md354">Introduction</a></li>
<li class="level1"><a href="#autotoc_md355">Models</a></li>
<li class="level1"><a href="#autotoc_md356">Code</a></li>
<li class="level1"><a href="#autotoc_md357">Explanation</a><ul><li class="level2"><a href="#autotoc_md358">Face Recognition</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md359">Reference:</a></li>
<li class="level1"><a href="#autotoc_md360">Acknowledgement</a></li>
</ul>
</div>
<div class="textblock"><p><b>Prev Tutorial:</b> <a class="el" href="../../d4/d43/tutorial_dnn_text_spotting.html">High Level API: TextDetectionModel and TextRecognitionModel</a> <br  />
<b>Next Tutorial:</b> <a class="el" href="../../dc/d70/pytorch_cls_tutorial_dnn_conversion.html">Conversion of PyTorch Classification Models and Launch with OpenCV Python</a> <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight"></th><th class="markdownTableHeadLeft"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">Original Author   </td><td class="markdownTableBodyLeft">Chengrui Wang, Yuantao Feng    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">Compatibility   </td><td class="markdownTableBodyLeft">OpenCV &gt;= 4.5.4   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md354"></a>
Introduction</h1>
<p>In this section, we introduce <a class="el" href="../../df/d20/classcv_1_1FaceDetectorYN.html" title="DNN-based face detector.">cv::FaceDetectorYN</a> class for face detection and <a class="el" href="../../da/d09/classcv_1_1FaceRecognizerSF.html" title="DNN-based face recognizer.">cv::FaceRecognizerSF</a> class for face recognition.</p>
<h1><a class="anchor" id="autotoc_md355"></a>
Models</h1>
<p>There are two models (ONNX format) pre-trained and required for this module:</p><ul>
<li><a href="https://github.com/opencv/opencv_zoo/tree/master/models/face_detection_yunet" target="_blank">Face Detection</a>:<ul>
<li>Size: 338KB</li>
<li>Results on WIDER Face Val set: 0.830(easy), 0.824(medium), 0.708(hard)</li>
</ul>
</li>
<li><a href="https://github.com/opencv/opencv_zoo/tree/master/models/face_recognition_sface" target="_blank">Face Recognition</a><ul>
<li>Size: 36.9MB</li>
<li>Results:</li>
</ul>
</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Database   </th><th class="markdownTableHeadNone">Accuracy   </th><th class="markdownTableHeadNone">Threshold (normL2)   </th><th class="markdownTableHeadNone">Threshold (cosine)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">LFW   </td><td class="markdownTableBodyNone">99.60%   </td><td class="markdownTableBodyNone">1.128   </td><td class="markdownTableBodyNone">0.363    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">CALFW   </td><td class="markdownTableBodyNone">93.95%   </td><td class="markdownTableBodyNone">1.149   </td><td class="markdownTableBodyNone">0.340    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPLFW   </td><td class="markdownTableBodyNone">91.05%   </td><td class="markdownTableBodyNone">1.204   </td><td class="markdownTableBodyNone">0.275    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AgeDB-30   </td><td class="markdownTableBodyNone">94.90%   </td><td class="markdownTableBodyNone">1.202   </td><td class="markdownTableBodyNone">0.277    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CFP-FP   </td><td class="markdownTableBodyNone">94.80%   </td><td class="markdownTableBodyNone">1.253   </td><td class="markdownTableBodyNone">0.212   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md356"></a>
Code</h1>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'><ul>
<li><b>Downloadable code</b>: Click <a href="https://github.com/opencv/opencv/tree/4.x/samples/dnn/face_detect.cpp" target="_blank">here</a></li>
<li><b>Code at glance:</b> <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d9/d8c/dnn_8hpp.html">opencv2/dnn.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">opencv2/imgproc.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d8/da3/objdetect_8hpp.html">opencv2/objdetect.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> visualize(<a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; input, <span class="keywordtype">int</span> frame, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; faces, <span class="keywordtype">double</span> fps, <span class="keywordtype">int</span> thickness = 2)</div>
<div class="line">{</div>
<div class="line">    std::string fpsString = <a class="code hl_function" href="../../db/de0/group__core__utils.html#ga0cccdb2f73859309b0611cf70b1b9409">cv::format</a>(<span class="stringliteral">&quot;FPS : %.2f&quot;</span>, (<span class="keywordtype">float</span>)fps);</div>
<div class="line">    <span class="keywordflow">if</span> (frame &gt;= 0)</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Frame &quot;</span> &lt;&lt; frame &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;FPS: &quot;</span> &lt;&lt; fpsString &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; faces.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Print results</span></div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Face &quot;</span> &lt;&lt; i</div>
<div class="line">             &lt;&lt; <span class="stringliteral">&quot;, top-left coordinates: (&quot;</span> &lt;&lt; faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 0) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 1) &lt;&lt; <span class="stringliteral">&quot;), &quot;</span></div>
<div class="line">             &lt;&lt; <span class="stringliteral">&quot;box width: &quot;</span> &lt;&lt; faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 2)  &lt;&lt; <span class="stringliteral">&quot;, box height: &quot;</span> &lt;&lt; faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 3) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line">             &lt;&lt; <span class="stringliteral">&quot;score: &quot;</span> &lt;&lt; <a class="code hl_function" href="../../db/de0/group__core__utils.html#ga0cccdb2f73859309b0611cf70b1b9409">cv::format</a>(<span class="stringliteral">&quot;%.2f&quot;</span>, faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 14))</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Draw bounding box</span></div>
<div class="line">        rectangle(input, <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect2i</a>(<span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 0)), <span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 1)), <span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 2)), <span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 3))), <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0, 255, 0), thickness);</div>
<div class="line">        <span class="comment">// Draw landmarks</span></div>
<div class="line">        circle(input, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point2i</a>(<span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 4)), <span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 5))), 2, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(255, 0, 0), thickness);</div>
<div class="line">        circle(input, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point2i</a>(<span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 6)), <span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 7))), 2, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0, 0, 255), thickness);</div>
<div class="line">        circle(input, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point2i</a>(<span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 8)), <span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 9))), 2, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0, 255, 0), thickness);</div>
<div class="line">        circle(input, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point2i</a>(<span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 10)), <span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 11))), 2, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(255, 0, 255), thickness);</div>
<div class="line">        circle(input, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point2i</a>(<span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 12)), <span class="keywordtype">int</span>(faces.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">at</a>&lt;<span class="keywordtype">float</span>&gt;(i, 13))), 2, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0, 255, 255), thickness);</div>
<div class="line">    }</div>
<div class="line">    putText(input, fpsString, <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a>(0, 15), FONT_HERSHEY_SIMPLEX, 0.5, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0, 255, 0), 2);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="../../d0/d2e/classcv_1_1CommandLineParser.html">CommandLineParser</a> parser(argc, argv,</div>
<div class="line">        <span class="stringliteral">&quot;{help  h           |            | Print this message}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{image1 i1         |            | Path to the input image1. Omit for detecting through VideoCapture}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{image2 i2         |            | Path to the input image2. When image1 and image2 parameters given then the program try to find a face on both images and runs face recognition algorithm}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{video v           | 0          | Path to the input video}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{scale sc          | 1.0        | Scale factor used to resize input video frames}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{fd_model fd       | face_detection_yunet_2021dec.onnx| Path to the model. Download yunet.onnx in https://github.com/opencv/opencv_zoo/tree/master/models/face_detection_yunet}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{fr_model fr       | face_recognition_sface_2021dec.onnx | Path to the face recognition model. Download the model at https://github.com/opencv/opencv_zoo/tree/master/models/face_recognition_sface}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{score_threshold   | 0.9        | Filter out faces of score &lt; score_threshold}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{nms_threshold     | 0.3        | Suppress bounding boxes of iou &gt;= nms_threshold}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{top_k             | 5000       | Keep top_k bounding boxes before NMS}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{save s            | false      | Set true to save results. This flag is invalid when using camera}&quot;</span></div>
<div class="line">    );</div>
<div class="line">    <span class="keywordflow">if</span> (parser.has(<span class="stringliteral">&quot;help&quot;</span>))</div>
<div class="line">    {</div>
<div class="line">        parser.printMessage();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a> fd_modelPath = parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;fd_model&quot;</span>);</div>
<div class="line">    <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a> fr_modelPath = parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;fr_model&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> scoreThreshold = parser.get&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;score_threshold&quot;</span>);</div>
<div class="line">    <span class="keywordtype">float</span> nmsThreshold = parser.get&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;nms_threshold&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span> topK = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;top_k&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> save = parser.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;save&quot;</span>);</div>
<div class="line">    <span class="keywordtype">float</span> scale = parser.get&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;scale&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> cosine_similar_thresh = 0.363;</div>
<div class="line">    <span class="keywordtype">double</span> l2norm_similar_thresh = 1.128;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize FaceDetectorYN</span></div>
<div class="line">    <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga6395ca871a678020c4a31fadf7e8cc63">Ptr&lt;FaceDetectorYN&gt;</a> detector = FaceDetectorYN::create(fd_modelPath, <span class="stringliteral">&quot;&quot;</span>, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a>(320, 320), scoreThreshold, nmsThreshold, topK);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d9/d6f/classcv_1_1TickMeter.html">TickMeter</a> tm;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// If input is an image</span></div>
<div class="line">    <span class="keywordflow">if</span> (parser.has(<span class="stringliteral">&quot;image1&quot;</span>))</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a> input1 = parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;image1&quot;</span>);</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> image1 = imread(samples::findFile(input1));</div>
<div class="line">        <span class="keywordflow">if</span> (image1.empty())</div>
<div class="line">        {</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;Cannot read image: &quot;</span> &lt;&lt; input1 &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">return</span> 2;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> imageWidth = int(image1.cols * scale);</div>
<div class="line">        <span class="keywordtype">int</span> imageHeight = int(image1.rows * scale);</div>
<div class="line">        <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#ga47a974309e9102f5f08231edc7e7529d">resize</a>(image1, image1, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a>(imageWidth, imageHeight));</div>
<div class="line">        tm.<a class="code hl_function" href="../../d9/d6f/classcv_1_1TickMeter.html#a564bc8b0bebcfc6c96f85fc48643e273">start</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set input size before inference</span></div>
<div class="line">        detector-&gt;setInputSize(image1.size());</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> faces1;</div>
<div class="line">        detector-&gt;detect(image1, faces1);</div>
<div class="line">        <span class="keywordflow">if</span> (faces1.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> &lt; 1)</div>
<div class="line">        {</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;Cannot find a face in &quot;</span> &lt;&lt; input1 &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        tm.<a class="code hl_function" href="../../d9/d6f/classcv_1_1TickMeter.html#aa6dfbdc68373d10e371bd35f92c7adb3">stop</a>();</div>
<div class="line">        <span class="comment">// Draw results on the input image</span></div>
<div class="line">        visualize(image1, -1, faces1, tm.<a class="code hl_function" href="../../d9/d6f/classcv_1_1TickMeter.html#a2fcc88e9c252d1fd2a1404c13b90ae22">getFPS</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Save results if save is true</span></div>
<div class="line">        <span class="keywordflow">if</span> (save)</div>
<div class="line">        {</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;Saving result.jpg...\n&quot;</span>;</div>
<div class="line">            <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#ga8ac397bd09e48851665edbe12aa28f25">imwrite</a>(<span class="stringliteral">&quot;result.jpg&quot;</span>, image1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Visualize results</span></div>
<div class="line">        <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;image1&quot;</span>, image1);</div>
<div class="line">        <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga6d20fbd3100ec3badc1eaa653aff99d7">pollKey</a>();  <span class="comment">// handle UI events to show content</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (parser.has(<span class="stringliteral">&quot;image2&quot;</span>))</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a> input2 = parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;image2&quot;</span>);</div>
<div class="line">            <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> image2 = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">imread</a>(samples::findFile(input2));</div>
<div class="line">            <span class="keywordflow">if</span> (image2.empty())</div>
<div class="line">            {</div>
<div class="line">                std::cerr &lt;&lt; <span class="stringliteral">&quot;Cannot read image2: &quot;</span> &lt;&lt; input2 &lt;&lt; std::endl;</div>
<div class="line">                <span class="keywordflow">return</span> 2;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            tm.<a class="code hl_function" href="../../d9/d6f/classcv_1_1TickMeter.html#ac9a8a593b4bd1c4ea6a1076c735260dd">reset</a>();</div>
<div class="line">            tm.<a class="code hl_function" href="../../d9/d6f/classcv_1_1TickMeter.html#a564bc8b0bebcfc6c96f85fc48643e273">start</a>();</div>
<div class="line">            detector-&gt;setInputSize(image2.size());</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> faces2;</div>
<div class="line">            detector-&gt;detect(image2, faces2);</div>
<div class="line">            <span class="keywordflow">if</span> (faces2.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> &lt; 1)</div>
<div class="line">            {</div>
<div class="line">                std::cerr &lt;&lt; <span class="stringliteral">&quot;Cannot find a face in &quot;</span> &lt;&lt; input2 &lt;&lt; std::endl;</div>
<div class="line">                <span class="keywordflow">return</span> 1;</div>
<div class="line">            }</div>
<div class="line">            tm.<a class="code hl_function" href="../../d9/d6f/classcv_1_1TickMeter.html#aa6dfbdc68373d10e371bd35f92c7adb3">stop</a>();</div>
<div class="line">            visualize(image2, -1, faces2, tm.<a class="code hl_function" href="../../d9/d6f/classcv_1_1TickMeter.html#a2fcc88e9c252d1fd2a1404c13b90ae22">getFPS</a>());</div>
<div class="line">            <span class="keywordflow">if</span> (save)</div>
<div class="line">            {</div>
<div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;Saving result2.jpg...\n&quot;</span>;</div>
<div class="line">                <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#ga8ac397bd09e48851665edbe12aa28f25">imwrite</a>(<span class="stringliteral">&quot;result2.jpg&quot;</span>, image2);</div>
<div class="line">            }</div>
<div class="line">            <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;image2&quot;</span>, image2);</div>
<div class="line">            <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga6d20fbd3100ec3badc1eaa653aff99d7">pollKey</a>();</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Initialize FaceRecognizerSF</span></div>
<div class="line">            <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga6395ca871a678020c4a31fadf7e8cc63">Ptr&lt;FaceRecognizerSF&gt;</a> faceRecognizer = FaceRecognizerSF::create(fr_modelPath, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Aligning and cropping facial image through the first face of faces detected.</span></div>
<div class="line">            <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> aligned_face1, aligned_face2;</div>
<div class="line">            faceRecognizer-&gt;alignCrop(image1, faces1.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">row</a>(0), aligned_face1);</div>
<div class="line">            faceRecognizer-&gt;alignCrop(image2, faces2.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">row</a>(0), aligned_face2);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Run feature extraction with given aligned_face</span></div>
<div class="line">            <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> feature1, feature2;</div>
<div class="line">            faceRecognizer-&gt;feature(aligned_face1, feature1);</div>
<div class="line">            feature1 = feature1.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>();</div>
<div class="line">            faceRecognizer-&gt;feature(aligned_face2, feature2);</div>
<div class="line">            feature2 = feature2.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>();</div>
<div class="line"> </div>
<div class="line">            <span class="keywordtype">double</span> cos_score = faceRecognizer-&gt;match(feature1, feature2, FaceRecognizerSF::DisType::FR_COSINE);</div>
<div class="line">            <span class="keywordtype">double</span> L2_score = faceRecognizer-&gt;match(feature1, feature2, FaceRecognizerSF::DisType::FR_NORM_L2);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (cos_score &gt;= cosine_similar_thresh)</div>
<div class="line">            {</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;They have the same identity;&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;They have different identities;&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; Cosine Similarity: &quot;</span> &lt;&lt; cos_score &lt;&lt; <span class="stringliteral">&quot;, threshold: &quot;</span> &lt;&lt; cosine_similar_thresh &lt;&lt; <span class="stringliteral">&quot;. (higher value means higher similarity, max 1.0)\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (L2_score &lt;= l2norm_similar_thresh)</div>
<div class="line">            {</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;They have the same identity;&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;They have different identities.&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; NormL2 Distance: &quot;</span> &lt;&lt; L2_score &lt;&lt; <span class="stringliteral">&quot;, threshold: &quot;</span> &lt;&lt; l2norm_similar_thresh &lt;&lt; <span class="stringliteral">&quot;. (lower value means higher similarity, min 0.0)\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Press any key to exit...&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> frameWidth, frameHeight;</div>
<div class="line">        <a class="code hl_class" href="../../d8/dfe/classcv_1_1VideoCapture.html">VideoCapture</a> capture;</div>
<div class="line">        std::string video = parser.<a class="code hl_function" href="../../d8/dfe/classcv_1_1VideoCapture.html#aa6480e6972ef4c00d74814ec841a2939">get</a>&lt;<span class="keywordtype">string</span>&gt;(<span class="stringliteral">&quot;video&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (video.size() == 1 &amp;&amp; isdigit(video[0]))</div>
<div class="line">            capture.<a class="code hl_function" href="../../d8/dfe/classcv_1_1VideoCapture.html#a614a1702e15f42ede5100014ce7f48ed">open</a>(parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;video&quot;</span>));</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            capture.<a class="code hl_function" href="../../d8/dfe/classcv_1_1VideoCapture.html#a614a1702e15f42ede5100014ce7f48ed">open</a>(samples::findFileOrKeep(video));  <span class="comment">// keep GStreamer pipelines</span></div>
<div class="line">        <span class="keywordflow">if</span> (capture.<a class="code hl_function" href="../../d8/dfe/classcv_1_1VideoCapture.html#a9d2ca36789e7fcfe7a7be3b328038585">isOpened</a>())</div>
<div class="line">        {</div>
<div class="line">            frameWidth = int(capture.<a class="code hl_function" href="../../d8/dfe/classcv_1_1VideoCapture.html#aa6480e6972ef4c00d74814ec841a2939">get</a>(CAP_PROP_FRAME_WIDTH) * scale);</div>
<div class="line">            frameHeight = int(capture.<a class="code hl_function" href="../../d8/dfe/classcv_1_1VideoCapture.html#aa6480e6972ef4c00d74814ec841a2939">get</a>(CAP_PROP_FRAME_HEIGHT) * scale);</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;Video &quot;</span> &lt;&lt; video</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;: width=&quot;</span> &lt;&lt; frameWidth</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;, height=&quot;</span> &lt;&lt; frameHeight</div>
<div class="line">                &lt;&lt; endl;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;Could not initialize video capturing: &quot;</span> &lt;&lt; video &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">            <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        detector-&gt;setInputSize(<a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a>(frameWidth, frameHeight));</div>
<div class="line"> </div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Press &#39;SPACE&#39; to save frame, any other key to exit...&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordtype">int</span> nFrame = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (;;)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Get frame</span></div>
<div class="line">            <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> frame;</div>
<div class="line">            <span class="keywordflow">if</span> (!capture.<a class="code hl_function" href="../../d8/dfe/classcv_1_1VideoCapture.html#a473055e77dd7faa4d26d686226b292c1">read</a>(frame))</div>
<div class="line">            {</div>
<div class="line">                cerr &lt;&lt; <span class="stringliteral">&quot;Can&#39;t grab frame! Stop\n&quot;</span>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#ga47a974309e9102f5f08231edc7e7529d">resize</a>(frame, frame, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a>(frameWidth, frameHeight));</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Inference</span></div>
<div class="line">            <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> faces;</div>
<div class="line">            tm.<a class="code hl_function" href="../../d9/d6f/classcv_1_1TickMeter.html#a564bc8b0bebcfc6c96f85fc48643e273">start</a>();</div>
<div class="line">            detector-&gt;detect(frame, faces);</div>
<div class="line">            tm.<a class="code hl_function" href="../../d9/d6f/classcv_1_1TickMeter.html#aa6dfbdc68373d10e371bd35f92c7adb3">stop</a>();</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> result = frame.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>();</div>
<div class="line">            <span class="comment">// Draw results on the input image</span></div>
<div class="line">            visualize(result, nFrame, faces, tm.<a class="code hl_function" href="../../d9/d6f/classcv_1_1TickMeter.html#a2fcc88e9c252d1fd2a1404c13b90ae22">getFPS</a>());</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Visualize results</span></div>
<div class="line">            <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Live&quot;</span>, result);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordtype">int</span> key = <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(1);</div>
<div class="line">            <span class="keywordtype">bool</span> saveFrame = save;</div>
<div class="line">            <span class="keywordflow">if</span> (key == <span class="charliteral">&#39; &#39;</span>)</div>
<div class="line">            {</div>
<div class="line">                saveFrame = <span class="keyword">true</span>;</div>
<div class="line">                key = 0;  <span class="comment">// handled</span></div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (saveFrame)</div>
<div class="line">            {</div>
<div class="line">                std::string frame_name = <a class="code hl_function" href="../../db/de0/group__core__utils.html#ga0cccdb2f73859309b0611cf70b1b9409">cv::format</a>(<span class="stringliteral">&quot;frame_%05d.png&quot;</span>, nFrame);</div>
<div class="line">                std::string result_name = <a class="code hl_function" href="../../db/de0/group__core__utils.html#ga0cccdb2f73859309b0611cf70b1b9409">cv::format</a>(<span class="stringliteral">&quot;result_%05d.jpg&quot;</span>, nFrame);</div>
<div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;Saving &#39;&quot;</span> &lt;&lt; frame_name &lt;&lt; <span class="stringliteral">&quot;&#39; and &#39;&quot;</span> &lt;&lt; result_name &lt;&lt; <span class="stringliteral">&quot;&#39; ...\n&quot;</span>;</div>
<div class="line">                <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#ga8ac397bd09e48851665edbe12aa28f25">imwrite</a>(frame_name, frame);</div>
<div class="line">                <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#ga8ac397bd09e48851665edbe12aa28f25">imwrite</a>(result_name, result);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            ++nFrame;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (key &gt; 0)</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Processed &quot;</span> &lt;&lt; nFrame &lt;&lt; <span class="stringliteral">&quot; frames&quot;</span> &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Done.&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclasscv_1_1CommandLineParser_html"><div class="ttname"><a href="../../d0/d2e/classcv_1_1CommandLineParser.html">cv::CommandLineParser</a></div><div class="ttdoc">Designed for command line parsing.</div><div class="ttdef"><b>Definition</b> utility.hpp:820</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a></div><div class="ttdoc">n-dimensional dense array class</div><div class="ttdef"><b>Definition</b> mat.hpp:812</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a03d2a2570d06dcae378f788725789aa4"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">cv::Mat::clone</a></div><div class="ttdeci">CV_NODISCARD_STD Mat clone() const</div><div class="ttdoc">Creates a full copy of the array and the underlying data.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a4b22e1c23af7a7f2eef8fa478cfa7434"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">cv::Mat::row</a></div><div class="ttdeci">Mat row(int y) const</div><div class="ttdoc">Creates a matrix header for the specified matrix row.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_aa10d804e90b51d4157b5c26e12c5d2df"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa10d804e90b51d4157b5c26e12c5d2df">cv::Mat::at</a></div><div class="ttdeci">_Tp &amp; at(int i0=0)</div><div class="ttdoc">Returns a reference to the specified array element.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_abed816466c45234254d25bc59c31245e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">cv::Mat::rows</a></div><div class="ttdeci">int rows</div><div class="ttdoc">the number of rows and columns or (-1, -1) when the matrix has more than 2 dimensions</div><div class="ttdef"><b>Definition</b> mat.hpp:2138</div></div>
<div class="ttc" id="aclasscv_1_1Point___html"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html">cv::Point_&lt; int &gt;</a></div></div>
<div class="ttc" id="aclasscv_1_1Rect___html"><div class="ttname"><a href="../../d2/d44/classcv_1_1Rect__.html">cv::Rect_</a></div><div class="ttdoc">Template class for 2D rectangles.</div><div class="ttdef"><b>Definition</b> types.hpp:444</div></div>
<div class="ttc" id="aclasscv_1_1Scalar___html"><div class="ttname"><a href="../../d1/da0/classcv_1_1Scalar__.html">cv::Scalar_&lt; double &gt;</a></div></div>
<div class="ttc" id="aclasscv_1_1Size___html"><div class="ttname"><a href="../../d6/d50/classcv_1_1Size__.html">cv::Size_</a></div><div class="ttdoc">Template class for specifying the size of an image or rectangle.</div><div class="ttdef"><b>Definition</b> types.hpp:335</div></div>
<div class="ttc" id="aclasscv_1_1TickMeter_html"><div class="ttname"><a href="../../d9/d6f/classcv_1_1TickMeter.html">cv::TickMeter</a></div><div class="ttdoc">a Class to measure passing time.</div><div class="ttdef"><b>Definition</b> utility.hpp:295</div></div>
<div class="ttc" id="aclasscv_1_1TickMeter_html_a2fcc88e9c252d1fd2a1404c13b90ae22"><div class="ttname"><a href="../../d9/d6f/classcv_1_1TickMeter.html#a2fcc88e9c252d1fd2a1404c13b90ae22">cv::TickMeter::getFPS</a></div><div class="ttdeci">double getFPS() const</div><div class="ttdoc">returns average FPS (frames per second) value.</div><div class="ttdef"><b>Definition</b> utility.hpp:351</div></div>
<div class="ttc" id="aclasscv_1_1TickMeter_html_a564bc8b0bebcfc6c96f85fc48643e273"><div class="ttname"><a href="../../d9/d6f/classcv_1_1TickMeter.html#a564bc8b0bebcfc6c96f85fc48643e273">cv::TickMeter::start</a></div><div class="ttdeci">void start()</div><div class="ttdoc">starts counting ticks.</div><div class="ttdef"><b>Definition</b> utility.hpp:304</div></div>
<div class="ttc" id="aclasscv_1_1TickMeter_html_aa6dfbdc68373d10e371bd35f92c7adb3"><div class="ttname"><a href="../../d9/d6f/classcv_1_1TickMeter.html#aa6dfbdc68373d10e371bd35f92c7adb3">cv::TickMeter::stop</a></div><div class="ttdeci">void stop()</div><div class="ttdoc">stops counting ticks.</div><div class="ttdef"><b>Definition</b> utility.hpp:310</div></div>
<div class="ttc" id="aclasscv_1_1TickMeter_html_ac9a8a593b4bd1c4ea6a1076c735260dd"><div class="ttname"><a href="../../d9/d6f/classcv_1_1TickMeter.html#ac9a8a593b4bd1c4ea6a1076c735260dd">cv::TickMeter::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdoc">resets internal values.</div><div class="ttdef"><b>Definition</b> utility.hpp:374</div></div>
<div class="ttc" id="aclasscv_1_1VideoCapture_html"><div class="ttname"><a href="../../d8/dfe/classcv_1_1VideoCapture.html">cv::VideoCapture</a></div><div class="ttdoc">Class for video capturing from video files, image sequences or cameras.</div><div class="ttdef"><b>Definition</b> videoio.hpp:731</div></div>
<div class="ttc" id="aclasscv_1_1VideoCapture_html_a473055e77dd7faa4d26d686226b292c1"><div class="ttname"><a href="../../d8/dfe/classcv_1_1VideoCapture.html#a473055e77dd7faa4d26d686226b292c1">cv::VideoCapture::read</a></div><div class="ttdeci">virtual bool read(OutputArray image)</div><div class="ttdoc">Grabs, decodes and returns the next video frame.</div></div>
<div class="ttc" id="aclasscv_1_1VideoCapture_html_a614a1702e15f42ede5100014ce7f48ed"><div class="ttname"><a href="../../d8/dfe/classcv_1_1VideoCapture.html#a614a1702e15f42ede5100014ce7f48ed">cv::VideoCapture::open</a></div><div class="ttdeci">virtual bool open(const String &amp;filename, int apiPreference=CAP_ANY)</div><div class="ttdoc">Opens a video file or a capturing device or an IP video stream for video capturing.</div></div>
<div class="ttc" id="aclasscv_1_1VideoCapture_html_a9d2ca36789e7fcfe7a7be3b328038585"><div class="ttname"><a href="../../d8/dfe/classcv_1_1VideoCapture.html#a9d2ca36789e7fcfe7a7be3b328038585">cv::VideoCapture::isOpened</a></div><div class="ttdeci">virtual bool isOpened() const</div><div class="ttdoc">Returns true if video capturing has been initialized already.</div></div>
<div class="ttc" id="aclasscv_1_1VideoCapture_html_aa6480e6972ef4c00d74814ec841a2939"><div class="ttname"><a href="../../d8/dfe/classcv_1_1VideoCapture.html#aa6480e6972ef4c00d74814ec841a2939">cv::VideoCapture::get</a></div><div class="ttdeci">virtual double get(int propId) const</div><div class="ttdoc">Returns the specified VideoCapture property.</div></div>
<div class="ttc" id="adnn_8hpp_html"><div class="ttname"><a href="../../d9/d8c/dnn_8hpp.html">dnn.hpp</a></div></div>
<div class="ttc" id="agroup__core__basic_html_ga1f6634802eeadfd7245bc75cf3e216c2"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">cv::String</a></div><div class="ttdeci">std::string String</div><div class="ttdef"><b>Definition</b> cvstd.hpp:151</div></div>
<div class="ttc" id="agroup__core__basic_html_ga6395ca871a678020c4a31fadf7e8cc63"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga6395ca871a678020c4a31fadf7e8cc63">cv::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; _Tp &gt; Ptr</div><div class="ttdef"><b>Definition</b> cvstd_wrapper.hpp:23</div></div>
<div class="ttc" id="agroup__core__utils_html_ga0cccdb2f73859309b0611cf70b1b9409"><div class="ttname"><a href="../../db/de0/group__core__utils.html#ga0cccdb2f73859309b0611cf70b1b9409">cv::format</a></div><div class="ttdeci">String format(const char *fmt,...)</div><div class="ttdoc">Returns a text string formatted using the printf-like expression.</div></div>
<div class="ttc" id="agroup__highgui_html_ga453d42fe4cb60e5723281a89973ee563"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv::imshow</a></div><div class="ttdeci">void imshow(const String &amp;winname, InputArray mat)</div><div class="ttdoc">Displays an image in the specified window.</div></div>
<div class="ttc" id="agroup__highgui_html_ga5628525ad33f52eab17feebcfba38bd7"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv::waitKey</a></div><div class="ttdeci">int waitKey(int delay=0)</div><div class="ttdoc">Waits for a pressed key.</div></div>
<div class="ttc" id="agroup__highgui_html_ga6d20fbd3100ec3badc1eaa653aff99d7"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga6d20fbd3100ec3badc1eaa653aff99d7">cv::pollKey</a></div><div class="ttdeci">int pollKey()</div><div class="ttdoc">Polls for a pressed key.</div></div>
<div class="ttc" id="agroup__imgcodecs_html_ga8ac397bd09e48851665edbe12aa28f25"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#ga8ac397bd09e48851665edbe12aa28f25">cv::imwrite</a></div><div class="ttdeci">CV_EXPORTS_W bool imwrite(const String &amp;filename, InputArray img, const std::vector&lt; int &gt; &amp;params=std::vector&lt; int &gt;())</div><div class="ttdoc">Saves an image to a specified file.</div></div>
<div class="ttc" id="agroup__imgcodecs_html_gab32ee19e22660912565f8140d0f675a8"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv::imread</a></div><div class="ttdeci">CV_EXPORTS_W Mat imread(const String &amp;filename, int flags=IMREAD_COLOR)</div><div class="ttdoc">Loads an image from a file.</div></div>
<div class="ttc" id="agroup__imgproc__transform_html_ga47a974309e9102f5f08231edc7e7529d"><div class="ttname"><a href="../../da/d54/group__imgproc__transform.html#ga47a974309e9102f5f08231edc7e7529d">cv::resize</a></div><div class="ttdeci">void resize(InputArray src, OutputArray dst, Size dsize, double fx=0, double fy=0, int interpolation=INTER_LINEAR)</div><div class="ttdoc">Resizes an image.</div></div>
<div class="ttc" id="ahighgui_8hpp_html"><div class="ttname"><a href="../../d4/dd5/highgui_8hpp.html">highgui.hpp</a></div></div>
<div class="ttc" id="ahighgui__qt_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition</b> highgui_qt.cpp:3</div></div>
<div class="ttc" id="aimgproc_2include_2opencv2_2imgproc_8hpp_html"><div class="ttname"><a href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="anamespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdoc">&quot;black box&quot; representation of the file storage associated with a file on disk.</div><div class="ttdef"><b>Definition</b> core.hpp:102</div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace.</div></div>
<div class="ttc" id="aobjdetect_8hpp_html"><div class="ttname"><a href="../../d8/da3/objdetect_8hpp.html">objdetect.hpp</a></div></div>
</div><!-- fragment -->  </div> </li>
</ul>
 <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'><ul>
<li><b>Downloadable code</b>: Click <a href="https://github.com/opencv/opencv/tree/4.x/samples/dnn/face_detect.py" target="_blank">here</a></li>
<li><b>Code at glance:</b> <div class="fragment"><div class="line"><span class="keyword">import</span> argparse</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>str2bool(v):</div>
<div class="line">    <span class="keywordflow">if</span> v.lower() <span class="keywordflow">in</span> [<span class="stringliteral">&#39;on&#39;</span>, <span class="stringliteral">&#39;yes&#39;</span>, <span class="stringliteral">&#39;true&#39;</span>, <span class="stringliteral">&#39;y&#39;</span>, <span class="stringliteral">&#39;t&#39;</span>]:</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">True</span></div>
<div class="line">    <span class="keywordflow">elif</span> v.lower() <span class="keywordflow">in</span> [<span class="stringliteral">&#39;off&#39;</span>, <span class="stringliteral">&#39;no&#39;</span>, <span class="stringliteral">&#39;false&#39;</span>, <span class="stringliteral">&#39;n&#39;</span>, <span class="stringliteral">&#39;f&#39;</span>]:</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">False</span></div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        <span class="keywordflow">raise</span> NotImplementedError</div>
<div class="line"> </div>
<div class="line">parser = argparse.ArgumentParser()</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--image1&#39;</span>, <span class="stringliteral">&#39;-i1&#39;</span>, type=str, help=<span class="stringliteral">&#39;Path to the input image1. Omit for detecting on default camera.&#39;</span>)</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--image2&#39;</span>, <span class="stringliteral">&#39;-i2&#39;</span>, type=str, help=<span class="stringliteral">&#39;Path to the input image2. When image1 and image2 parameters given then the program try to find a face on both images and runs face recognition algorithm.&#39;</span>)</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--video&#39;</span>, <span class="stringliteral">&#39;-v&#39;</span>, type=str, help=<span class="stringliteral">&#39;Path to the input video.&#39;</span>)</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--scale&#39;</span>, <span class="stringliteral">&#39;-sc&#39;</span>, type=float, default=1.0, help=<span class="stringliteral">&#39;Scale factor used to resize input video frames.&#39;</span>)</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--face_detection_model&#39;</span>, <span class="stringliteral">&#39;-fd&#39;</span>, type=str, default=<span class="stringliteral">&#39;face_detection_yunet_2021dec.onnx&#39;</span>, help=<span class="stringliteral">&#39;Path to the face detection model. Download the model at https://github.com/opencv/opencv_zoo/tree/master/models/face_detection_yunet&#39;</span>)</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--face_recognition_model&#39;</span>, <span class="stringliteral">&#39;-fr&#39;</span>, type=str, default=<span class="stringliteral">&#39;face_recognition_sface_2021dec.onnx&#39;</span>, help=<span class="stringliteral">&#39;Path to the face recognition model. Download the model at https://github.com/opencv/opencv_zoo/tree/master/models/face_recognition_sface&#39;</span>)</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--score_threshold&#39;</span>, type=float, default=0.9, help=<span class="stringliteral">&#39;Filtering out faces of score &lt; score_threshold.&#39;</span>)</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--nms_threshold&#39;</span>, type=float, default=0.3, help=<span class="stringliteral">&#39;Suppress bounding boxes of iou &gt;= nms_threshold.&#39;</span>)</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--top_k&#39;</span>, type=int, default=5000, help=<span class="stringliteral">&#39;Keep top_k bounding boxes before NMS.&#39;</span>)</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--save&#39;</span>, <span class="stringliteral">&#39;-s&#39;</span>, type=str2bool, default=<span class="keyword">False</span>, help=<span class="stringliteral">&#39;Set true to save results. This flag is invalid when using camera.&#39;</span>)</div>
<div class="line">args = parser.parse_args()</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>visualize(input, faces, fps, thickness=2):</div>
<div class="line">    <span class="keywordflow">if</span> faces[1] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line">        <span class="keywordflow">for</span> idx, face <span class="keywordflow">in</span> enumerate(faces[1]):</div>
<div class="line">            print(<span class="stringliteral">&#39;Face {}, top-left coordinates: ({:.0f}, {:.0f}), box width: {:.0f}, box height {:.0f}, score: {:.2f}&#39;</span>.format(idx, face[0], face[1], face[2], face[3], face[-1]))</div>
<div class="line"> </div>
<div class="line">            coords = face[:-1].astype(np.int32)</div>
<div class="line">            <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">cv.rectangle</a>(input, (coords[0], coords[1]), (coords[0]+coords[2], coords[1]+coords[3]), (0, 255, 0), thickness)</div>
<div class="line">            <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#gaf10604b069374903dbd0f0488cb43670">cv.circle</a>(input, (coords[4], coords[5]), 2, (255, 0, 0), thickness)</div>
<div class="line">            <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#gaf10604b069374903dbd0f0488cb43670">cv.circle</a>(input, (coords[6], coords[7]), 2, (0, 0, 255), thickness)</div>
<div class="line">            <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#gaf10604b069374903dbd0f0488cb43670">cv.circle</a>(input, (coords[8], coords[9]), 2, (0, 255, 0), thickness)</div>
<div class="line">            <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#gaf10604b069374903dbd0f0488cb43670">cv.circle</a>(input, (coords[10], coords[11]), 2, (255, 0, 255), thickness)</div>
<div class="line">            <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#gaf10604b069374903dbd0f0488cb43670">cv.circle</a>(input, (coords[12], coords[13]), 2, (0, 255, 255), thickness)</div>
<div class="line">    <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#ga5126f47f883d730f633d74f07456c576">cv.putText</a>(input, <span class="stringliteral">&#39;FPS: {:.2f}&#39;</span>.format(fps), (1, 16), cv.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 0), 2)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&#39;__main__&#39;</span>:</div>
<div class="line"> </div>
<div class="line">    </div>
<div class="line">    detector = <a class="code hl_function" href="../../df/d20/classcv_1_1FaceDetectorYN.html#a5f7fb43c60c95ca5ebab78483de02516">cv.FaceDetectorYN.create</a>(</div>
<div class="line">        args.face_detection_model,</div>
<div class="line">        <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">        (320, 320),</div>
<div class="line">        args.score_threshold,</div>
<div class="line">        args.nms_threshold,</div>
<div class="line">        args.top_k</div>
<div class="line">    )</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    tm = <a class="code hl_class" href="../../d9/d6f/classcv_1_1TickMeter.html">cv.TickMeter</a>()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># If input is an image</span></div>
<div class="line">    <span class="keywordflow">if</span> args.image1 <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line">        img1 = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv.imread</a>(<a class="code hl_function" href="../../d6/dba/group__core__utils__samples.html#ga3a33b00033b46c698ff6340d95569c13">cv.samples.findFile</a>(args.image1))</div>
<div class="line">        img1Width = int(img1.shape[1]*args.scale)</div>
<div class="line">        img1Height = int(img1.shape[0]*args.scale)</div>
<div class="line"> </div>
<div class="line">        img1 = <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#ga47a974309e9102f5f08231edc7e7529d">cv.resize</a>(img1, (img1Width, img1Height))</div>
<div class="line">        tm.start()</div>
<div class="line"> </div>
<div class="line">        </div>
<div class="line">        detector.setInputSize((img1Width, img1Height))</div>
<div class="line"> </div>
<div class="line">        faces1 = detector.detect(img1)</div>
<div class="line">        </div>
<div class="line"> </div>
<div class="line">        tm.stop()</div>
<div class="line">        <span class="keyword">assert</span> faces1[1] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>, <span class="stringliteral">&#39;Cannot find a face in {}&#39;</span>.format(args.image1)</div>
<div class="line"> </div>
<div class="line">        <span class="comment"># Draw results on the input image</span></div>
<div class="line">        visualize(img1, faces1, tm.getFPS())</div>
<div class="line"> </div>
<div class="line">        <span class="comment"># Save results if save is true</span></div>
<div class="line">        <span class="keywordflow">if</span> args.save:</div>
<div class="line">            print(<span class="stringliteral">&#39;Results saved to result.jpg\n&#39;</span>)</div>
<div class="line">            <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#ga8ac397bd09e48851665edbe12aa28f25">cv.imwrite</a>(<span class="stringliteral">&#39;result.jpg&#39;</span>, img1)</div>
<div class="line"> </div>
<div class="line">        <span class="comment"># Visualize results in a new window</span></div>
<div class="line">        <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(<span class="stringliteral">&quot;image1&quot;</span>, img1)</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> args.image2 <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line">            img2 = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gab32ee19e22660912565f8140d0f675a8">cv.imread</a>(<a class="code hl_function" href="../../d6/dba/group__core__utils__samples.html#ga3a33b00033b46c698ff6340d95569c13">cv.samples.findFile</a>(args.image2))</div>
<div class="line"> </div>
<div class="line">            tm.reset()</div>
<div class="line">            tm.start()</div>
<div class="line">            detector.setInputSize((img2.shape[1], img2.shape[0]))</div>
<div class="line">            faces2 = detector.detect(img2)</div>
<div class="line">            tm.stop()</div>
<div class="line">            <span class="keyword">assert</span> faces2[1] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>, <span class="stringliteral">&#39;Cannot find a face in {}&#39;</span>.format(args.image2)</div>
<div class="line">            visualize(img2, faces2, tm.getFPS())</div>
<div class="line">            <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(<span class="stringliteral">&quot;image2&quot;</span>, img2)</div>
<div class="line"> </div>
<div class="line">            </div>
<div class="line">            recognizer = <a class="code hl_function" href="../../da/d09/classcv_1_1FaceRecognizerSF.html#a04df90b0cd7d26d350acd92621a35743">cv.FaceRecognizerSF.create</a>(</div>
<div class="line">            args.face_recognition_model,<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line">            </div>
<div class="line"> </div>
<div class="line">            </div>
<div class="line">            face1_align = recognizer.alignCrop(img1, faces1[1][0])</div>
<div class="line">            face2_align = recognizer.alignCrop(img2, faces2[1][0])</div>
<div class="line"> </div>
<div class="line">            <span class="comment"># Extract features</span></div>
<div class="line">            face1_feature = recognizer.feature(face1_align)</div>
<div class="line">            face2_feature = recognizer.feature(face2_align)</div>
<div class="line">            </div>
<div class="line"> </div>
<div class="line">            cosine_similarity_threshold = 0.363</div>
<div class="line">            l2_similarity_threshold = 1.128</div>
<div class="line"> </div>
<div class="line">            </div>
<div class="line">            cosine_score = recognizer.match(face1_feature, face2_feature, cv.FaceRecognizerSF_FR_COSINE)</div>
<div class="line">            l2_score = recognizer.match(face1_feature, face2_feature, cv.FaceRecognizerSF_FR_NORM_L2)</div>
<div class="line">            </div>
<div class="line"> </div>
<div class="line">            msg = <span class="stringliteral">&#39;different identities&#39;</span></div>
<div class="line">            <span class="keywordflow">if</span> cosine_score &gt;= cosine_similarity_threshold:</div>
<div class="line">                msg = <span class="stringliteral">&#39;the same identity&#39;</span></div>
<div class="line">            print(<span class="stringliteral">&#39;They have {}. Cosine Similarity: {}, threshold: {} (higher value means higher similarity, max 1.0).&#39;</span>.format(msg, cosine_score, cosine_similarity_threshold))</div>
<div class="line"> </div>
<div class="line">            msg = <span class="stringliteral">&#39;different identities&#39;</span></div>
<div class="line">            <span class="keywordflow">if</span> l2_score &lt;= l2_similarity_threshold:</div>
<div class="line">                msg = <span class="stringliteral">&#39;the same identity&#39;</span></div>
<div class="line">            print(<span class="stringliteral">&#39;They have {}. NormL2 Distance: {}, threshold: {} (lower value means higher similarity, min 0.0).&#39;</span>.format(msg, l2_score, l2_similarity_threshold))</div>
<div class="line">        <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv.waitKey</a>(0)</div>
<div class="line">    <span class="keywordflow">else</span>: <span class="comment"># Omit input to call default camera</span></div>
<div class="line">        <span class="keywordflow">if</span> args.video <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line">            deviceId = args.video</div>
<div class="line">        <span class="keywordflow">else</span>:</div>
<div class="line">            deviceId = 0</div>
<div class="line">        cap = <a class="code hl_class" href="../../d8/dfe/classcv_1_1VideoCapture.html">cv.VideoCapture</a>(deviceId)</div>
<div class="line">        frameWidth = int(cap.get(cv.CAP_PROP_FRAME_WIDTH)*args.scale)</div>
<div class="line">        frameHeight = int(cap.get(cv.CAP_PROP_FRAME_HEIGHT)*args.scale)</div>
<div class="line">        detector.setInputSize([frameWidth, frameHeight])</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv.waitKey</a>(1) &lt; 0:</div>
<div class="line">            hasFrame, frame = cap.read()</div>
<div class="line">            <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasFrame:</div>
<div class="line">                print(<span class="stringliteral">&#39;No frames grabbed!&#39;</span>)</div>
<div class="line">                <span class="keywordflow">break</span></div>
<div class="line"> </div>
<div class="line">            frame = <a class="code hl_function" href="../../da/d54/group__imgproc__transform.html#ga47a974309e9102f5f08231edc7e7529d">cv.resize</a>(frame, (frameWidth, frameHeight))</div>
<div class="line"> </div>
<div class="line">            <span class="comment"># Inference</span></div>
<div class="line">            tm.start()</div>
<div class="line">            faces = detector.detect(frame) <span class="comment"># faces is a tuple</span></div>
<div class="line">            tm.stop()</div>
<div class="line"> </div>
<div class="line">            <span class="comment"># Draw results on the input image</span></div>
<div class="line">            visualize(frame, faces, tm.getFPS())</div>
<div class="line"> </div>
<div class="line">            <span class="comment"># Visualize results</span></div>
<div class="line">            <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(<span class="stringliteral">&#39;Live&#39;</span>, frame)</div>
<div class="line">    <a class="code hl_function" href="../../d7/dfc/group__highgui.html#ga6b7fc1c1a8960438156912027b38f481">cv.destroyAllWindows</a>()</div>
<div class="ttc" id="aclasscv_1_1FaceDetectorYN_html_a5f7fb43c60c95ca5ebab78483de02516"><div class="ttname"><a href="../../df/d20/classcv_1_1FaceDetectorYN.html#a5f7fb43c60c95ca5ebab78483de02516">cv::FaceDetectorYN::create</a></div><div class="ttdeci">static Ptr&lt; FaceDetectorYN &gt; create(CV_WRAP_FILE_PATH const String &amp;model, CV_WRAP_FILE_PATH const String &amp;config, const Size &amp;input_size, float score_threshold=0.9f, float nms_threshold=0.3f, int top_k=5000, int backend_id=0, int target_id=0)</div><div class="ttdoc">Creates an instance of face detector class with given parameters.</div></div>
<div class="ttc" id="aclasscv_1_1FaceRecognizerSF_html_a04df90b0cd7d26d350acd92621a35743"><div class="ttname"><a href="../../da/d09/classcv_1_1FaceRecognizerSF.html#a04df90b0cd7d26d350acd92621a35743">cv::FaceRecognizerSF::create</a></div><div class="ttdeci">static Ptr&lt; FaceRecognizerSF &gt; create(CV_WRAP_FILE_PATH const String &amp;model, CV_WRAP_FILE_PATH const String &amp;config, int backend_id=0, int target_id=0)</div><div class="ttdoc">Creates an instance of this class with given parameters.</div></div>
<div class="ttc" id="agroup__core__utils__samples_html_ga3a33b00033b46c698ff6340d95569c13"><div class="ttname"><a href="../../d6/dba/group__core__utils__samples.html#ga3a33b00033b46c698ff6340d95569c13">cv::samples::findFile</a></div><div class="ttdeci">cv::String findFile(const cv::String &amp;relative_path, bool required=true, bool silentMode=false)</div><div class="ttdoc">Try to find requested data file.</div></div>
<div class="ttc" id="agroup__highgui_html_ga6b7fc1c1a8960438156912027b38f481"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga6b7fc1c1a8960438156912027b38f481">cv::destroyAllWindows</a></div><div class="ttdeci">void destroyAllWindows()</div><div class="ttdoc">Destroys all of the HighGUI windows.</div></div>
<div class="ttc" id="agroup__imgproc__draw_html_ga07d2f74cadcf8e305e810ce8eed13bc9"><div class="ttname"><a href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">cv::rectangle</a></div><div class="ttdeci">void rectangle(InputOutputArray img, Point pt1, Point pt2, const Scalar &amp;color, int thickness=1, int lineType=LINE_8, int shift=0)</div><div class="ttdoc">Draws a simple, thick, or filled up-right rectangle.</div></div>
<div class="ttc" id="agroup__imgproc__draw_html_ga5126f47f883d730f633d74f07456c576"><div class="ttname"><a href="../../d6/d6e/group__imgproc__draw.html#ga5126f47f883d730f633d74f07456c576">cv::putText</a></div><div class="ttdeci">void putText(InputOutputArray img, const String &amp;text, Point org, int fontFace, double fontScale, Scalar color, int thickness=1, int lineType=LINE_8, bool bottomLeftOrigin=false)</div><div class="ttdoc">Draws a text string.</div></div>
<div class="ttc" id="agroup__imgproc__draw_html_gaf10604b069374903dbd0f0488cb43670"><div class="ttname"><a href="../../d6/d6e/group__imgproc__draw.html#gaf10604b069374903dbd0f0488cb43670">cv::circle</a></div><div class="ttdeci">void circle(InputOutputArray img, Point center, int radius, const Scalar &amp;color, int thickness=1, int lineType=LINE_8, int shift=0)</div><div class="ttdoc">Draws a circle.</div></div>
</div><!-- fragment -->  </div> </li>
</ul>
<h1><a class="anchor" id="autotoc_md357"></a>
Explanation</h1>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line">    <span class="comment">// Initialize FaceDetectorYN</span></div>
<div class="line">    <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga6395ca871a678020c4a31fadf7e8cc63">Ptr&lt;FaceDetectorYN&gt;</a> detector = FaceDetectorYN::create(fd_modelPath, <span class="stringliteral">&quot;&quot;</span>, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a>(320, 320), scoreThreshold, nmsThreshold, topK);</div>
</div><!-- fragment --> <div class="fragment"><div class="line">        <span class="comment">// Set input size before inference</span></div>
<div class="line">        detector-&gt;setInputSize(image1.size());</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> faces1;</div>
<div class="line">        detector-&gt;detect(image1, faces1);</div>
<div class="line">        <span class="keywordflow">if</span> (faces1.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> &lt; 1)</div>
<div class="line">        {</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;Cannot find a face in &quot;</span> &lt;&lt; input1 &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">    detector = <a class="code hl_function" href="../../df/d20/classcv_1_1FaceDetectorYN.html#a5f7fb43c60c95ca5ebab78483de02516">cv.FaceDetectorYN.create</a>(</div>
<div class="line">        args.face_detection_model,</div>
<div class="line">        <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">        (320, 320),</div>
<div class="line">        args.score_threshold,</div>
<div class="line">        args.nms_threshold,</div>
<div class="line">        args.top_k</div>
<div class="line">    )</div>
</div><!-- fragment --> <div class="fragment"><div class="line">        <span class="comment"># Set input size before inference</span></div>
<div class="line">        detector.setInputSize((img1Width, img1Height))</div>
<div class="line"> </div>
<div class="line">        faces1 = detector.detect(img1)</div>
</div><!-- fragment -->  </div> <p>The detection output <code>faces</code> is a two-dimension array of type CV_32F, whose rows are the detected face instances, columns are the location of a face and 5 facial landmarks. The format of each row is as follows:</p>
<div class="fragment"><div class="line">x1, y1, w, h, x_re, y_re, x_le, y_le, x_nt, y_nt, x_rcm, y_rcm, x_lcm, y_lcm</div>
</div><!-- fragment --><p> , where <code>x1, y1, w, h</code> are the top-left coordinates, width and height of the face bounding box, <code>{x, y}_{re, le, nt, rcm, lcm}</code> stands for the coordinates of right eye, left eye, nose tip, the right corner and left corner of the mouth respectively.</p>
<h2><a class="anchor" id="autotoc_md358"></a>
Face Recognition</h2>
<p>Following Face Detection, run codes below to extract face feature from facial image.</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line">            <span class="comment">// Initialize FaceRecognizerSF</span></div>
<div class="line">            <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga6395ca871a678020c4a31fadf7e8cc63">Ptr&lt;FaceRecognizerSF&gt;</a> faceRecognizer = FaceRecognizerSF::create(fr_modelPath, <span class="stringliteral">&quot;&quot;</span>);</div>
</div><!-- fragment --> <div class="fragment"><div class="line">            <span class="comment">// Aligning and cropping facial image through the first face of faces detected.</span></div>
<div class="line">            <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> aligned_face1, aligned_face2;</div>
<div class="line">            faceRecognizer-&gt;alignCrop(image1, faces1.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">row</a>(0), aligned_face1);</div>
<div class="line">            faceRecognizer-&gt;alignCrop(image2, faces2.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4b22e1c23af7a7f2eef8fa478cfa7434">row</a>(0), aligned_face2);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Run feature extraction with given aligned_face</span></div>
<div class="line">            <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> feature1, feature2;</div>
<div class="line">            faceRecognizer-&gt;feature(aligned_face1, feature1);</div>
<div class="line">            feature1 = feature1.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>();</div>
<div class="line">            faceRecognizer-&gt;feature(aligned_face2, feature2);</div>
<div class="line">            feature2 = feature2.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>();</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">            recognizer = <a class="code hl_function" href="../../da/d09/classcv_1_1FaceRecognizerSF.html#a04df90b0cd7d26d350acd92621a35743">cv.FaceRecognizerSF.create</a>(</div>
<div class="line">            args.face_recognition_model,<span class="stringliteral">&quot;&quot;</span>)</div>
</div><!-- fragment --> <div class="fragment"><div class="line">            <span class="comment"># Align faces</span></div>
<div class="line">            face1_align = recognizer.alignCrop(img1, faces1[1][0])</div>
<div class="line">            face2_align = recognizer.alignCrop(img2, faces2[1][0])</div>
<div class="line"> </div>
<div class="line">            <span class="comment"># Extract features</span></div>
<div class="line">            face1_feature = recognizer.feature(face1_align)</div>
<div class="line">            face2_feature = recognizer.feature(face2_align)</div>
</div><!-- fragment -->  </div> <p>After obtaining face features <em>feature1</em> and <em>feature2</em> of two facial images, run codes below to calculate the identity discrepancy between the two faces.</p>
 <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'> <div class="fragment"><div class="line">            <span class="keywordtype">double</span> cos_score = faceRecognizer-&gt;match(feature1, feature2, FaceRecognizerSF::DisType::FR_COSINE);</div>
<div class="line">            <span class="keywordtype">double</span> L2_score = faceRecognizer-&gt;match(feature1, feature2, FaceRecognizerSF::DisType::FR_NORM_L2);</div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'> <div class="fragment"><div class="line">            cosine_score = recognizer.match(face1_feature, face2_feature, cv.FaceRecognizerSF_FR_COSINE)</div>
<div class="line">            l2_score = recognizer.match(face1_feature, face2_feature, cv.FaceRecognizerSF_FR_NORM_L2)</div>
</div><!-- fragment -->  </div> <p>For example, two faces have same identity if the cosine distance is greater than or equal to 0.363, or the normL2 distance is less than or equal to 1.128.</p>
<h1><a class="anchor" id="autotoc_md359"></a>
Reference:</h1>
<ul>
<li><a href="https://github.com/ShiqiYu/libfacedetection">https://github.com/ShiqiYu/libfacedetection</a></li>
<li><a href="https://github.com/ShiqiYu/libfacedetection.train">https://github.com/ShiqiYu/libfacedetection.train</a></li>
<li><a href="https://github.com/zhongyy/SFace">https://github.com/zhongyy/SFace</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md360"></a>
Acknowledgement</h1>
<p>Thanks <a href="https://github.com/ShiqiYu/" target="_blank">Professor Shiqi Yu</a> and <a href="https://github.com/fengyuentau" target="_blank">Yuantao Feng</a> for training and providing the face detection model.</p>
<p>Thanks <a href="http://www.whdeng.cn/" target="_blank">Professor Deng</a>, <a href="https://github.com/zhongyy/" target="_blank">PhD Candidate Zhong</a> and <a href="https://github.com/crywang/" target="_blank">Master Candidate Wang</a> for training and providing the face recognition model. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 2 2024 21:52:13 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.8
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
