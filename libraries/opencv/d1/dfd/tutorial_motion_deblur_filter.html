<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>OpenCV: Motion Deblur Filter</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.10.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d7/da8/tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Motion Deblur Filter</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md732">Goal</a></li>
<li class="level1"><a href="#autotoc_md733">Theory</a><ul><li class="level2"><a href="#autotoc_md734">What is the PSF of a motion blur image?</a></li>
<li class="level2"><a href="#autotoc_md735">How to restore a blurred image?</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md736">Source code</a></li>
<li class="level1"><a href="#autotoc_md737">Explanation</a></li>
<li class="level1"><a href="#autotoc_md738">Result</a></li>
</ul>
</div>
<div class="textblock"><p><b>Prev Tutorial:</b> <a class="el" href="../../de/d3c/tutorial_out_of_focus_deblur_filter.html">Out-of-focus Deblur Filter</a> <br  />
<b>Next Tutorial:</b> <a class="el" href="../../d4/d70/tutorial_anisotropic_image_segmentation_by_a_gst.html">Anisotropic image segmentation by a gradient structure tensor</a> <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight"></th><th class="markdownTableHeadLeft"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">Original author   </td><td class="markdownTableBodyLeft">Karpushin Vladislav    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">Compatibility   </td><td class="markdownTableBodyLeft">OpenCV &gt;= 3.0   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md732"></a>
Goal</h1>
<p>In this tutorial you will learn:</p>
<ul>
<li>what the PSF of a motion blur image is</li>
<li>how to restore a motion blur image</li>
</ul>
<h1><a class="anchor" id="autotoc_md733"></a>
Theory</h1>
<p>For the degradation image model theory and the Wiener filter theory you can refer to the tutorial <a class="el" href="../../de/d3c/tutorial_out_of_focus_deblur_filter.html">Out-of-focus Deblur Filter</a>. On this page only a linear motion blur distortion is considered. The motion blur image on this page is a real world image. The blur was caused by a moving subject.</p>
<h2><a class="anchor" id="autotoc_md734"></a>
What is the PSF of a motion blur image?</h2>
<p>The point spread function (PSF) of a linear motion blur distortion is a line segment. Such a PSF is specified by two parameters: \(LEN\) is the length of the blur and \(THETA\) is the angle of motion.</p>
<div class="image">
<img src="../../motion_psf.png" alt=""/>
<div class="caption">
Point spread function of a linear motion blur distortion</div></div>
    <h2><a class="anchor" id="autotoc_md735"></a>
How to restore a blurred image?</h2>
<p>On this page the Wiener filter is used as the restoration filter, for details you can refer to the tutorial <a class="el" href="../../de/d3c/tutorial_out_of_focus_deblur_filter.html">Out-of-focus Deblur Filter</a>. In order to synthesize the Wiener filter for a motion blur case, it needs to specify the signal-to-noise ratio ( \(SNR\)), \(LEN\) and \(THETA\) of the PSF.</p>
<h1><a class="anchor" id="autotoc_md736"></a>
Source code</h1>
<p>You can find source code in the <code>samples/cpp/tutorial_code/ImgProc/motion_deblur_filter/motion_deblur_filter.cpp</code> of the OpenCV source code library.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">opencv2/imgproc.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d6/d87/imgcodecs_8hpp.html">opencv2/imgcodecs.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> help();</div>
<div class="line"><span class="keywordtype">void</span> calcPSF(<a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a> filterSize, <span class="keywordtype">int</span> len, <span class="keywordtype">double</span> theta);</div>
<div class="line"><span class="keywordtype">void</span> fftshift(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg);</div>
<div class="line"><span class="keywordtype">void</span> filter2DFreq(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; H);</div>
<div class="line"><span class="keywordtype">void</span> calcWnrFilter(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; input_h_PSF, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; output_G, <span class="keywordtype">double</span> nsr);</div>
<div class="line"><span class="keywordtype">void</span> edgetaper(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <span class="keywordtype">double</span> gamma = 5.0, <span class="keywordtype">double</span> beta = 0.2);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a> keys =</div>
<div class="line"><span class="stringliteral">&quot;{help h usage ? |             | print this message             }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{image          |input.png    | input image name               }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{LEN            |125          | length of a motion             }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{THETA          |0            | angle of a motion in degrees   }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{SNR            |700          | signal to noise ratio          }&quot;</span></div>
<div class="line">;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    help();</div>
<div class="line">    <a class="code hl_class" href="../../d0/d2e/classcv_1_1CommandLineParser.html">CommandLineParser</a> parser(argc, argv, keys);</div>
<div class="line">    <span class="keywordflow">if</span> (parser.has(<span class="stringliteral">&quot;help&quot;</span>))</div>
<div class="line">    {</div>
<div class="line">        parser.printMessage();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> LEN = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;LEN&quot;</span>);</div>
<div class="line">    <span class="keywordtype">double</span> THETA = parser.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;THETA&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span> snr = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;SNR&quot;</span>);</div>
<div class="line">    <span class="keywordtype">string</span> strInFileName = parser.get&lt;<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;image&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!parser.check())</div>
<div class="line">    {</div>
<div class="line">        parser.printErrors();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imgIn;</div>
<div class="line">    imgIn = imread(strInFileName, IMREAD_GRAYSCALE);</div>
<div class="line">    <span class="keywordflow">if</span> (imgIn.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#abbec3525a852e77998aba034813fded4">empty</a>()) <span class="comment">//check whether the image is loaded or not</span></div>
<div class="line">    {</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;ERROR : Image cannot be loaded..!!&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imgOut;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// it needs to process even image only</span></div>
<div class="line">    <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a> roi = <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(0, 0, imgIn.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> &amp; -2, imgIn.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> &amp; -2);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Hw calculation (start)</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> Hw, h;</div>
<div class="line">    calcPSF(h, roi.<a class="code hl_function" href="../../d2/d44/classcv_1_1Rect__.html#a9c727936bddffe38079628e0ec7942cc">size</a>(), LEN, THETA);</div>
<div class="line">    calcWnrFilter(h, Hw, 1.0 / <span class="keywordtype">double</span>(snr));</div>
<div class="line">    <span class="comment">//Hw calculation (stop)</span></div>
<div class="line"> </div>
<div class="line">    imgIn.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(imgIn, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>);</div>
<div class="line">    edgetaper(imgIn, imgIn);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// filtering (start)</span></div>
<div class="line">    filter2DFreq(imgIn(roi), imgOut, Hw);</div>
<div class="line">    <span class="comment">// filtering (stop)</span></div>
<div class="line"> </div>
<div class="line">    imgOut.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(imgOut, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);</div>
<div class="line">    normalize(imgOut, imgOut, 0, 255, NORM_MINMAX);</div>
<div class="line">    imwrite(<span class="stringliteral">&quot;result.jpg&quot;</span>, imgOut);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> help()</div>
<div class="line">{</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;2018-08-14&quot;</span> &lt;&lt; endl;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Motion_deblur_v2&quot;</span> &lt;&lt; endl;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;You will learn how to recover an image with motion blur distortion using a Wiener filter&quot;</span> &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> calcPSF(<a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a> filterSize, <span class="keywordtype">int</span> len, <span class="keywordtype">double</span> theta)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> h(filterSize, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> point(filterSize.<a class="code hl_variable" href="../../d6/d50/classcv_1_1Size__.html#abfe0367b32c407ddccf5ddf92667c73d">width</a> / 2, filterSize.<a class="code hl_variable" href="../../d6/d50/classcv_1_1Size__.html#a1d289dce6b5d8006a54f3ee0259fc545">height</a> / 2);</div>
<div class="line">    <a class="code hl_function" href="../../d6/d6e/group__imgproc__draw.html#ga28b2267d35786f5f890ca167236cbc69">ellipse</a>(h, point, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a>(0, <a class="code hl_function" href="../../db/de0/group__core__utils.html#ga085eca238176984a0b72df2818598d85">cvRound</a>(<span class="keywordtype">float</span>(len) / 2.0)), 90.0 - theta, 0, 360, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(255), FILLED);</div>
<div class="line">    <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a> summa = <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga716e10a2dd9e228e4d3c95818f106722">sum</a>(h);</div>
<div class="line">    outputImg = h / summa[0];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> fftshift(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg)</div>
<div class="line">{</div>
<div class="line">    outputImg = inputImg.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>();</div>
<div class="line">    <span class="keywordtype">int</span> cx = outputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> / 2;</div>
<div class="line">    <span class="keywordtype">int</span> cy = outputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> / 2;</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> q0(outputImg, <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(0, 0, cx, cy));</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> q1(outputImg, <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(cx, 0, cx, cy));</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> q2(outputImg, <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(0, cy, cx, cy));</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> q3(outputImg, <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(cx, cy, cx, cy));</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> tmp;</div>
<div class="line">    q0.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>(tmp);</div>
<div class="line">    q3.copyTo(q0);</div>
<div class="line">    tmp.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>(q3);</div>
<div class="line">    q1.copyTo(tmp);</div>
<div class="line">    q2.copyTo(q1);</div>
<div class="line">    tmp.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">copyTo</a>(q2);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> filter2DFreq(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; H)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> planes[2] = { <a class="code hl_class" href="../../df/dfc/classcv_1_1Mat__.html">Mat_&lt;float&gt;</a>(inputImg.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>()), Mat::zeros(inputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>) };</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> complexI;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(planes, 2, complexI);</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#gadd6cf9baf2b8b704a11b5f04aaf4f39d">dft</a>(complexI, complexI, DFT_SCALE);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> planesH[2] = { <a class="code hl_class" href="../../df/dfc/classcv_1_1Mat__.html">Mat_&lt;float&gt;</a>(H.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>()), Mat::zeros(H.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>) };</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> complexH;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(planesH, 2, complexH);</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> complexIH;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga3ab38646463c59bf0ce962a9d51db64f">mulSpectrums</a>(complexI, complexH, complexIH, 0);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#gaa708aa2d2e57a508f968eb0f69aa5ff1">idft</a>(complexIH, complexIH);</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga0547c7fed86152d7e9d0096029c8518a">split</a>(complexIH, planes);</div>
<div class="line">    outputImg = planes[0];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> calcWnrFilter(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; input_h_PSF, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; output_G, <span class="keywordtype">double</span> nsr)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> h_PSF_shifted;</div>
<div class="line">    fftshift(input_h_PSF, h_PSF_shifted);</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> planes[2] = { <a class="code hl_class" href="../../df/dfc/classcv_1_1Mat__.html">Mat_&lt;float&gt;</a>(h_PSF_shifted.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>()), Mat::zeros(h_PSF_shifted.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>) };</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> complexI;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(planes, 2, complexI);</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#gadd6cf9baf2b8b704a11b5f04aaf4f39d">dft</a>(complexI, complexI);</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga0547c7fed86152d7e9d0096029c8518a">split</a>(complexI, planes);</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> denom;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#gaf0d056b5bd1dc92500d6f6cf6bac41ef">pow</a>(<a class="code hl_function" href="../../d7/dcc/group__core__utils__softfloat.html#ga72dd776aec140cd56401b29af17e36c3">abs</a>(planes[0]), 2, denom);</div>
<div class="line">    denom += nsr;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga6db555d30115642fedae0cda05604874">divide</a>(planes[0], denom, output_G);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> edgetaper(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <span class="keywordtype">double</span> gamma, <span class="keywordtype">double</span> beta)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> Nx = inputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>;</div>
<div class="line">    <span class="keywordtype">int</span> Ny = inputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>;</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> w1(1, Nx, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> w2(Ny, 1, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span>* p1 = w1.ptr&lt;<span class="keywordtype">float</span>&gt;(0);</div>
<div class="line">    <span class="keywordtype">float</span>* p2 = w2.ptr&lt;<span class="keywordtype">float</span>&gt;(0);</div>
<div class="line">    <span class="keywordtype">float</span> dx = float(2.0 * <a class="code hl_define" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a> / Nx);</div>
<div class="line">    <span class="keywordtype">float</span> x = float(-<a class="code hl_define" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Nx; i++)</div>
<div class="line">    {</div>
<div class="line">        p1[i] = float(0.5 * (<a class="code hl_function" href="../../d0/de1/group__core.html#ga33045a04cda7e3b88852048e1e675dd2">tanh</a>((x + gamma / 2) / beta) - <a class="code hl_function" href="../../d0/de1/group__core.html#ga33045a04cda7e3b88852048e1e675dd2">tanh</a>((x - gamma / 2) / beta)));</div>
<div class="line">        x += dx;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">float</span> dy = float(2.0 * <a class="code hl_define" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a> / Ny);</div>
<div class="line">    <span class="keywordtype">float</span> y = float(-<a class="code hl_define" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Ny; i++)</div>
<div class="line">    {</div>
<div class="line">        p2[i] = float(0.5 * (<a class="code hl_function" href="../../d0/de1/group__core.html#ga33045a04cda7e3b88852048e1e675dd2">tanh</a>((y + gamma / 2) / beta) - <a class="code hl_function" href="../../d0/de1/group__core.html#ga33045a04cda7e3b88852048e1e675dd2">tanh</a>((y - gamma / 2) / beta)));</div>
<div class="line">        y += dy;</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> w = w2 * w1;</div>
<div class="line">    <a class="code hl_function" href="../../d2/de8/group__core__array.html#ga979d898a58d7f61c53003e162e7ad89f">multiply</a>(inputImg, w, outputImg);</div>
<div class="line">}</div>
<div class="ttc" id="aclasscv_1_1CommandLineParser_html"><div class="ttname"><a href="../../d0/d2e/classcv_1_1CommandLineParser.html">cv::CommandLineParser</a></div><div class="ttdoc">Designed for command line parsing.</div><div class="ttdef"><b>Definition</b> utility.hpp:820</div></div>
<div class="ttc" id="aclasscv_1_1Mat___html"><div class="ttname"><a href="../../df/dfc/classcv_1_1Mat__.html">cv::Mat_</a></div><div class="ttdoc">Template matrix class derived from Mat.</div><div class="ttdef"><b>Definition</b> mat.hpp:2230</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a></div><div class="ttdoc">n-dimensional dense array class</div><div class="ttdef"><b>Definition</b> mat.hpp:812</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a03d2a2570d06dcae378f788725789aa4"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">cv::Mat::clone</a></div><div class="ttdeci">CV_NODISCARD_STD Mat clone() const</div><div class="ttdoc">Creates a full copy of the array and the underlying data.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a146f8e8dda07d1365a575ab83d9828d1"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">cv::Mat::size</a></div><div class="ttdeci">MatSize size</div><div class="ttdef"><b>Definition</b> mat.hpp:2160</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_a33fd5d125b4c302b0c9aa86980791a77"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a33fd5d125b4c302b0c9aa86980791a77">cv::Mat::copyTo</a></div><div class="ttdeci">void copyTo(OutputArray m) const</div><div class="ttdoc">Copies the matrix to another one.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_aa3e5a47585c9ef6a0842556739155e3e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cv::Mat::cols</a></div><div class="ttdeci">int cols</div><div class="ttdef"><b>Definition</b> mat.hpp:2138</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_abbec3525a852e77998aba034813fded4"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abbec3525a852e77998aba034813fded4">cv::Mat::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Returns true if the array has no elements.</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_abed816466c45234254d25bc59c31245e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">cv::Mat::rows</a></div><div class="ttdeci">int rows</div><div class="ttdoc">the number of rows and columns or (-1, -1) when the matrix has more than 2 dimensions</div><div class="ttdef"><b>Definition</b> mat.hpp:2138</div></div>
<div class="ttc" id="aclasscv_1_1Mat_html_adf88c60c5b4980e05bb556080916978b"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">cv::Mat::convertTo</a></div><div class="ttdeci">void convertTo(OutputArray m, int rtype, double alpha=1, double beta=0) const</div><div class="ttdoc">Converts an array to another data type with optional scaling.</div></div>
<div class="ttc" id="aclasscv_1_1Point___html"><div class="ttname"><a href="../../db/d4e/classcv_1_1Point__.html">cv::Point_&lt; int &gt;</a></div></div>
<div class="ttc" id="aclasscv_1_1Rect___html"><div class="ttname"><a href="../../d2/d44/classcv_1_1Rect__.html">cv::Rect_</a></div><div class="ttdoc">Template class for 2D rectangles.</div><div class="ttdef"><b>Definition</b> types.hpp:444</div></div>
<div class="ttc" id="aclasscv_1_1Rect___html_a9c727936bddffe38079628e0ec7942cc"><div class="ttname"><a href="../../d2/d44/classcv_1_1Rect__.html#a9c727936bddffe38079628e0ec7942cc">cv::Rect_::size</a></div><div class="ttdeci">Size_&lt; _Tp &gt; size() const</div><div class="ttdoc">size (width, height) of the rectangle</div></div>
<div class="ttc" id="aclasscv_1_1Scalar___html"><div class="ttname"><a href="../../d1/da0/classcv_1_1Scalar__.html">cv::Scalar_&lt; double &gt;</a></div></div>
<div class="ttc" id="aclasscv_1_1Size___html"><div class="ttname"><a href="../../d6/d50/classcv_1_1Size__.html">cv::Size_</a></div><div class="ttdoc">Template class for specifying the size of an image or rectangle.</div><div class="ttdef"><b>Definition</b> types.hpp:335</div></div>
<div class="ttc" id="aclasscv_1_1Size___html_a1d289dce6b5d8006a54f3ee0259fc545"><div class="ttname"><a href="../../d6/d50/classcv_1_1Size__.html#a1d289dce6b5d8006a54f3ee0259fc545">cv::Size_::height</a></div><div class="ttdeci">_Tp height</div><div class="ttdoc">the height</div><div class="ttdef"><b>Definition</b> types.hpp:363</div></div>
<div class="ttc" id="aclasscv_1_1Size___html_abfe0367b32c407ddccf5ddf92667c73d"><div class="ttname"><a href="../../d6/d50/classcv_1_1Size__.html#abfe0367b32c407ddccf5ddf92667c73d">cv::Size_::width</a></div><div class="ttdeci">_Tp width</div><div class="ttdoc">the width</div><div class="ttdef"><b>Definition</b> types.hpp:362</div></div>
<div class="ttc" id="agroup__core__array_html_ga0547c7fed86152d7e9d0096029c8518a"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga0547c7fed86152d7e9d0096029c8518a">cv::split</a></div><div class="ttdeci">void split(const Mat &amp;src, Mat *mvbegin)</div><div class="ttdoc">Divides a multi-channel array into several single-channel arrays.</div></div>
<div class="ttc" id="agroup__core__array_html_ga3ab38646463c59bf0ce962a9d51db64f"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga3ab38646463c59bf0ce962a9d51db64f">cv::mulSpectrums</a></div><div class="ttdeci">void mulSpectrums(InputArray a, InputArray b, OutputArray c, int flags, bool conjB=false)</div><div class="ttdoc">Performs the per-element multiplication of two Fourier spectrums.</div></div>
<div class="ttc" id="agroup__core__array_html_ga6db555d30115642fedae0cda05604874"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga6db555d30115642fedae0cda05604874">cv::divide</a></div><div class="ttdeci">void divide(InputArray src1, InputArray src2, OutputArray dst, double scale=1, int dtype=-1)</div><div class="ttdoc">Performs per-element division of two arrays or a scalar by an array.</div></div>
<div class="ttc" id="agroup__core__array_html_ga716e10a2dd9e228e4d3c95818f106722"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga716e10a2dd9e228e4d3c95818f106722">cv::sum</a></div><div class="ttdeci">Scalar sum(InputArray src)</div><div class="ttdoc">Calculates the sum of array elements.</div></div>
<div class="ttc" id="agroup__core__array_html_ga7d7b4d6c6ee504b30a20b1680029c7b4"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">cv::merge</a></div><div class="ttdeci">void merge(const Mat *mv, size_t count, OutputArray dst)</div><div class="ttdoc">Creates one multi-channel array out of several single-channel ones.</div></div>
<div class="ttc" id="agroup__core__array_html_ga979d898a58d7f61c53003e162e7ad89f"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga979d898a58d7f61c53003e162e7ad89f">cv::multiply</a></div><div class="ttdeci">void multiply(InputArray src1, InputArray src2, OutputArray dst, double scale=1, int dtype=-1)</div><div class="ttdoc">Calculates the per-element scaled product of two arrays.</div></div>
<div class="ttc" id="agroup__core__array_html_gaa708aa2d2e57a508f968eb0f69aa5ff1"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gaa708aa2d2e57a508f968eb0f69aa5ff1">cv::idft</a></div><div class="ttdeci">void idft(InputArray src, OutputArray dst, int flags=0, int nonzeroRows=0)</div><div class="ttdoc">Calculates the inverse Discrete Fourier Transform of a 1D or 2D array.</div></div>
<div class="ttc" id="agroup__core__array_html_gadd6cf9baf2b8b704a11b5f04aaf4f39d"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gadd6cf9baf2b8b704a11b5f04aaf4f39d">cv::dft</a></div><div class="ttdeci">void dft(InputArray src, OutputArray dst, int flags=0, int nonzeroRows=0)</div><div class="ttdoc">Performs a forward or inverse Discrete Fourier transform of a 1D or 2D floating-point array.</div></div>
<div class="ttc" id="agroup__core__array_html_gaf0d056b5bd1dc92500d6f6cf6bac41ef"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gaf0d056b5bd1dc92500d6f6cf6bac41ef">cv::pow</a></div><div class="ttdeci">void pow(InputArray src, double power, OutputArray dst)</div><div class="ttdoc">Raises every array element to a power.</div></div>
<div class="ttc" id="agroup__core__basic_html_ga1f6634802eeadfd7245bc75cf3e216c2"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">cv::String</a></div><div class="ttdeci">std::string String</div><div class="ttdef"><b>Definition</b> cvstd.hpp:151</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga32b18d904ee2b1731a9416a8eef67d06"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a></div><div class="ttdeci">#define CV_8U</div><div class="ttdef"><b>Definition</b> interface.h:73</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga4a3def5d72b74bed31f5f8ab7676099c"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a></div><div class="ttdeci">#define CV_32F</div><div class="ttdef"><b>Definition</b> interface.h:78</div></div>
<div class="ttc" id="agroup__core__utils__softfloat_html_ga72dd776aec140cd56401b29af17e36c3"><div class="ttname"><a href="../../d7/dcc/group__core__utils__softfloat.html#ga72dd776aec140cd56401b29af17e36c3">cv::abs</a></div><div class="ttdeci">softfloat abs(softfloat a)</div><div class="ttdoc">Absolute value.</div><div class="ttdef"><b>Definition</b> softfloat.hpp:444</div></div>
<div class="ttc" id="agroup__core__utils_html_ga085eca238176984a0b72df2818598d85"><div class="ttname"><a href="../../db/de0/group__core__utils.html#ga085eca238176984a0b72df2818598d85">cvRound</a></div><div class="ttdeci">int cvRound(double value)</div><div class="ttdoc">Rounds floating-point number to the nearest integer.</div><div class="ttdef"><b>Definition</b> fast_math.hpp:200</div></div>
<div class="ttc" id="agroup__core__utils_html_ga677b89fae9308b340ddaebf0dba8455f"><div class="ttname"><a href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a></div><div class="ttdeci">#define CV_PI</div><div class="ttdef"><b>Definition</b> cvdef.h:380</div></div>
<div class="ttc" id="agroup__core_html_ga33045a04cda7e3b88852048e1e675dd2"><div class="ttname"><a href="../../d0/de1/group__core.html#ga33045a04cda7e3b88852048e1e675dd2">cv::tanh</a></div><div class="ttdeci">Quat&lt; T &gt; tanh(const Quat&lt; T &gt; &amp;q)</div></div>
<div class="ttc" id="agroup__imgproc__draw_html_ga28b2267d35786f5f890ca167236cbc69"><div class="ttname"><a href="../../d6/d6e/group__imgproc__draw.html#ga28b2267d35786f5f890ca167236cbc69">cv::ellipse</a></div><div class="ttdeci">void ellipse(InputOutputArray img, Point center, Size axes, double angle, double startAngle, double endAngle, const Scalar &amp;color, int thickness=1, int lineType=LINE_8, int shift=0)</div><div class="ttdoc">Draws a simple or thick elliptic arc or fills an ellipse sector.</div></div>
<div class="ttc" id="ahighgui__qt_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition</b> highgui_qt.cpp:3</div></div>
<div class="ttc" id="aimgcodecs_8hpp_html"><div class="ttname"><a href="../../d6/d87/imgcodecs_8hpp.html">imgcodecs.hpp</a></div></div>
<div class="ttc" id="aimgproc_2include_2opencv2_2imgproc_8hpp_html"><div class="ttname"><a href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="anamespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdoc">&quot;black box&quot; representation of the file storage associated with a file on disk.</div><div class="ttdef"><b>Definition</b> core.hpp:102</div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md737"></a>
Explanation</h1>
<p>A motion blur image recovering algorithm consists of PSF generation, Wiener filter generation and filtering a blurred image in a frequency domain: </p><div class="fragment"><div class="line">    <span class="comment">// it needs to process even image only</span></div>
<div class="line">    <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a> roi = <a class="code hl_class" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a>(0, 0, imgIn.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a> &amp; -2, imgIn.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a> &amp; -2);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Hw calculation (start)</span></div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> Hw, h;</div>
<div class="line">    calcPSF(h, roi.<a class="code hl_function" href="../../d2/d44/classcv_1_1Rect__.html#a9c727936bddffe38079628e0ec7942cc">size</a>(), LEN, THETA);</div>
<div class="line">    calcWnrFilter(h, Hw, 1.0 / <span class="keywordtype">double</span>(snr));</div>
<div class="line">    <span class="comment">//Hw calculation (stop)</span></div>
<div class="line"> </div>
<div class="line">    imgIn.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(imgIn, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>);</div>
<div class="line">    edgetaper(imgIn, imgIn);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// filtering (start)</span></div>
<div class="line">    filter2DFreq(imgIn(roi), imgOut, Hw);</div>
<div class="line">    <span class="comment">// filtering (stop)</span></div>
</div><!-- fragment --><p>A function calcPSF() forms a PSF according to input parameters \(LEN\) and \(THETA\) (in degrees): </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> calcPSF(<a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a> filterSize, <span class="keywordtype">int</span> len, <span class="keywordtype">double</span> theta)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> h(filterSize, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    <a class="code hl_class" href="../../db/d4e/classcv_1_1Point__.html">Point</a> point(filterSize.<a class="code hl_variable" href="../../d6/d50/classcv_1_1Size__.html#abfe0367b32c407ddccf5ddf92667c73d">width</a> / 2, filterSize.<a class="code hl_variable" href="../../d6/d50/classcv_1_1Size__.html#a1d289dce6b5d8006a54f3ee0259fc545">height</a> / 2);</div>
<div class="line">    ellipse(h, point, <a class="code hl_class" href="../../d6/d50/classcv_1_1Size__.html">Size</a>(0, <a class="code hl_function" href="../../db/de0/group__core__utils.html#ga085eca238176984a0b72df2818598d85">cvRound</a>(<span class="keywordtype">float</span>(len) / 2.0)), 90.0 - theta, 0, 360, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(255), FILLED);</div>
<div class="line">    <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a> summa = sum(h);</div>
<div class="line">    outputImg = h / summa[0];</div>
<div class="line">}</div>
</div><!-- fragment --><p>A function edgetaper() tapers the input imageâ€™s edges in order to reduce the ringing effect in a restored image: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> edgetaper(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; inputImg, <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>&amp; outputImg, <span class="keywordtype">double</span> gamma, <span class="keywordtype">double</span> beta)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> Nx = inputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>;</div>
<div class="line">    <span class="keywordtype">int</span> Ny = inputImg.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>;</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> w1(1, Nx, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> w2(Ny, 1, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code hl_class" href="../../d1/da0/classcv_1_1Scalar__.html">Scalar</a>(0));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span>* p1 = w1.ptr&lt;<span class="keywordtype">float</span>&gt;(0);</div>
<div class="line">    <span class="keywordtype">float</span>* p2 = w2.ptr&lt;<span class="keywordtype">float</span>&gt;(0);</div>
<div class="line">    <span class="keywordtype">float</span> dx = float(2.0 * <a class="code hl_define" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a> / Nx);</div>
<div class="line">    <span class="keywordtype">float</span> x = float(-<a class="code hl_define" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Nx; i++)</div>
<div class="line">    {</div>
<div class="line">        p1[i] = float(0.5 * (tanh((x + gamma / 2) / beta) - tanh((x - gamma / 2) / beta)));</div>
<div class="line">        x += dx;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">float</span> dy = float(2.0 * <a class="code hl_define" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a> / Ny);</div>
<div class="line">    <span class="keywordtype">float</span> y = float(-<a class="code hl_define" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Ny; i++)</div>
<div class="line">    {</div>
<div class="line">        p2[i] = float(0.5 * (tanh((y + gamma / 2) / beta) - tanh((y - gamma / 2) / beta)));</div>
<div class="line">        y += dy;</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> w = w2 * w1;</div>
<div class="line">    multiply(inputImg, w, outputImg);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The functions calcWnrFilter(), fftshift() and filter2DFreq() realize an image filtration by a specified PSF in the frequency domain. The functions are copied from the tutorial <a class="el" href="../../de/d3c/tutorial_out_of_focus_deblur_filter.html">Out-of-focus Deblur Filter</a>.</p>
<h1><a class="anchor" id="autotoc_md738"></a>
Result</h1>
<p>Below you can see the real world image with motion blur distortion. The license plate is not readable on both cars. The red markers show the carâ€™s license plate location. <img src="../../motion_original.jpg" alt="" class="inline" title="Motion blur image. The license plates are not readable"/>    </p>
<p>Below you can see the restoration result for the black car license plate. The result has been computed with \(LEN\) = 125, \(THETA\) = 0, \(SNR\) = 700. <img src="../../black_car.jpg" alt="" class="inline" title="The restored image of the black car license plate"/>    </p>
<p>Below you can see the restoration result for the white car license plate. The result has been computed with \(LEN\) = 78, \(THETA\) = 15, \(SNR\) = 300. <img src="../../white_car.jpg" alt="" class="inline" title="The restored image of the white car license plate"/>    </p>
<p>The values of \(SNR\), \(LEN\) and \(THETA\) were selected manually to give the best possible visual result. The \(THETA\) parameter coincides with the carâ€™s moving direction, and the \(LEN\) parameter depends on the carâ€™s moving speed. The result is not perfect, but at least it gives us a hint of the imageâ€™s content. With some effort, the car license plate is now readable.</p>
<dl class="section note"><dt>Note</dt><dd>The parameters \(LEN\) and \(THETA\) are the most important. You should adjust \(LEN\) and \(THETA\) first, then \(SNR\).</dd></dl>
<p>You can also find a quick video demonstration of a license plate recovering method <a href="https://youtu.be/xSrE0hdhb4o" target="_blank">YouTube</a>. </p><div align='center'><iframe title='Video' width='560' height='349' src='https://www.youtube.com/embed/xSrE0hdhb4o?rel=0' frameborder='0' align='middle' allowfullscreen></iframe></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 2 2024 21:52:14 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.8
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
